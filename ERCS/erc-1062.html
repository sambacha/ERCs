<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Formalize IPFS hash into ENS(Ethereum Name Service) resolver | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Formalize IPFS hash into ENS(Ethereum Name Service) resolver | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-1062" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-1062" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Formalize IPFS hash into ENS(Ethereum Name Service) resolver</h1>
  </header>

  <div class="post-content">
    <h2 id="simple-summary">Simple Summary</h2>
<p>To specify the mapping protocol between resources stored on IPFS and ENS(Ethereum Naming Service).</p>

<h2 id="abstract">Abstract</h2>
<p>The following standard details the implementation of how to combine the IPFS cryptographic hash unique fingerprint with ENS public resolver. This standard provides a functionality to get and set IPFS online resources to ENS resolver.</p>

<p>We think that this implementation is not only aim to let more developers and communities to provide more use cases, but also leverage the human-readable features to gain more user adoption accessing decentralized resources. We considered the IPFS ENS resolver mapping standard a cornerstone for building future Web3.0 service.</p>

<h2 id="motivation">Motivation</h2>
<p>To build fully decentralized web service, it’s necessary to have a decentralized file storage system. Here comes the IPFS, for three following advantages :</p>
<ul>
  <li>Address large amounts of data, and has unique cryptographic hash for every record.</li>
  <li>Since IPFS is also based on peer to peer network, it can be really helpful to deliver large amounts of data to users, with safer way and lower the millions of cost for the bandwidth.</li>
  <li>IPFS stores files in high efficient way via tracking version history for every file, and removing the duplications across the network.</li>
</ul>

<p>Those features makes perfect match for integrating into ENS, and these make users can easily access content through ENS, and show up in the normal browser.</p>

<h2 id="specification">Specification</h2>
<p>The condition now is that the IPFS file fingerprint using base58 and in the meantime, the Ethereum uses hex in API to encode the binary data. So that need a way to process the condition requires not only we need to transfer from IPFS to Ethereum, but also need to convert it back.</p>

<p>To solve these requirements, we can use binary buffer bridging that gap.<br />
When mapping the IPFS base58 string to ENS resolver, first we convert the Base58 to binary buffer, turn the buffer to hex encrypted format, and save to the contract. Once we want to get the IPFS resources address represented by the specific ENS, we can first find the mapping information stored as hex format before, extract the hex format to binary buffer, and finally turn that to IPFS Base58 address string.</p>

<h2 id="rationale">Rationale</h2>
<p>To implement the specification, need two methods from ENS public resolver contract, when we want to store IPFS file fingerprint to contract, convert the Base58 string identifier to the hex format and invoke the <code class="language-plaintext highlighter-rouge">setMultihash</code> method below :</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">setMultihash</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">node</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">hash</span><span class="p">)</span> <span class="k">public</span> <span class="n">only_owner</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</code></pre></div></div>

<p>Whenever users need to visit the ENS content, we call the <code class="language-plaintext highlighter-rouge">multihash</code> method to get the IPFS hex data, transfer to the Base58 format, and return the IPFS resources to use.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">multihash</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">node</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span><span class="p">);</span>
</code></pre></div></div>

<h2 id="test-cases">Test Cases</h2>

<p>To implement the way to transfer from base58 to hex format and the reverse one, using the ‘multihashes’ library to deal with the problem.<br />
The library link : <a href="https://www.npmjs.com/package/multihashes">https://www.npmjs.com/package/multihashes</a><br />
To implement the method transfer from IPFS(Base58) to hex format :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">multihash</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">multihashes</span><span class="dl">'</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">toHex</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ipfsHash</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">buf</span> <span class="o">=</span> <span class="nx">multihash</span><span class="p">.</span><span class="nx">fromB58String</span><span class="p">(</span><span class="nx">ipfsHash</span><span class="p">);</span>
  <span class="k">return</span> <span class="dl">'</span><span class="s1">0x</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">multihash</span><span class="p">.</span><span class="nx">toHexString</span><span class="p">(</span><span class="nx">buf</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>To implement the method transfer from hex format to IPFS(Base58) :</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nx">multihash</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">multihashes</span><span class="dl">'</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">toBase58</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">contentHash</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">hex</span> <span class="o">=</span> <span class="nx">contentHash</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
  <span class="kd">let</span> <span class="nx">buf</span> <span class="o">=</span> <span class="nx">multihash</span><span class="p">.</span><span class="nx">fromHexString</span><span class="p">(</span><span class="nx">hex</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">multihash</span><span class="p">.</span><span class="nx">toB58String</span><span class="p">(</span><span class="nx">buf</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="implementation">Implementation</h2>
<p>The use case can be implemented as browser extension. Users can easily download the extension, and easily get decentralized resources by just typing the ENS just like we normally type the DNS to browser the website. Solve the current pain for normal people can not easily visit the total decentralized website.</p>

<p>The workable implementation repository : <a href="https://github.com/PortalNetwork/portal-network-browser-extension">https://github.com/PortalNetwork/portal-network-browser-extension</a></p>

<h2 id="copyright">Copyright</h2>
<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
