<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Attestation management contract | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Attestation management contract | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-1386" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-1386" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Attestation management contract</h1>
  </header>

  <div class="post-content">
    <h3 id="introduction">Introduction</h3>

<p>Very often, we will need to use Attestations like “Alice lives in Australia” on the blockchain; that is issued by a valid issuer off chain for privacy reasons and is revokable inside a smart contract.</p>

<p>An issuer can create a smart contract where he revokes multiple attestations in one go by building a bloom filter of all the hashes of the revoked attestations.</p>

<p>An issuer can also put the validation method in their smart contract that can be called by other smart contracts who need to validate attestations issued by them. This allows each attestor to update their attestation format separately.</p>

<h3 id="purpose">Purpose</h3>

<p>This ERC provides an interface for attestation issuers to manage their attestation signing keys and the attestations that are issued off chain for actions such as revocation and validation.</p>

<p>In our draft implementation we include functions to hold cryptographic attestations, change the issuing contracts of attestations, revoke attestations and verify the authenticity of a cryptographic attestation.</p>

<h3 id="example-use-cases">Example use cases</h3>

<p>Let’s say that our friend, Alice, wants to buy a bottle of wine to consume with her friends. She wants to do the order online and have it delivered to her home address whilst paying for it with Ether.</p>

<p>Alice has a cryptographic attestation from her local road and maritime services who attests to her age, date of birth, country of residence and ability to drive.</p>

<p>Alice is able to split up this attestation (see merkle tree attestations ERC <a href="https://github.com/alpha-wallet/blockchain-attestation/blob/master/ethereum/lib/MerkleTreeAttestation.sol">here</a>) and provides only the leaf that states she is over the age of 21.</p>

<p>Alice goes to buy the wine through the wine vendors smart contract and feeds in the merkle tree attestation proving that she is above 21 and can thus buy the wine, whilst attaching the appropriate amount of ether to complete the purchase.</p>

<p>The issuer smart contract is able to validate her attestation, check that the issuer contract is valid and capable of performing such an attestation to her age. In this case it would have to be from someone like a driver’s licence authority, as attestations to age from a school ID are not of a high enough capacity.</p>

<p>The wine vendors smart contract validates the attestation, checks the payment amount is correct and credits Alice with the wine tokens she needs to complete the sale and deliver the wine.</p>

<p>When the wine vendor shows up to her apartment with the wine, there is no need to prove her age again.</p>

<h3 id="draft-interface">Draft interface</h3>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/* each attestation issuer should provide their own verify() for the
 * attestations they issued. There are two reasons for this. First, we
 * need to leave room for new attestation methods other than the
 * Merkle Tree format we are recommending. Second, the validity of the
 * attestation may depend on the context that only the attestor
 * knows. For example, a ticket as an attestation issued on a
 * successful redemption of an American Express credit */</span>

<span class="k">contract</span> <span class="n">Issuer</span> <span class="p">{</span>
  <span class="k">struct</span> <span class="n">Attestation</span>
    <span class="p">{</span>
        <span class="kt">bytes32</span><span class="p">[]</span> <span class="n">merklePath</span><span class="p">;</span>
        <span class="kt">bool</span> <span class="n">valid</span><span class="p">;</span>
        <span class="kt">uint8</span> <span class="n">v</span><span class="p">;</span>
        <span class="kt">bytes32</span> <span class="n">r</span><span class="p">;</span>
        <span class="kt">bytes32</span> <span class="n">s</span><span class="p">;</span>
        <span class="kt">address</span> <span class="n">attestor</span><span class="p">;</span>
        <span class="kt">address</span> <span class="n">recipient</span><span class="p">;</span>
        <span class="kt">bytes32</span> <span class="n">salt</span><span class="p">;</span>
        <span class="kt">bytes32</span> <span class="n">key</span><span class="p">;</span>
        <span class="kt">bytes32</span> <span class="n">val</span><span class="p">;</span>
    <span class="p">}</span><span class="err">`</span>
  <span class="cm">/* Verify the authenticity of an attestation */</span>
  <span class="k">function</span> <span class="n">verify</span><span class="p">(</span><span class="n">Attestation</span> <span class="n">attestation</span><span class="p">);</span>
  <span class="k">function</span> <span class="n">addattestorKey</span><span class="p">(</span><span class="kt">address</span> <span class="n">newAttestor</span><span class="p">,</span> <span class="kt">string</span> <span class="n">capacity</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">expiry</span><span class="p">);</span>

  <span class="cm">/* this should call the revoke first */</span>
  <span class="k">function</span> <span class="n">replaceKey</span><span class="p">(</span><span class="kt">address</span> <span class="n">attestorToReplace</span><span class="p">,</span> <span class="kt">string</span> <span class="n">capacity</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">expiry</span><span class="p">,</span> <span class="kt">address</span> <span class="n">newAttestor</span><span class="p">);</span>

  <span class="cm">/* this revokes a single key */</span>
  <span class="k">function</span> <span class="n">removeKey</span><span class="p">(</span><span class="kt">address</span> <span class="n">attestor</span><span class="p">);</span>

  <span class="cm">/* if the key exists with such capacity and isn't revoked or expired */</span>
  <span class="k">function</span> <span class="n">validateKey</span><span class="p">(</span><span class="kt">address</span> <span class="n">attestor</span><span class="p">,</span> <span class="kt">string</span> <span class="n">capacity</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

  <span class="cm">/* revoke an attestation by replace the bloom filter, this helps preserve privacy */</span>
  <span class="k">function</span> <span class="n">revokeAttestations</span><span class="p">(</span><span class="n">Bloomfilter</span> <span class="n">b</span><span class="p">);</span>

<span class="p">}</span>
</code></pre></div></div>

<p>Please click <a href="https://github.com/alpha-wallet/blockchain-attestation/blob/master/ethereum/example-james-squire/james-squire.sol">here</a> to see a draft implementation of this interface</p>

<h3 id="related-ercs">Related ERC’s</h3>
<p>#1388 #1387</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
