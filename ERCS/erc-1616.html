<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Attribute Registry Standard | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Attribute Registry Standard | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-1616" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-1616" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Attribute Registry Standard</h1>
  </header>

  <div class="post-content">
    <h2 id="simple-summary">Simple Summary</h2>
<p>EIP-1616 provides a basic interface for querying a registry for attribute metadata assigned to Ethereum accounts.</p>

<h2 id="abstract">Abstract</h2>
<p>This EIP contains the following core ideas:</p>
<ol>
  <li>Instead of relying directly on the reputation of a claims issuer to assess the veracity of a given claim, trust can be brought up to the level of a registry curator. This registry which we call an “<strong>Attribute Registry</strong>” allows for reduced complexity in implementation since a party needing to verify an attribute can now work with a trusted claims aggregator instead of relying on individual claim providers.</li>
  <li>Claims are abstracted as standard “attributes” which represent metadata assigned to an account, with claims decoupled from the issuing party. Attributes are registered as a flat <code class="language-plaintext highlighter-rouge">uint256 -&gt; uint256</code> key-value pair on each account, with the important property that <strong>each attribute type has one canonical value per address</strong>. This property allows for composability of attribute registries and advanced attribute formation.</li>
  <li>There is a generic method for determining the set of attribute keys or IDs made available by the registry. The standard does not specify requirements or recommendations for how attributes and their values are managed, or what additional metadata may be associated with attributes. It is likely that a standard set of attribute names and metadata schema could be proposed in a separate EIP.</li>
</ol>

<p>Potential advanced uses of attribute registries include:</p>
<ul>
  <li>Encoding complex boolean expressions which combine multiple attributes into a single uint256 key, which is then parsed and evaluated by the registry logic.</li>
  <li>Using values associated with an attribute to query additional on-chain or off-chain metadata.</li>
  <li>Resolving attribute values by calling into separate attribute registries or other contracts, delegating authority without changing the interface of the registry.</li>
</ul>

<h2 id="motivation">Motivation</h2>
<p>This EIP is motivated by the need for contracts and external accounts to be able to verify information about a given address from a single trusted source <strong>without concerning themselves with the particular details of how the information was obtained</strong>, and to do so in as simple a manner as possible. It is also motivated by the desire to promote broad <strong>cross-compatibility and composability</strong> between attribute registries, a property which is amplified by both the simplicity of the interface as well as by the guarantees on uniqueness provided by the proposed standard.</p>

<p>Existing EIPs for assigning metadata to an account include EIP-735 and EIP-780, which both allow for multiple claims to be issued on the same address for any given claim topic. This forces verifiers of said metadata to assess the veracity of each claim, taking into account the relative reputation of each claim issuer. It also prescribes a methodology for adding and removing claims, which may not be appropriate for all use cases.</p>

<p>This EIP proposes a light-weight abstraction layer for a standard account metadata registry interface. This abstraction layer can sit on top of claims registries like EIP-735 and EIP-780 or others as the attribute registry curator selects trusted data sources.</p>

<h2 id="specification">Specification</h2>
<p>The Attribute Registry interface contains four functions, outlined as follows:</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @title EIP-1616 Attribute Registry Standard interface. EIP-165 ID: 0x5f46473f
 */</span>
<span class="k">interface</span> <span class="n">AttributeRegistryInterface</span> <span class="p">{</span>
  <span class="k">function</span> <span class="n">hasAttribute</span><span class="p">(</span><span class="kt">address</span> <span class="n">account</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">attributeTypeID</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
  <span class="k">function</span> <span class="n">getAttributeValue</span><span class="p">(</span><span class="kt">address</span> <span class="n">account</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">attributeTypeID</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>
  <span class="k">function</span> <span class="n">countAttributeTypes</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>
  <span class="k">function</span> <span class="n">getAttributeTypeID</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">index</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Contracts that comply with the Attribute Registry EIP MUST implement the above interface.</p>

<p>As an additional requirement, the ERC-165 interface MUST be included:</p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @title EIP-165 interface. EIP-165 ID: 0x01ffc9a7
 */</span>
<span class="k">interface</span> <span class="n">EIP</span><span class="o">-</span><span class="mi">165</span> <span class="p">{</span>
  <span class="cm">/**
   * @notice EIP-165 support. Attribute Registry interface ID is 0x5f46473f.
   * @param _interfaceID The interface identifier, as specified in EIP-165
   * @return True for 0x01ffc9a7 &amp; 0x5f46473f, false for unsupported interfaces.
   */</span>
  <span class="k">function</span> <span class="n">supportsInterface</span><span class="p">(</span><span class="kt">bytes4</span> <span class="n">_interfaceID</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The implementation MUST follow the specifications described below.</p>

<h3 id="view-functions">View Functions</h3>
<p>The view functions detailed below MUST be implemented.</p>

<h4 id="hasattribute-function"><code class="language-plaintext highlighter-rouge">hasAttribute</code> function</h4>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">hasAttribute</span><span class="p">(</span><span class="kt">address</span> <span class="n">account</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">attributeTypeID</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
</code></pre></div></div>

<p>Check if an attribute has been assigned to a given account on the registry and is currently valid.</p>

<p><em><strong>NOTE</strong></em>: This function MUST return either true or false - i.e. calling this function MUST NOT cause the caller to revert. Implementations that wish to call into another contract during execution of this function MUST catch any <code class="language-plaintext highlighter-rouge">revert</code> and instead return <code class="language-plaintext highlighter-rouge">false</code>.</p>

<p><em><strong>NOTE</strong></em>: This function MUST return two equal values when performing two directly consecutive function calls with identical <code class="language-plaintext highlighter-rouge">account</code> and <code class="language-plaintext highlighter-rouge">attributeTypeID</code> parameters, regardless of differences in the caller’s address, the transaction origin, or other out-of-band information.</p>

<h4 id="getattributevalue-function"><code class="language-plaintext highlighter-rouge">getAttributeValue</code> function</h4>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">getAttributeValue</span><span class="p">(</span><span class="kt">address</span> <span class="n">account</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">attributeTypeID</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span>
</code></pre></div></div>

<p>Retrieve the <code class="language-plaintext highlighter-rouge">uint256</code> value of an attribute on a given account on the registry, assuming the attribute is currently valid.</p>

<p><em><strong>NOTE</strong></em>: This function MUST revert if a directly preceding or subsequent function call to <code class="language-plaintext highlighter-rouge">hasAttribute</code> with identical <code class="language-plaintext highlighter-rouge">account</code> and <code class="language-plaintext highlighter-rouge">attributeTypeID</code> parameters would return false.</p>

<p><em><strong>NOTE</strong></em>: This function MUST return two equal values when performing two directly consecutive function calls with identical <code class="language-plaintext highlighter-rouge">account</code> and <code class="language-plaintext highlighter-rouge">attributeTypeID</code> parameters, regardless of differences in the caller’s address, the transaction origin, or other out-of-band information.</p>

<h4 id="countattributetypes-function"><code class="language-plaintext highlighter-rouge">countAttributeTypes</code> function</h4>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">countAttributeTypes</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span>
</code></pre></div></div>

<p>Retrieve the total number of valid attribute types defined on the registry. Used alongside <code class="language-plaintext highlighter-rouge">getAttributeTypeID</code> to determine all of the attribute types that are available on the registry.</p>

<p><em><strong>NOTE</strong></em>: This function MUST return a positive integer value  - i.e. calling this function MUST NOT cause the caller to revert.</p>

<p><em><strong>NOTE</strong></em>: This function MUST return a value that encompasses all indexes of attribute type IDs whereby a call to <code class="language-plaintext highlighter-rouge">hasAttribute</code> on some address with an attribute type ID at the given index would return <code class="language-plaintext highlighter-rouge">true</code>.</p>

<h4 id="getattributetypeid-function"><code class="language-plaintext highlighter-rouge">getAttributeTypeID</code> function</h4>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">getAttributeTypeID</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">index</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span>
</code></pre></div></div>

<p>Retrieve an ID of an attribute type defined on the registry by index. Used alongside <code class="language-plaintext highlighter-rouge">countAttributeTypes</code> to determine all of the attribute types that are available on the registry.</p>

<p><em><strong>NOTE</strong></em>: This function MUST revert if the provided <code class="language-plaintext highlighter-rouge">index</code> value falls outside of the range of the value returned from a directly preceding or subsequent function call to <code class="language-plaintext highlighter-rouge">countAttributeTypes</code>. It MUST NOT revert if the provided <code class="language-plaintext highlighter-rouge">index</code> value falls inside said range.</p>

<p><em><strong>NOTE</strong></em>: This function MUST return an <code class="language-plaintext highlighter-rouge">attributeTypeID</code> value on <em>some</em> index if the same <code class="language-plaintext highlighter-rouge">attributeTypeID</code> value would cause a given call to <code class="language-plaintext highlighter-rouge">hasAttribute</code> to return <code class="language-plaintext highlighter-rouge">true</code> when passed as a parameter.</p>

<h2 id="rationale">Rationale</h2>
<p>This standard extends the applicability of metadata assignment to those use cases that are not adequately represented by EIP-735, EIP-780, or similar proposals. Namely, it enforces the constraint of one attribute value per attribute ID per address, as opposed to one value per ID per address <em>per issuer</em>.</p>

<p>Aside from the prescribed attribute value, attribute properties are deliberately omitted from the standard. While many attribute registries will require additional metadata on attributes at both the instance and the class level, reliable and flexible interoperability between highly variable registry extensions is facilitated more effectively by enforcing a widely-applicable base layer for attributes.</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>
<p>There are no backwards compatibility concerns.</p>

<h2 id="test-cases">Test Cases</h2>
<p>Targeted test cases with 100% code coverage can be found at <a href="https://github.com/0age/AttributeRegistry">this repository</a>. See <a href="https://github.com/TPL-protocol/tpl-contracts">here</a> for tests on a more complex contract that implements the application registry interface.</p>

<h2 id="implementation">Implementation</h2>
<p>The basic implementation that follows can be found at <a href="https://github.com/0age/AttributeRegistry">this repository</a> (see <a href="https://github.com/TPL-protocol/tpl-contracts/blob/master/contracts/BasicJurisdiction.sol#L399">here</a> for an example of a more complex implementing contract):</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.4</span><span class="p">.</span><span class="mi">25</span><span class="p">;</span>

<span class="cm">/**
 * @title Attribute Registry interface. EIP-165 ID: 0x5f46473f
 */</span>
<span class="k">interface</span> <span class="n">AttributeRegistryInterface</span> <span class="p">{</span>
  <span class="cm">/**
   * @notice Check if an attribute of the type with ID `attributeTypeID` has
   * been assigned to the account at `account` and is currently valid.
   * @param account address The account to check for a valid attribute.
   * @param attributeTypeID uint256 The ID of the attribute type to check for.
   * @return True if the attribute is assigned and valid, false otherwise.
   * @dev This function MUST return either true or false - i.e. calling this
   * function MUST NOT cause the caller to revert.
   */</span>
  <span class="k">function</span> <span class="n">hasAttribute</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">account</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">attributeTypeID</span>
  <span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

  <span class="cm">/**
   * @notice Retrieve the value of the attribute of the type with ID
   * `attributeTypeID` on the account at `account`, assuming it is valid.
   * @param account address The account to check for the given attribute value.
   * @param attributeTypeID uint256 The ID of the attribute type to check for.
   * @return The attribute value if the attribute is valid, reverts otherwise.
   * @dev This function MUST revert if a directly preceding or subsequent
   * function call to `hasAttribute` with identical `account` and
   * `attributeTypeID` parameters would return false.
   */</span>
  <span class="k">function</span> <span class="n">getAttributeValue</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">account</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">attributeTypeID</span>
  <span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>

  <span class="cm">/**
   * @notice Count the number of attribute types defined by the registry.
   * @return The number of available attribute types.
   * @dev This function MUST return a positive integer value  - i.e. calling
   * this function MUST NOT cause the caller to revert.
   */</span>
  <span class="k">function</span> <span class="n">countAttributeTypes</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>

  <span class="cm">/**
   * @notice Get the ID of the attribute type at index `index`.
   * @param index uint256 The index of the attribute type in question.
   * @return The ID of the attribute type.
   * @dev This function MUST revert if the provided `index` value falls outside
   * of the range of the value returned from a directly preceding or subsequent
   * function call to `countAttributeTypes`. It MUST NOT revert if the provided
   * `index` value falls inside said range.
   */</span>
  <span class="k">function</span> <span class="n">getAttributeTypeID</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">index</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>
<span class="p">}</span>


<span class="cm">/**
 * @title A simple example of an Attribute Registry implementation.
 */</span>
<span class="k">contract</span> <span class="n">AttributeRegistry</span> <span class="k">is</span> <span class="n">AttributeRegistryInterface</span> <span class="p">{</span>
  <span class="c1">// This particular implementation just defines two attribute types.
</span>  <span class="k">enum</span> <span class="n">Affiliation</span> <span class="p">{</span> <span class="n">Whitehat</span><span class="p">,</span> <span class="n">Blackhat</span> <span class="p">}</span>

  <span class="c1">// Top-level information about attribute types held in a static array.
</span>  <span class="kt">uint256</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">private</span> <span class="n">_attributeTypeIDs</span><span class="p">;</span>

  <span class="c1">// The number of attributes currently issued tracked in a static array.
</span>  <span class="kt">uint256</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">private</span> <span class="n">_issuedAttributeCounters</span><span class="p">;</span>

  <span class="c1">// Issued attributes held in a nested mapping by account &amp; attribute type.
</span>  <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">uint256</span> <span class="o">=&gt;</span> <span class="kt">bool</span><span class="p">))</span> <span class="k">private</span> <span class="n">_issuedAttributes</span><span class="p">;</span>

  <span class="c1">// Issued attribute values held in a nested mapping by account &amp; type.
</span>  <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="k">mapping</span><span class="p">(</span><span class="kt">uint256</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">))</span> <span class="k">private</span> <span class="n">_issuedAttributeValues</span><span class="p">;</span>

  <span class="cm">/**
  * @notice The constructor function, defines the two attribute types available
  * on this particular registry.
  */</span>
  <span class="k">constructor</span><span class="p">()</span> <span class="k">public</span> <span class="p">{</span>
    <span class="c1">// Set the attribute type IDs for whitehats (8008) and blackhats (1337).
</span>    <span class="n">_attributeTypeIDs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">8008</span><span class="p">,</span> <span class="mi">1337</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="cm">/**
   * @notice Assign a "whitehat" attribute type to `msg.sender`.
   * @dev The function may not be called by accounts with a "blackhat" attribute
   * type already assigned. This function is arbitrary and not part of the
   * Attribute Registry specification.
   */</span>
  <span class="k">function</span> <span class="n">joinWhitehats</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
    <span class="c1">// Get the index of the blackhat attribute type on the attribute registry.
</span>    <span class="kt">uint256</span> <span class="n">blackhatIndex</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="n">Affiliation</span><span class="p">.</span><span class="n">Blackhat</span><span class="p">);</span>

    <span class="c1">// Get the attribute type ID of the blackhat attribute type.
</span>    <span class="kt">uint256</span> <span class="n">blackhatAttributeTypeID</span> <span class="o">=</span> <span class="n">_attributeTypeIDs</span><span class="p">[</span><span class="n">blackhatIndex</span><span class="p">];</span>

    <span class="c1">// Do not allow the whitehat attribute to be set if blackhat is already set.
</span>    <span class="nb">require</span><span class="p">(</span>
      <span class="o">!</span><span class="n">_issuedAttributes</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">blackhatAttributeTypeID</span><span class="p">],</span>
      <span class="s">"no blackhats allowed!"</span>
    <span class="p">);</span>

    <span class="c1">// Get the index of the whitehat attribute type on the attribute registry.
</span>    <span class="kt">uint256</span> <span class="n">whitehatIndex</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="n">Affiliation</span><span class="p">.</span><span class="n">Whitehat</span><span class="p">);</span>

    <span class="c1">// Get the attribute type ID of the whitehat attribute type.
</span>    <span class="kt">uint256</span> <span class="n">whitehatAttributeTypeID</span> <span class="o">=</span> <span class="n">_attributeTypeIDs</span><span class="p">[</span><span class="n">whitehatIndex</span><span class="p">];</span>

    <span class="c1">// Mark the attribute as issued on the given address.
</span>    <span class="n">_issuedAttributes</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">whitehatAttributeTypeID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

    <span class="c1">// Calculate the new number of total whitehat attributes.
</span>    <span class="kt">uint256</span> <span class="n">incrementCounter</span> <span class="o">=</span> <span class="n">_issuedAttributeCounters</span><span class="p">[</span><span class="n">whitehatIndex</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Set the attribute value to the new total assigned whitehat attributes.
</span>    <span class="n">_issuedAttributeValues</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">whitehatAttributeTypeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">incrementCounter</span><span class="p">;</span>

    <span class="c1">// Update the value of the counter for total whitehat attributes.
</span>    <span class="n">_issuedAttributeCounters</span><span class="p">[</span><span class="n">whitehatIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">incrementCounter</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**
   * @notice Assign a "blackhat" attribute type to `msg.sender`.
   * @dev The function may be called by any account, but assigned "whitehat"
   * attributes will be removed. This function is arbitrary and not part of the
   * Attribute Registry specification.
   */</span>
  <span class="k">function</span> <span class="n">joinBlackhats</span><span class="p">()</span> <span class="k">external</span> <span class="p">{</span>
    <span class="c1">// Get the index of the blackhat attribute type on the attribute registry.
</span>    <span class="kt">uint256</span> <span class="n">blackhatIndex</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="n">Affiliation</span><span class="p">.</span><span class="n">Blackhat</span><span class="p">);</span>

    <span class="c1">// Get the attribute type ID of the blackhat attribute type.
</span>    <span class="kt">uint256</span> <span class="n">blackhatAttributeTypeID</span> <span class="o">=</span> <span class="n">_attributeTypeIDs</span><span class="p">[</span><span class="n">blackhatIndex</span><span class="p">];</span>

    <span class="c1">// Mark the attribute as issued on the given address.    
</span>    <span class="n">_issuedAttributes</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">blackhatAttributeTypeID</span><span class="p">]</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>

    <span class="c1">// Calculate the new number of total blackhat attributes.    
</span>    <span class="kt">uint256</span> <span class="n">incrementCounter</span> <span class="o">=</span> <span class="n">_issuedAttributeCounters</span><span class="p">[</span><span class="n">blackhatIndex</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

    <span class="c1">// Set the attribute value to the new total assigned blackhat attributes.    
</span>    <span class="n">_issuedAttributeValues</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">blackhatAttributeTypeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">incrementCounter</span><span class="p">;</span>

    <span class="c1">// Update the value of the counter for total blackhat attributes.    
</span>    <span class="n">_issuedAttributeCounters</span><span class="p">[</span><span class="n">blackhatIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">incrementCounter</span><span class="p">;</span>

    <span class="c1">// Get the index of the whitehat attribute type on the attribute registry.
</span>    <span class="kt">uint256</span> <span class="n">whitehatIndex</span> <span class="o">=</span> <span class="kt">uint256</span><span class="p">(</span><span class="n">Affiliation</span><span class="p">.</span><span class="n">Whitehat</span><span class="p">);</span>

    <span class="c1">// Get the attribute type ID of the whitehat attribute type.
</span>    <span class="kt">uint256</span> <span class="n">whitehatAttributeTypeID</span> <span class="o">=</span> <span class="n">_attributeTypeIDs</span><span class="p">[</span><span class="n">whitehatIndex</span><span class="p">];</span>

    <span class="c1">// Determine if a whitehat attribute type has been assigned.
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">_issuedAttributes</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">whitehatAttributeTypeID</span><span class="p">])</span> <span class="p">{</span>
      <span class="c1">// If so, delete the attribute.
</span>      <span class="k">delete</span> <span class="n">_issuedAttributes</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">whitehatAttributeTypeID</span><span class="p">];</span>

      <span class="c1">// Delete the attribute value as well.
</span>      <span class="k">delete</span> <span class="n">_issuedAttributeValues</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">][</span><span class="n">whitehatAttributeTypeID</span><span class="p">];</span>

      <span class="c1">// Set the attribute value to the new total assigned whitehat attributes.      
</span>      <span class="kt">uint256</span> <span class="n">decrementCounter</span> <span class="o">=</span> <span class="n">_issuedAttributeCounters</span><span class="p">[</span><span class="n">whitehatIndex</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

      <span class="c1">// Update the value of the counter for total whitehat attributes.
</span>      <span class="n">_issuedAttributeCounters</span><span class="p">[</span><span class="n">whitehatIndex</span><span class="p">]</span> <span class="o">=</span> <span class="n">decrementCounter</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>

  <span class="cm">/**
   * @notice Get the total number of assigned whitehat and blackhat attributes.
   * @return Array with counts of assigned whitehat and blackhat attributes.
   * @dev This function is arbitrary and not part of the Attribute Registry
   * specification.
   */</span>
  <span class="k">function</span> <span class="n">totalHats</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="p">{</span>
    <span class="c1">// Return the array containing counter values.
</span>    <span class="k">return</span> <span class="n">_issuedAttributeCounters</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**
   * @notice Check if an attribute of the type with ID `attributeTypeID` has
   * been assigned to the account at `account` and is currently valid.
   * @param account address The account to check for a valid attribute.
   * @param attributeTypeID uint256 The ID of the attribute type to check for.
   * @return True if the attribute is assigned and valid, false otherwise.
   * @dev This function MUST return either true or false - i.e. calling this
   * function MUST NOT cause the caller to revert.
   */</span>
  <span class="k">function</span> <span class="n">hasAttribute</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">account</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">attributeTypeID</span>
  <span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Return assignment status of attribute by account and attribute type ID
</span>    <span class="k">return</span> <span class="n">_issuedAttributes</span><span class="p">[</span><span class="n">account</span><span class="p">][</span><span class="n">attributeTypeID</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="cm">/**
   * @notice Retrieve the value of the attribute of the type with ID
   * `attributeTypeID` on the account at `account`, assuming it is valid.
   * @param account address The account to check for the given attribute value.
   * @param attributeTypeID uint256 The ID of the attribute type to check for.
   * @return The attribute value if the attribute is valid, reverts otherwise.
   * @dev This function MUST revert if a directly preceding or subsequent
   * function call to `hasAttribute` with identical `account` and
   * `attributeTypeID` parameters would return false.
   */</span>
  <span class="k">function</span> <span class="n">getAttributeValue</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">account</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">attributeTypeID</span>
  <span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Revert if attribute with given account &amp; attribute type ID is unassigned
</span>    <span class="nb">require</span><span class="p">(</span>
      <span class="n">_issuedAttributes</span><span class="p">[</span><span class="n">account</span><span class="p">][</span><span class="n">attributeTypeID</span><span class="p">],</span>
      <span class="s">"could not find a value with the provided account and attribute type ID"</span>
    <span class="p">);</span>

    <span class="c1">// Return the attribute value.
</span>    <span class="k">return</span> <span class="n">_issuedAttributeValues</span><span class="p">[</span><span class="n">account</span><span class="p">][</span><span class="n">attributeTypeID</span><span class="p">];</span>
  <span class="p">}</span>

  <span class="cm">/**
   * @notice Count the number of attribute types defined by the registry.
   * @return The number of available attribute types.
   * @dev This function MUST return a positive integer value  - i.e. calling
   * this function MUST NOT cause the caller to revert.
   */</span>
  <span class="k">function</span> <span class="n">countAttributeTypes</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Return the length of the attribute type IDs array.
</span>    <span class="k">return</span> <span class="n">_attributeTypeIDs</span><span class="p">.</span><span class="n">length</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="cm">/**
   * @notice Get the ID of the attribute type at index `index`.
   * @param index uint256 The index of the attribute type in question.
   * @return The ID of the attribute type.
   * @dev This function MUST revert if the provided `index` value falls outside
   * of the range of the value returned from a directly preceding or subsequent
   * function call to `countAttributeTypes`. It MUST NOT revert if the provided
   * `index` value falls inside said range.
   */</span>
  <span class="k">function</span> <span class="n">getAttributeTypeID</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">index</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Revert if the provided index is out of range.
</span>    <span class="nb">require</span><span class="p">(</span>
      <span class="n">index</span> <span class="o">&lt;</span> <span class="n">_attributeTypeIDs</span><span class="p">.</span><span class="n">length</span><span class="p">,</span>
      <span class="s">"provided index is outside of the range of defined attribute type IDs"</span>
    <span class="p">);</span>

    <span class="c1">// Return the attribute type ID at the given index in the array.
</span>    <span class="k">return</span> <span class="n">_attributeTypeIDs</span><span class="p">[</span><span class="n">index</span><span class="p">];</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="copyright">Copyright</h2>
<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
