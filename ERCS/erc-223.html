<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Token with transaction handling model | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Token with transaction handling model | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-223" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-223" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Token with transaction handling model</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>The following describes an interface and logic for fungible tokens that supports a <code class="language-plaintext highlighter-rouge">tokenReceived</code> callback to notify contract recipients when tokens are received. This makes tokens behave identical to ether.</p>

<h2 id="motivation">Motivation</h2>

<p>This token introduces a communication model for contracts that can be utilized to straighten the behavior of contracts that interact with such tokens. Specifically, this proposal:</p>

<ol>
  <li>Informs receiving contracts of incoming token transfers, as opposed to <a href="./eip-20.md">ERC-20</a> where the recipient of a token transfer gets no notification.</li>
  <li>Is more gas-efficient when depositing tokens to contracts.</li>
  <li>Allows for <code class="language-plaintext highlighter-rouge">_data</code> recording for financial transfers.</li>
</ol>

<h2 id="specification">Specification</h2>

<p>Contracts intending to receive these tokens MUST implement <code class="language-plaintext highlighter-rouge">tokenReceived</code>.</p>

<p>Token transfers to contracts not implementing <code class="language-plaintext highlighter-rouge">tokenReceived</code> as described below MUST revert.</p>

<h3 id="token-contract">Token contract</h3>

<h4 id="token-methods">Token Methods</h4>

<h5 id="totalsupply"><code class="language-plaintext highlighter-rouge">totalSupply</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">totalSupply</span><span class="p">()</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span>
</code></pre></div></div>

<p>Returns the total supply of the token. The functionality of this method is identical to that of ERC-20.</p>

<h5 id="name"><code class="language-plaintext highlighter-rouge">name</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">name</span><span class="p">()</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">string</span> <span class="k">memory</span><span class="p">)</span>
</code></pre></div></div>

<p>Returns the name of the token.  The functionality of this method is identical to that of ERC-20.</p>

<p>OPTIONAL - This method can be used to improve usability, but interfaces and other contracts MUST NOT expect these values to be present.</p>

<h5 id="symbol"><code class="language-plaintext highlighter-rouge">symbol</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">symbol</span><span class="p">()</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">string</span> <span class="k">memory</span><span class="p">)</span>
</code></pre></div></div>

<p>Returns the symbol of the token. The functionality of this method is identical to that of ERC-20.</p>

<p>OPTIONAL - This method can be used to improve usability, but interfaces and other contracts MUST NOT expect these values to be present.</p>

<h5 id="decimals"><code class="language-plaintext highlighter-rouge">decimals</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">decimals</span><span class="p">()</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint8</span><span class="p">)</span>
</code></pre></div></div>

<p>Returns the number of decimals of the token. The functionality of this method is identical to that of ERC-20.</p>

<p>OPTIONAL - This method can be used to improve usability, but interfaces and other contracts MUST NOT expect these values to be present.</p>

<h5 id="balanceof"><code class="language-plaintext highlighter-rouge">balanceOf</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span>
</code></pre></div></div>

<p>Returns the account balance of another account with address <code class="language-plaintext highlighter-rouge">_owner</code>. The functionality of this method is identical to that of ERC-20.</p>

<h5 id="transferaddress-uint"><code class="language-plaintext highlighter-rouge">transfer(address, uint)</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
</code></pre></div></div>

<p>This function must transfer tokens, and if <code class="language-plaintext highlighter-rouge">_to</code> is a contract, it must call the <code class="language-plaintext highlighter-rouge">tokenReceived(address, uint256, bytes calldata)</code> function of <code class="language-plaintext highlighter-rouge">_to</code>. If the <code class="language-plaintext highlighter-rouge">tokenReceived</code> function is not implemented in <code class="language-plaintext highlighter-rouge">_to</code> (recipient contract), then the transaction must fail and the transfer of tokens must be reverted.
If <code class="language-plaintext highlighter-rouge">_to</code> is an externally owned address, then the transaction must be sent without executing <code class="language-plaintext highlighter-rouge">tokenReceived</code> in <code class="language-plaintext highlighter-rouge">_to</code>.
 <code class="language-plaintext highlighter-rouge">_data</code> can be attached to this token transaction, but it requires more gas. <code class="language-plaintext highlighter-rouge">_data</code> can be empty.</p>

<p>The <code class="language-plaintext highlighter-rouge">tokenReceived</code> function of <code class="language-plaintext highlighter-rouge">_to</code> MUST be called after all other operations to avoid re-entrancy attacks.</p>

<p>NOTE: If <code class="language-plaintext highlighter-rouge">transfer</code> function is <code class="language-plaintext highlighter-rouge">payable</code> and ether was deposited then the amount of deposited ether MUST be delivered to <code class="language-plaintext highlighter-rouge">_to</code> address alongside tokens. If ether was sent alongside tokens in this way then ether MUST be delivered first, then token balances must be updated, then <code class="language-plaintext highlighter-rouge">tokenReceived</code> function MUST be called in <code class="language-plaintext highlighter-rouge">_to</code> if it is a contract.</p>

<h5 id="transferaddress-uint-bytes"><code class="language-plaintext highlighter-rouge">transfer(address, uint, bytes)</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">_data</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
</code></pre></div></div>

<p>This function must transfer tokens and invoke the function <code class="language-plaintext highlighter-rouge">tokenReceived (address, uint256, bytes)</code> in <code class="language-plaintext highlighter-rouge">_to</code>, if <code class="language-plaintext highlighter-rouge">_to</code> is a contract. If the <code class="language-plaintext highlighter-rouge">tokenReceived</code> function is not implemented in <code class="language-plaintext highlighter-rouge">_to</code> (recipient contract), then the transaction must fail and the transfer of tokens must not occur. 
If <code class="language-plaintext highlighter-rouge">_to</code> is an externally owned address (determined by the code size being zero), then the transaction must be sent without executing <code class="language-plaintext highlighter-rouge">tokenReceived</code> in <code class="language-plaintext highlighter-rouge">_to</code>.
 <code class="language-plaintext highlighter-rouge">_data</code> can be attached to this token transaction, but it requires more gas. <code class="language-plaintext highlighter-rouge">_data</code> can be empty.</p>

<p>NOTE: A possible way to check whether the <code class="language-plaintext highlighter-rouge">_to</code> is a contract or an address is to assemble the code of <code class="language-plaintext highlighter-rouge">_to</code>. If there is no code in <code class="language-plaintext highlighter-rouge">_to</code>, then this is an externally owned address, otherwise it’s a contract. If <code class="language-plaintext highlighter-rouge">transfer</code> function is <code class="language-plaintext highlighter-rouge">payable</code> and ether was deposited then the amount of deposited ether MUST be delivered to <code class="language-plaintext highlighter-rouge">_to</code> address alongside tokens.</p>

<p>The <code class="language-plaintext highlighter-rouge">tokenReceived</code> function of <code class="language-plaintext highlighter-rouge">_to</code> MUST be called after all other operations to avoid re-entrancy attacks.</p>

<h4 id="events">Events</h4>

<h5 id="transfer"><code class="language-plaintext highlighter-rouge">Transfer</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">event</span> <span class="n">Transfer</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_value</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">_data</span><span class="p">)</span>
</code></pre></div></div>

<p>Triggered when tokens are transferred. Compatible with and similar to the ERC-20 <code class="language-plaintext highlighter-rouge">Transfer</code> event.</p>

<h3 id="erc-223-token-receiver"><a href="./eip-223.md">ERC-223</a> Token Receiver</h3>

<h4 id="receiver-methods">Receiver Methods</h4>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">tokenReceived</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">_data</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes4</span><span class="p">)</span>
</code></pre></div></div>

<p>A function for handling token transfers, which is called from the token contract, when a token holder sends tokens. <code class="language-plaintext highlighter-rouge">_from</code> is the address of the sender of the token, <code class="language-plaintext highlighter-rouge">_value</code> is the amount of incoming tokens, and <code class="language-plaintext highlighter-rouge">_data</code> is attached data similar to <code class="language-plaintext highlighter-rouge">msg.data</code> of ether transactions. It works by analogy with the fallback function of Ether transactions and returns nothing.</p>

<p>NOTE: <code class="language-plaintext highlighter-rouge">msg.sender</code> will be a token-contract inside the <code class="language-plaintext highlighter-rouge">tokenReceived</code> function. It may be important to filter which tokens were sent (by token-contract address). The token sender (the person who initiated the token transaction) will be <code class="language-plaintext highlighter-rouge">_from</code> inside the <code class="language-plaintext highlighter-rouge">tokenReceived</code> function. The <code class="language-plaintext highlighter-rouge">tokenReceived</code> function must return <code class="language-plaintext highlighter-rouge">0x8943ec02</code> after handling an incoming token transfer. The <code class="language-plaintext highlighter-rouge">tokenReceived</code> function call can be handled by the fallback function of the recipient contact (and in this case it may not return the magic value 0x8943ec02).</p>

<p>IMPORTANT: This function must be named <code class="language-plaintext highlighter-rouge">tokenReceived</code> and take parameters <code class="language-plaintext highlighter-rouge">address</code>, <code class="language-plaintext highlighter-rouge">uint256</code>, <code class="language-plaintext highlighter-rouge">bytes</code> to match the function signature <code class="language-plaintext highlighter-rouge">0x8943ec02</code>. This function can be manually called by a EOA.</p>

<h2 id="rationale">Rationale</h2>

<p>This standard introduces a communication model by enforcing the <code class="language-plaintext highlighter-rouge">transfer</code> to execute a handler function in the destination address. This is an important security consideration as it is required that the receiver explicitly implements the token handling function. In cases where the receiver does not implements such function the transfer MUST be reverted.</p>

<p>This standard sticks to the push transaction model where the transfer of assets is initiated on the senders side and handled on the receivers side. As the result, ERC-223 transfers are more gas-efficient while dealing with depositing to contracts as ERC-223 tokens can be deposited with just one transaction while ERC-20 tokens require at least two calls (one for <code class="language-plaintext highlighter-rouge">approve</code> and the second that will invoke <code class="language-plaintext highlighter-rouge">transferFrom</code>).</p>

<ul>
  <li>
    <p><a href="./eip-20.md">ERC-20</a> deposit: <code class="language-plaintext highlighter-rouge">approve</code> ~46 gas, <code class="language-plaintext highlighter-rouge">transferFrom</code> ~75K gas</p>
  </li>
  <li>
    <p>ERC-223 deposit: <code class="language-plaintext highlighter-rouge">transfer</code> and handling on the receivers side ~54K gas</p>
  </li>
</ul>

<p>This standard introduces the ability to correct user errors by allowing to handle ANY transactions on the recipients side and reject incorrect or improper transfers. This tokens utilize ONE transferring method for both types of interactions with contracts and externally owned addresses which can simplify the user experience and allow to avoid possible user mistakes.</p>

<p>One downside of the commonly used <a href="./eip-20.md">ERC-20</a> standard that ERC-223 is intended to solve is that <a href="./eip-20.md">ERC-20</a> implements two methods of token transferring: (1) <code class="language-plaintext highlighter-rouge">transfer</code> function and (2) <code class="language-plaintext highlighter-rouge">approve + transferFrom</code> pattern. Transfer function of <a href="./eip-20.md">ERC-20</a> standard does not notify the receiver and therefore if any tokens are sent to a contract with the <code class="language-plaintext highlighter-rouge">transfer</code> function then the receiver will not recognize this transfer and the tokens can become stuck in the receivers address without any possibility of recovering them. <a href="./eip-20.md">ERC-20</a> standard places the burden of determining the transferring method on the user and if the incorrect method is chosen the user can lose the transferred tokens. ERC-223 automatically determines the transferring method, preventing the user from losing tokens due to chosing wrong method.</p>

<p>ERC-223 is intended to simplify the interaction with contracts that are intended to work with tokens. ERC-223 utilizes a “deposit” pattern, similar to that of plain Ether. An ERC-223 deposit to a contract is a simple call of the <code class="language-plaintext highlighter-rouge">transfer</code> function. This is one transaction as opposed to two step process of <code class="language-plaintext highlighter-rouge">approve + transferFrom</code> depositing.</p>

<p>This standard allows payloads to be attached to transactions using the <code class="language-plaintext highlighter-rouge">bytes calldata _data</code> parameter, which can encode a second function call in the destination address, similar to how <code class="language-plaintext highlighter-rouge">msg.data</code> does in an ether transaction, or allow for public logging on chain should it be necessary for financial transactions.</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>The interface of this token is similar to that of ERC-20 and most functions serve the same purpose as their analogues in ERC-20. 
<code class="language-plaintext highlighter-rouge">transfer(address, uint256, bytes calldata)</code> function is not backwards compatible with ERC-20 interface.</p>

<p>ERC-20 tokens can be delivered to a non-contract address with <code class="language-plaintext highlighter-rouge">transfer</code> function. ERC-20 tokens can be deposited to a contract address with <code class="language-plaintext highlighter-rouge">approve</code> + <code class="language-plaintext highlighter-rouge">transferFrom</code> pattern. Depositing ERC-20 tokens to the contract address with <code class="language-plaintext highlighter-rouge">transfer</code> function will always result in token deposit not being recognized by the recipient contract.</p>

<p>Here is an example of the contract code that handles ERC-20 token deposit. The following contract can accepts <code class="language-plaintext highlighter-rouge">tokenA</code> deposits. It is impossible to prevent deposits of non-tokenA to this contract. If tokenA is deposited with <code class="language-plaintext highlighter-rouge">transfer</code> function then it will result in a loss of tokens for the depositor because the balance of the user will be decreased in the contract of tokenA but the value of <code class="language-plaintext highlighter-rouge">deposits</code> variable in the <code class="language-plaintext highlighter-rouge">ERC20Receiver</code> will not be increased i.e. the deposit will not be credited. As of 5/9/2023 <strong>$201M worth of 50 examined ERC-20 tokens are already lost</strong> in this way on Ethereum mainnet.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">ERC20Receiver</span>
<span class="p">{</span>
    <span class="kt">address</span> <span class="n">tokenA</span><span class="p">;</span>
    <span class="k">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="n">deposits</span><span class="p">;</span>
    <span class="k">function</span> <span class="n">deposit</span><span class="p">(</span><span class="kt">uint</span> <span class="n">_value</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_token</span><span class="p">)</span> <span class="k">public</span>
    <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">_token</span> <span class="o">==</span> <span class="n">tokenA</span><span class="p">);</span>
        <span class="n">IERC20</span><span class="p">(</span><span class="n">_token</span><span class="p">).</span><span class="n">transferFrom</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">_value</span><span class="p">);</span>
        <span class="n">deposits</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_value</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ERC-223 tokens must be delivered to non-contract address or contract address in the same way with <code class="language-plaintext highlighter-rouge">transfer</code> function.</p>

<p>Here is an example of the contract code that handles ERC-223 token deposit. The following contract can filter tokens and only accepts <code class="language-plaintext highlighter-rouge">tokenA</code>. Other ERC-223 tokens would be rejected.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">ERC223Receiver</span>
<span class="p">{</span>
    <span class="kt">address</span> <span class="n">tokenA</span><span class="p">;</span>
    <span class="k">mapping</span> <span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="n">deposits</span><span class="p">;</span>
    <span class="k">function</span> <span class="n">tokenReceived</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">_data</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes4</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span> <span class="o">==</span> <span class="n">tokenA</span><span class="p">);</span>
        <span class="n">deposits</span><span class="p">[</span><span class="n">_from</span><span class="p">]</span> <span class="o">+=</span> <span class="n">_value</span><span class="p">;</span>
        <span class="k">return</span> <span class="mh">0x8943ec02</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="security-considerations">Security Considerations</h2>

<p>This token utilizes the model similar to plain ether behavior. Therefore replay issues must be taken into account.</p>

<h3 id="reference-implementation">Reference Implementation</h3>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">19</span><span class="p">;</span>

<span class="k">library</span> <span class="n">Address</span> <span class="p">{</span>
    <span class="cm">/**
     * @dev Returns true if `account` is a contract.
     *
     * This test is non-exhaustive, and there may be false-negatives: during the
     * execution of a contract's constructor, its address will be reported as
     * not containing a contract.
     *
     * &gt; It is unsafe to assume that an address for which this function returns
     * false is an externally-owned account (EOA) and not a contract.
     */</span>
    <span class="k">function</span> <span class="n">isContract</span><span class="p">(</span><span class="kt">address</span> <span class="n">account</span><span class="p">)</span> <span class="k">internal</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// This method relies in extcodesize, which returns 0 for contracts in
</span>        <span class="c1">// construction, since the code is only stored at the end of the
</span>        <span class="c1">// constructor execution.
</span>
        <span class="kt">uint256</span> <span class="n">size</span><span class="p">;</span>
        <span class="c1">// solhint-disable-next-line no-inline-assembly
</span>        <span class="k">assembly</span> <span class="p">{</span> <span class="n">size</span> <span class="o">:=</span> <span class="n">extcodesize</span><span class="p">(</span><span class="n">account</span><span class="p">)</span> <span class="p">}</span>
        <span class="k">return</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">abstract</span> <span class="k">contract</span> <span class="n">IERC223Recipient</span> <span class="p">{</span>
<span class="cm">/**
 * @dev Standard ERC-223 receiving function that will handle incoming token transfers.
 *
 * @param _from  Token sender address.
 * @param _value Amount of tokens.
 * @param _data  Transaction metadata.
 */</span>
    <span class="k">function</span> <span class="n">tokenReceived</span><span class="p">(</span><span class="kt">address</span> <span class="n">_from</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">_data</span><span class="p">)</span> <span class="k">public</span> <span class="k">virtual</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes4</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/**
 * @title Reference implementation of the ERC223 standard token.
 */</span>
<span class="k">contract</span> <span class="n">ERC223Token</span> <span class="p">{</span>

     <span class="cm">/**
     * @dev Event that is fired on successful transfer.
     */</span>
    <span class="k">event</span> <span class="n">Transfer</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">from</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">,</span> <span class="kt">bytes</span> <span class="n">data</span><span class="p">);</span>

    <span class="kt">string</span>  <span class="k">private</span> <span class="n">_name</span><span class="p">;</span>
    <span class="kt">string</span>  <span class="k">private</span> <span class="n">_symbol</span><span class="p">;</span>
    <span class="kt">uint8</span>   <span class="k">private</span> <span class="n">_decimals</span><span class="p">;</span>
    <span class="kt">uint256</span> <span class="k">private</span> <span class="n">_totalSupply</span><span class="p">;</span>
    
    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint256</span><span class="p">)</span> <span class="k">private</span> <span class="n">balances</span><span class="p">;</span> <span class="c1">// List of user balances.
</span>
    <span class="cm">/**
     * @dev Sets the values for {name} and {symbol}, initializes {decimals} with
     * a default value of 18.
     *
     * To select a different value for {decimals}, use {_setupDecimals}.
     *
     * All three of these values are immutable: they can only be set once during
     * construction.
     */</span>
     
    <span class="k">constructor</span><span class="p">(</span><span class="kt">string</span> <span class="k">memory</span> <span class="n">new_name</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">new_symbol</span><span class="p">,</span> <span class="kt">uint8</span> <span class="n">new_decimals</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">_name</span>     <span class="o">=</span> <span class="n">new_name</span><span class="p">;</span>
        <span class="n">_symbol</span>   <span class="o">=</span> <span class="n">new_symbol</span><span class="p">;</span>
        <span class="n">_decimals</span> <span class="o">=</span> <span class="n">new_decimals</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @dev Returns the name of the token.
     */</span>
    <span class="k">function</span> <span class="n">name</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">string</span> <span class="k">memory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_name</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @dev Returns the symbol of the token, usually a shorter version of the
     * name.
     */</span>
    <span class="k">function</span> <span class="n">symbol</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">string</span> <span class="k">memory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_symbol</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @dev Returns the number of decimals used to get its user representation.
     * For example, if `decimals` equals `2`, a balance of `505` tokens should
     * be displayed to a user as `5,05` (`505 / 10 ** 2`).
     *
     * Tokens usually opt for a value of 18, imitating the relationship between
     * Ether and Wei. This is the value {ERC223} uses, unless {_setupDecimals} is
     * called.
     *
     * NOTE: This information is only used for _display_ purposes: it in
     * no way affects any of the arithmetic of the contract, including
     * {IERC223-balanceOf} and {IERC223-transfer}.
     */</span>
    <span class="k">function</span> <span class="n">decimals</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint8</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_decimals</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @dev See {IERC223-totalSupply}.
     */</span>
    <span class="k">function</span> <span class="n">totalSupply</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">_totalSupply</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="cm">/**
     * @dev See {IERC223-standard}.
     */</span>
    <span class="k">function</span> <span class="n">standard</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">string</span> <span class="k">memory</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="s">"223"</span><span class="p">;</span>
    <span class="p">}</span>

    
    <span class="cm">/**
     * @dev Returns balance of the `_owner`.
     *
     * @param _owner   The address whose balance will be returned.
     * @return balance Balance of the `_owner`.
     */</span>
    <span class="k">function</span> <span class="n">balanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">_owner</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="n">balances</span><span class="p">[</span><span class="n">_owner</span><span class="p">];</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * @dev Transfer the specified amount of tokens to the specified address.
     *      Invokes the `tokenFallback` function if the recipient is a contract.
     *      The token transfer fails if the recipient is a contract
     *      but does not implement the `tokenFallback` function
     *      or the fallback function to receive funds.
     *
     * @param _to    Receiver address.
     * @param _value Amount of tokens that will be transferred.
     * @param _data  Transaction metadata.
     */</span>
    <span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">_data</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// Standard function transfer similar to ERC20 transfer with no _data .
</span>        <span class="c1">// Added due to backwards compatibility reasons .
</span>        <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-</span> <span class="n">_value</span><span class="p">;</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+</span> <span class="n">_value</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="n">isContract</span><span class="p">(</span><span class="n">_to</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">IERC223Recipient</span><span class="p">(</span><span class="n">_to</span><span class="p">).</span><span class="n">tokenReceived</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">_data</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">emit</span> <span class="n">Transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">_data</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * @dev Transfer the specified amount of tokens to the specified address.
     *      This function works the same with the previous one
     *      but doesn't contain `_data` param.
     *      Added due to backwards compatibility reasons.
     *
     * @param _to    Receiver address.
     * @param _value Amount of tokens that will be transferred.
     */</span>
    <span class="k">function</span> <span class="nb">transfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">_value</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">success</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">_empty</span> <span class="o">=</span> <span class="s">hex"00000000"</span><span class="p">;</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">-</span> <span class="n">_value</span><span class="p">;</span>
        <span class="n">balances</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">=</span> <span class="n">balances</span><span class="p">[</span><span class="n">_to</span><span class="p">]</span> <span class="o">+</span> <span class="n">_value</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">Address</span><span class="p">.</span><span class="n">isContract</span><span class="p">(</span><span class="n">_to</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">IERC223Recipient</span><span class="p">(</span><span class="n">_to</span><span class="p">).</span><span class="n">tokenReceived</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">_empty</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">emit</span> <span class="n">Transfer</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">_to</span><span class="p">,</span> <span class="n">_value</span><span class="p">,</span> <span class="n">_empty</span><span class="p">);</span>
        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
