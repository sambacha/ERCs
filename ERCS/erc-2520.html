<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Multiple contenthash records for ENS | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Multiple contenthash records for ENS | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-2520" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-2520" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Multiple contenthash records for ENS</h1>
  </header>

  <div class="post-content">
    <h2 id="simple-summary">Simple Summary</h2>
<p>ENS support for multiple <code class="language-plaintext highlighter-rouge">contenthash</code> records on a single ENS name.</p>

<h2 id="motivation">Motivation</h2>
<p>Many applications are resolving ENS names to content hosted on distributed systems. To do this, they use <code class="language-plaintext highlighter-rouge">contenthash</code> record from ENS domain to know how to resolve names and which distributed system should be used.</p>

<p>However, the domain can store only one <code class="language-plaintext highlighter-rouge">contenthash</code> record which means that the site owner needs to decide which hosting system to use. Because there are many ENS-compatible hosting systems available (IPFS, Swarm, recently Onion and ZeroNet), and there will probably be even more in the future, lack of support for multiple records could become problematic. Instead, domains should be able to store multiple <code class="language-plaintext highlighter-rouge">contenthash</code> records to allow applications to resolve to multiple hosting systems.</p>

<h2 id="specification">Specification</h2>
<p>Setting and getting functions <strong>MUST</strong> have the same public interface as specified in EIP 1577. Additionally, they <strong>MUST</strong> also have new public interfaces introduced by this EIP:</p>

<ul>
  <li>
    <p>For setting a <code class="language-plaintext highlighter-rouge">contenthash</code> record, the <code class="language-plaintext highlighter-rouge">setContenthash</code> <strong>MUST</strong> provide additional <code class="language-plaintext highlighter-rouge">proto</code> parameter and use it to save the <code class="language-plaintext highlighter-rouge">contenthash</code>. When <code class="language-plaintext highlighter-rouge">proto</code> is not provided, it <strong>MUST</strong> save the record as default record.</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">setContenthash</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">node</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">proto</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">hash</span><span class="p">)</span> <span class="k">external</span> <span class="n">authorised</span><span class="p">(</span><span class="n">node</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>For getting a <code class="language-plaintext highlighter-rouge">contenthash</code> record, the <code class="language-plaintext highlighter-rouge">contenthash</code> <strong>MUST</strong> provide additional <code class="language-plaintext highlighter-rouge">proto</code> parameter and use it to get the <code class="language-plaintext highlighter-rouge">contenthash</code> for requested type. When <code class="language-plaintext highlighter-rouge">proto</code> is not provided, it <strong>MUST</strong> return the default record.</p>

    <div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">contenthash</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">node</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">proto</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span> <span class="k">memory</span><span class="p">);</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Resolver that supports multiple <code class="language-plaintext highlighter-rouge">contenthash</code> records <strong>MUST</strong> return <code class="language-plaintext highlighter-rouge">true</code> for <code class="language-plaintext highlighter-rouge">supportsInterface</code> with interface ID <code class="language-plaintext highlighter-rouge">0x6de03e07</code>.</p>
  </li>
</ul>

<p>Applications that are using ENS <code class="language-plaintext highlighter-rouge">contenthash</code> records <strong>SHOULD</strong> handle them in the following way:</p>

<ul>
  <li>
    <p>If the application only supports one hosting system (like directly handling ENS from IPFS/Swarm gateways), it <strong>SHOULD</strong> request <code class="language-plaintext highlighter-rouge">contenthash</code> with a specific type. The contract <strong>MUST</strong> then return it and application <strong>SHOULD</strong> correctly handle it.</p>
  </li>
  <li>
    <p>If the application supports multiple hosting systems (like MetaMask), it <strong>SHOULD</strong> request <code class="language-plaintext highlighter-rouge">contenthash</code> without a specific type (like in EIP 1577). The contract <strong>MUST</strong> then return the default <code class="language-plaintext highlighter-rouge">contenthash</code> record.</p>
  </li>
</ul>

<h2 id="rationale">Rationale</h2>
<p>The proposed implementation was chosen because it is simple to implement and supports all important requested features. However, it doesn’t support multiple records for the same type and priority order, as they don’t give much advantage and are harder to implement properly.</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>
<p>The EIP is backwards-compatible with EIP 1577, the only differences are additional overloaded methods. Old applications will still be able to function correctly, as they will receive the default <code class="language-plaintext highlighter-rouge">contenthash</code> record.</p>

<h2 id="implementation">Implementation</h2>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">contract</span> <span class="n">ContentHashResolver</span> <span class="p">{</span>
    <span class="kt">bytes4</span> <span class="k">constant</span> <span class="k">private</span> <span class="n">MULTI_CONTENT_HASH_INTERFACE_ID</span> <span class="o">=</span> <span class="mh">0x6de03e07</span><span class="p">;</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">bytes32</span><span class="o">=&gt;</span><span class="k">mapping</span><span class="p">(</span><span class="kt">bytes</span><span class="o">=&gt;</span><span class="kt">bytes</span><span class="p">))</span> <span class="n">hashes</span><span class="p">;</span>

    <span class="k">function</span> <span class="n">setContenthash</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">node</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">proto</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">hash</span><span class="p">)</span> <span class="k">external</span> <span class="p">{</span>
        <span class="n">hashes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">proto</span><span class="p">]</span> <span class="o">=</span> <span class="n">hash</span><span class="p">;</span>
        <span class="k">emit</span> <span class="n">ContenthashChanged</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">hash</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">contenthash</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">node</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">proto</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">hashes</span><span class="p">[</span><span class="n">node</span><span class="p">][</span><span class="n">proto</span><span class="p">];</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">supportsInterface</span><span class="p">(</span><span class="kt">bytes4</span> <span class="n">interfaceID</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span><span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">interfaceID</span> <span class="o">==</span> <span class="n">MULTI_CONTENT_HASH_INTERFACE_ID</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="security-considerations">Security Considerations</h2>
<p>TBD</p>

<h2 id="copyright">Copyright</h2>
<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
