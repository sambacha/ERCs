<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Staking Reward Calculation | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Staking Reward Calculation | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-2917" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-2917" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Staking Reward Calculation</h1>
  </header>

  <div class="post-content">
    <h2 id="simple-summary">Simple Summary</h2>
<p>ERC2917 is a new standardization for on-chain calculation of staking reward.</p>

<h2 id="abstract">Abstract</h2>
<p>Based on the product of effective collateral and time, ERC2917 calculates the reward a user can get at any time, and realize the real decentralized DeFi. Here below is the formula for the calculation of reward for a user U:</p>

<p><img src="../assets/eip-2917/erc-reward-formula.png" alt="concept image" title="erc-reward-formula" /></p>

<p>where ∆p<sub>i</sub> denotes individual productivity of the user U between the consecutive block numbers t<sub>i-1</sub>  and t<sub>i</sub>, ∆P<sub>i</sub> denotes global productivity between the consecutive block numbers t<sub>i-1</sub>  and t<sub>i</sub>, and ∆G<sub>i</sub> denotes gross product between the consecutive block numbers t<sub>i-1</sub>  and t<sub>i</sub>. The formula ensures that there is no benefit in case of exiting earlier or entering later in the computation. The reward a user can get for a period is based on his total productivity during that specific time. The formula has been simplified through Solidity and generalized design to make it available across all DeFi products. 
We note that the smart contract can be triggered for every computation of on the following events:</p>
<ul>
  <li>whenever the productivity of a user changes (increase/decrease),</li>
  <li>whenever a user withdraws.</li>
</ul>

<h2 id="motivation">Motivation</h2>

<p>One of the main drawbacks of many DeFi projects is the reward distribution mechanism within the smart contract. In fact, there are two main mechanisms are adopted so far.</p>
<ol>
  <li>Distribution of rewards is only given when all users exit the contract</li>
  <li>The project collects on-chain data, conducts calculation off-chain, and sends the results
to the chain before starting rewards distribution accordingly</li>
</ol>

<p>The first approach conducts all calculation in an on-chain fashion, the cycle of its rewards distribution is too long. Furthermore, users need to remove their collateral before getting the rewards, which can be harmful for their rewards. The second approach is a semi-decentralized model since the main algorithm involves an off-chain computation. Therefore, the fairness and transparency properties cannot be reflected and this can even create the investment barrier for users.</p>

<p>Since there is more DeFi projects coming out everyday, users could not find a proper way  to get to know:
1) amount of interests he/she would get
2) how the interest calculated
3) what is his/her contribution compare to the overall</p>

<p>By standardizing ERC2917, it abstracts the interface for interests generation process. Making wallet applications easier to collect each DeFi’s metrics, user friendlier.</p>

<h2 id="specification">Specification</h2>

<p>Every ERC-2917 compliant contract must implement the ERC2917 and ERC20 interfaces (if necessary):</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">interface</span> <span class="n">IERC2917</span> <span class="k">is</span> <span class="n">IERC20</span> <span class="p">{</span>

    <span class="c1">/// @dev This emit when interests amount per block is changed by the owner of the contract.
</span>    <span class="c1">/// It emits with the old interests amount and the new interests amount.
</span>    <span class="k">event</span> <span class="n">InterestRatePerBlockChanged</span> <span class="p">(</span><span class="kt">uint</span> <span class="n">oldValue</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">newValue</span><span class="p">);</span>

    <span class="c1">/// @dev This emit when a users' productivity has changed
</span>    <span class="c1">/// It emits with the user's address and the the value after the change.
</span>    <span class="k">event</span> <span class="n">ProductivityIncreased</span> <span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">user</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">);</span>

    <span class="c1">/// @dev This emit when a users' productivity has changed
</span>    <span class="c1">/// It emits with the user's address and the the value after the change.
</span>    <span class="k">event</span> <span class="n">ProductivityDecreased</span> <span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">user</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">);</span>

    
    <span class="c1">/// @dev Return the current contract's interests rate per block.
</span>    <span class="c1">/// @return The amount of interests currently producing per each block.
</span>    <span class="k">function</span> <span class="n">interestsPerBlock</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>

    <span class="c1">/// @notice Change the current contract's interests rate.
</span>    <span class="c1">/// @dev Note the best practice will be restrict the gross product provider's contract address to call this.
</span>    <span class="c1">/// @return The true/false to notice that the value has successfully changed or not, when it succeed, it will emite the InterestRatePerBlockChanged event.
</span>    <span class="k">function</span> <span class="n">changeInterestRatePerBlock</span><span class="p">(</span><span class="kt">uint</span> <span class="n">value</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

    <span class="c1">/// @notice It will get the productivity of given user.
</span>    <span class="c1">/// @dev it will return 0 if user has no productivity proved in the contract.
</span>    <span class="c1">/// @return user's productivity and overall productivity.
</span>    <span class="k">function</span> <span class="n">getProductivity</span><span class="p">(</span><span class="kt">address</span> <span class="n">user</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">,</span> <span class="kt">uint</span><span class="p">);</span>

    <span class="c1">/// @notice increase a user's productivity.
</span>    <span class="c1">/// @dev Note the best practice will be restrict the callee to prove of productivity's contract address.
</span>    <span class="c1">/// @return true to confirm that the productivity added success.
</span>    <span class="k">function</span> <span class="n">increaseProductivity</span><span class="p">(</span><span class="kt">address</span> <span class="n">user</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

    <span class="c1">/// @notice decrease a user's productivity.
</span>    <span class="c1">/// @dev Note the best practice will be restrict the callee to prove of productivity's contract address.
</span>    <span class="c1">/// @return true to confirm that the productivity removed success.
</span>    <span class="k">function</span> <span class="n">decreaseProductivity</span><span class="p">(</span><span class="kt">address</span> <span class="n">user</span><span class="p">,</span> <span class="kt">uint</span> <span class="n">value</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

    <span class="c1">/// @notice take() will return the interests that callee will get at current block height.
</span>    <span class="c1">/// @dev it will always calculated by block.number, so it will change when block height changes.
</span>    <span class="c1">/// @return amount of the interests that user are able to mint() at current block height.
</span>    <span class="k">function</span> <span class="n">take</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>

    <span class="c1">/// @notice similar to take(), but with the block height joined to calculate return.
</span>    <span class="c1">/// @dev for instance, it returns (_amount, _block), which means at block height _block, the callee has accumulated _amount of interests.
</span>    <span class="c1">/// @return amount of interests and the block height.
</span>    <span class="k">function</span> <span class="n">takeWithBlock</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">,</span> <span class="kt">uint</span><span class="p">);</span>

    <span class="c1">/// @notice mint the available interests to callee.
</span>    <span class="c1">/// @dev once it mint, the amount of interests will transfer to callee's address.
</span>    <span class="c1">/// @return the amount of interests minted.
</span>    <span class="k">function</span> <span class="n">mint</span><span class="p">()</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="interestrateperblockchanged">InterestRatePerBlockChanged</h3>

<p>This emit when interests amount per block is changed by the owner of the contract. It emits with the old interests amount and the new interests amount.</p>

<h3 id="productivityincreased">ProductivityIncreased</h3>

<p>It emits with the user’s address and the the value after the change.</p>

<h3 id="productivitydecreased">ProductivityDecreased</h3>

<p>It emits with the user’s address and the the value after the change.</p>

<h3 id="interestsperblock">interestsPerBlock</h3>

<p>It returns the amount of interests currently producing per each block.</p>

<h3 id="changeinterestrateperblock">changeInterestRatePerBlock</h3>

<p>Note the best practice will be restrict the gross product provider’s contract address to call this.</p>

<p>The true/false to notice that the value has successfully changed or not, when it succeed, it will emite the InterestRatePerBlockChanged event.</p>

<h3 id="getproductivity">getProductivity</h3>

<p>It returns user’s productivity and overall productivity. It returns 0 if user has no productivity proved in the contract.</p>

<h3 id="increaseproductivity">increaseProductivity</h3>

<p>It increases a user’s productivity.</p>

<h3 id="decreaseproductivity">decreaseProductivity</h3>

<p>It decreases a user’s productivity.</p>

<h3 id="take">take</h3>

<p>It returns the interests that callee will get at current block height.</p>

<h3 id="takewithblock">takeWithBlock</h3>

<p>Similar to take(), but with the block height joined to calculate return.</p>

<p>For instance, it returns (_amount, _block), which means at block height _block, the callee has accumulated _amount of interests.</p>

<p>It returns amount of interests and the block height.</p>

<h3 id="mint">mint</h3>
<p>it mints the amount of interests will transfer to callee’s address. It returns the amount of interests minted.</p>

<h2 id="rationale">Rationale</h2>
<p>TBD</p>

<h2 id="implementation">Implementation</h2>
<p>The implementation code is on the github:</p>

<ul>
  <li><a href="https://github.com/gnufoo/ERC3000-Proposal">ERC2917 Demo</a></li>
</ul>

<h2 id="security-considerations">Security Considerations</h2>
<p>TBD</p>

<h2 id="copyright">Copyright</h2>
<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
