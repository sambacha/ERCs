<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Held token interface | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Held token interface | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-4987" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-4987" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Held token interface</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>The proposed standard defines a lightweight interface to expose functional ownership and balances of held tokens. A held token is a token owned by a contract. This standard may be implemented by smart contracts which hold <a href="./eip-20.md">EIP-20</a>, <a href="./eip-721.md">EIP-721</a>, or <a href="./eip-1155.md">EIP-1155</a> tokens and is intended to be consumed by both on-chain and off-chain systems that rely on ownership and balance verification.</p>

<h2 id="motivation">Motivation</h2>

<p>As different areas of crypto (DeFi, NFTs, etc.) converge and composability improves, there will more commonly be a distinction between the actual owner (likely a contract) and the functional owner (likely a user) of a token. Currently, this results in a conflict between mechanisms that require token deposits and systems that rely on those tokens for ownership or balance verification.</p>

<p>This proposal aims to address that conflict by providing a standard interface for token holders to expose ownership and balance information. This will allow users to participate in these DeFi mechanisms without giving up existing token utility. Overall, this would greatly increase interoperability across systems, benefiting both users and protocol developers.</p>

<p>Example implementers of this ERC standard include</p>

<ul>
  <li>staking or farming contracts</li>
  <li>lending pools</li>
  <li>time lock or vesting vaults</li>
  <li>fractionalized NFT contracts</li>
  <li>smart contract wallets</li>
</ul>

<p>Example consumers of this ERC standard include</p>

<ul>
  <li>governance systems</li>
  <li>gaming</li>
  <li>PFP verification</li>
  <li>art galleries or showcases</li>
  <li>token based membership programs</li>
</ul>

<h2 id="specification">Specification</h2>

<p>Smart contracts implementing the <code class="language-plaintext highlighter-rouge">ERC20</code> held token standard MUST implement all of the functions in the <code class="language-plaintext highlighter-rouge">IERC20Holder</code> interface.</p>

<p>Smart contracts implementing the <code class="language-plaintext highlighter-rouge">ERC20</code> held token standard MUST also implement <code class="language-plaintext highlighter-rouge">ERC165</code> and return true when the interface ID <code class="language-plaintext highlighter-rouge">0x74c89d54</code> is passed.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @notice the ERC20 holder standard provides a common interface to query
 * token balance information
 */</span>
<span class="k">interface</span> <span class="n">IERC20Holder</span> <span class="k">is</span> <span class="n">IERC165</span> <span class="p">{</span>
  <span class="cm">/**
   * @notice emitted when the token is transferred to the contract
   * @param owner functional token owner
   * @param tokenAddress held token address
   * @param tokenAmount held token amount
   */</span>
  <span class="k">event</span> <span class="n">Hold</span><span class="p">(</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">owner</span><span class="p">,</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">tokenAddress</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">tokenAmount</span>
  <span class="p">);</span>

  <span class="cm">/**
   * @notice emitted when the token is released back to the user
   * @param owner functional token owner
   * @param tokenAddress held token address
   * @param tokenAmount held token amount
   */</span>
  <span class="k">event</span> <span class="n">Release</span><span class="p">(</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">owner</span><span class="p">,</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">tokenAddress</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">tokenAmount</span>
  <span class="p">);</span>

  <span class="cm">/**
   * @notice get the held balance of the token owner
   * @dev should throw for invalid queries and return zero for no balance
   * @param tokenAddress held token address
   * @param owner functional token owner
   * @return held token balance
   */</span>
  <span class="k">function</span> <span class="n">heldBalanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">tokenAddress</span><span class="p">,</span> <span class="kt">address</span> <span class="n">owner</span><span class="p">)</span>
    <span class="k">external</span>
    <span class="k">view</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<p>Smart contracts implementing the <code class="language-plaintext highlighter-rouge">ERC721</code> held token standard MUST implement all of the functions in the <code class="language-plaintext highlighter-rouge">IERC721Holder</code> interface.</p>

<p>Smart contracts implementing the <code class="language-plaintext highlighter-rouge">ERC721</code> held token standard MUST also implement <code class="language-plaintext highlighter-rouge">ERC165</code> and return true when the interface ID <code class="language-plaintext highlighter-rouge">0x16b900ff</code> is passed.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @notice the ERC721 holder standard provides a common interface to query
 * token ownership and balance information
 */</span>
<span class="k">interface</span> <span class="n">IERC721Holder</span> <span class="k">is</span> <span class="n">IERC165</span> <span class="p">{</span>
  <span class="cm">/**
   * @notice emitted when the token is transferred to the contract
   * @param owner functional token owner
   * @param tokenAddress held token address
   * @param tokenId held token ID
   */</span>
  <span class="k">event</span> <span class="n">Hold</span><span class="p">(</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">owner</span><span class="p">,</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">tokenAddress</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">tokenId</span>
  <span class="p">);</span>

  <span class="cm">/**
   * @notice emitted when the token is released back to the user
   * @param owner functional token owner
   * @param tokenAddress held token address
   * @param tokenId held token ID
   */</span>
  <span class="k">event</span> <span class="n">Release</span><span class="p">(</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">owner</span><span class="p">,</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">tokenAddress</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">tokenId</span>
  <span class="p">);</span>

  <span class="cm">/**
   * @notice get the functional owner of a held token
   * @dev should throw for invalid queries and return zero for a token ID that is not held
   * @param tokenAddress held token address
   * @param tokenId held token ID
   * @return functional token owner
   */</span>
  <span class="k">function</span> <span class="n">heldOwnerOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">tokenAddress</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span>
    <span class="k">external</span>
    <span class="k">view</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>

  <span class="cm">/**
   * @notice get the held balance of the token owner
   * @dev should throw for invalid queries and return zero for no balance
   * @param tokenAddress held token address
   * @param owner functional token owner
   * @return held token balance
   */</span>
  <span class="k">function</span> <span class="n">heldBalanceOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">tokenAddress</span><span class="p">,</span> <span class="kt">address</span> <span class="n">owner</span><span class="p">)</span>
    <span class="k">external</span>
    <span class="k">view</span>
    <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Smart contracts implementing the <code class="language-plaintext highlighter-rouge">ERC1155</code> held token standard MUST implement all of the functions in the <code class="language-plaintext highlighter-rouge">IERC1155Holder</code> interface.</p>

<p>Smart contracts implementing the <code class="language-plaintext highlighter-rouge">ERC1155</code> held token standard MUST also implement <code class="language-plaintext highlighter-rouge">ERC165</code> and return true when the interface ID <code class="language-plaintext highlighter-rouge">0xced24c37</code> is passed.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @notice the ERC1155 holder standard provides a common interface to query
 * token balance information
 */</span>
<span class="k">interface</span> <span class="n">IERC1155Holder</span> <span class="k">is</span> <span class="n">IERC165</span> <span class="p">{</span>
  <span class="cm">/**
   * @notice emitted when the token is transferred to the contract
   * @param owner functional token owner
   * @param tokenAddress held token address
   * @param tokenId held token ID
   * @param tokenAmount held token amount
   */</span>
  <span class="k">event</span> <span class="n">Hold</span><span class="p">(</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">owner</span><span class="p">,</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">tokenAddress</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">tokenId</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">tokenAmount</span>
  <span class="p">);</span>

  <span class="cm">/**
   * @notice emitted when the token is released back to the user
   * @param owner functional token owner
   * @param tokenAddress held token address
   * @param tokenId held token ID
   * @param tokenAmount held token amount
   */</span>
  <span class="k">event</span> <span class="n">Release</span><span class="p">(</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">owner</span><span class="p">,</span>
    <span class="kt">address</span> <span class="k">indexed</span> <span class="n">tokenAddress</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">tokenId</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">tokenAmount</span>
  <span class="p">);</span>

  <span class="cm">/**
   * @notice get the held balance of the token owner
   * @dev should throw for invalid queries and return zero for no balance
   * @param tokenAddress held token address
   * @param owner functional token owner
   * @param tokenId held token ID
   * @return held token balance
   */</span>
  <span class="k">function</span> <span class="n">heldBalanceOf</span><span class="p">(</span>
    <span class="kt">address</span> <span class="n">tokenAddress</span><span class="p">,</span>
    <span class="kt">address</span> <span class="n">owner</span><span class="p">,</span>
    <span class="kt">uint256</span> <span class="n">tokenId</span>
  <span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="rationale">Rationale</h2>

<p>This interface is designed to be extremely lightweight and compatible with any existing token contract. Any token holder contract likely already stores all relevant information, so this standard is purely adding a common interface to expose that data.</p>

<p>The token address parameter is included to support contracts that can hold multiple token contracts simultaneously. While some contracts may only hold a single token address, this is more general to either scenario.</p>

<p>Separate interfaces are proposed for each token type (EIP-20, EIP-721, EIP-1155) because any contract logic to support holding these different tokens is likely independent. In the scenario where a single contract does hold multiple token types, it can simply implement each appropriate held token interface.</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>Importantly, the proposed specification is fully compatible with all existing EIP-20, EIP-721, and EIP-1155 token contracts.</p>

<p>Token holder contracts will need to be updated to implement this lightweight interface.</p>

<p>Consumer of this standard will need to be updated to respect this interface in any relevant ownership logic.</p>

<h2 id="reference-implementation">Reference Implementation</h2>

<p>A full example implementation including <a href="../assets/eip-4987/IERC721Holder.sol">interfaces</a>, a vault <a href="../assets/eip-4987/Vault.sol">token holder</a>, and a <a href="../assets/eip-4987/Consumer.sol">consumer</a>, can be found at <code class="language-plaintext highlighter-rouge">assets/eip-4987/</code>.</p>

<p>Notably, consumers of the <code class="language-plaintext highlighter-rouge">IERC721Holder</code> interface can do a chained lookup for the owner of any specific token ID using the following logic.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="cm">/**
   * @notice get the functional owner of a token
   * @param tokenId token id of interest
   */</span>
  <span class="k">function</span> <span class="n">getOwner</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// get raw owner
</span>    <span class="kt">address</span> <span class="n">owner</span> <span class="o">=</span> <span class="n">token</span><span class="p">.</span><span class="n">ownerOf</span><span class="p">(</span><span class="n">tokenId</span><span class="p">);</span>

    <span class="c1">// if owner is not contract, return
</span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">owner</span><span class="p">.</span><span class="n">isContract</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">owner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// check for token holder interface support
</span>    <span class="k">try</span> <span class="n">IERC165</span><span class="p">(</span><span class="n">owner</span><span class="p">).</span><span class="n">supportsInterface</span><span class="p">(</span><span class="mh">0x16b900ff</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">ret</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span> <span class="k">return</span> <span class="n">owner</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">owner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="c1">// check for held owner
</span>    <span class="k">try</span> <span class="n">IERC721Holder</span><span class="p">(</span><span class="n">owner</span><span class="p">).</span><span class="n">heldOwnerOf</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="n">token</span><span class="p">),</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">user</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">user</span> <span class="o">!=</span> <span class="kt">address</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">return</span> <span class="n">user</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">{}</span>

    <span class="k">return</span> <span class="n">owner</span><span class="p">;</span>
  <span class="p">}</span>
</code></pre></div></div>

<h2 id="security-considerations">Security Considerations</h2>

<p>Consumers of this standard should be cautious when using ownership information from unknown contracts. A bad actor could implement the interface, but report invalid or malicious information with the goal of manipulating a governance system, game, membership program, etc.</p>

<p>Consumers should also verify the overall token balance and ownership of the holder contract as a sanity check.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
