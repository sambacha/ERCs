<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Transferable Vesting NFT | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Transferable Vesting NFT | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-5725" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-5725" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Transferable Vesting NFT</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>A <strong>Non-Fungible Token</strong> (NFT) standard used to vest tokens (<a href="./eip-20.md">ERC-20</a> or otherwise) over a vesting release curve.</p>

<p>The following standard allows for the implementation of a standard API for NFT based contracts that hold and represent the vested and locked properties of any underlying token (<a href="./eip-20.md">ERC-20</a> or otherwise) that is emitted to the NFT holder. This standard is an extension of the <a href="./eip-721.md">ERC-721</a> token that provides basic functionality for creating vesting NFTs, claiming the tokens and reading vesting curve properties.</p>

<h2 id="motivation">Motivation</h2>

<p>Vesting contracts, including timelock contracts, lack a standard and unified interface, which results in diverse implementations of such contracts. Standardizing such contracts into a single interface would allow for the creation of an ecosystem of on- and off-chain tooling around these contracts. In addition, liquid vesting in the form of non-fungible assets can prove to be a huge improvement over traditional <strong>Simple Agreement for Future Tokens</strong> (SAFTs) or <strong>Externally Owned Account</strong> (EOA)-based vesting as it enables transferability and the ability to attach metadata similar to the existing functionality offered by with traditional NFTs.</p>

<p>Such a standard will not only provide a much-needed <a href="./eip-20.md">ERC-20</a> token lock standard, but will also enable the creation of secondary marketplaces tailored for semi-liquid SAFTs.</p>

<p>This standard also allows for a variety of different vesting curves to be implement easily.</p>

<p>These curves could represent:</p>

<ul>
  <li>linear vesting</li>
  <li>cliff vesting</li>
  <li>exponential vesting</li>
  <li>custom deterministic vesting</li>
</ul>

<h3 id="use-cases">Use Cases</h3>

<ol>
  <li>A framework to release tokens over a set period of time that can be used to build many kinds of NFT financial products such as bonds, treasury bills, and many others.</li>
  <li>Replicating SAFT contracts in a standardized form of semi-liquid vesting NFT assets.
    <ul>
      <li>SAFTs are generally off-chain, while today’s on-chain versions are mainly address-based, which makes distributing vesting shares to many representatives difficult. Standardization simplifies this convoluted process.</li>
    </ul>
  </li>
  <li>Providing a path for the standardization of vesting and token timelock contracts.
    <ul>
      <li>There are many such contracts in the wild and most of them differ in both interface and implementation.</li>
    </ul>
  </li>
  <li>NFT marketplaces dedicated to vesting NFTs.
    <ul>
      <li>Whole new sets of interfaces and analytics could be created from a common standard for token vesting NFTs.</li>
    </ul>
  </li>
  <li>Integrating vesting NFTs into services like Safe Wallet.
    <ul>
      <li>A standard would mean services like Safe Wallet could more easily and uniformly support interactions with these types of contracts inside of a multisig contract.</li>
    </ul>
  </li>
  <li>Enable standardized fundraising implementations and general fundraising that sell vesting tokens (eg. SAFTs) in a more transparent manner.</li>
  <li>Allows tools, front-end apps, aggregators, etc. to show a more holistic view of the vesting tokens and the properties available to users.
    <ul>
      <li>Currently, every project needs to write their own visualization of the vesting schedule of their vesting assets. If this is standardized, third-party tools could be developed to aggregate all vesting NFTs from all projects for the user, display their schedules and allow the user to take aggregated vesting actions.</li>
      <li>Such tooling can easily discover compliance through the <a href="./eip-165.md">ERC-165</a> <code class="language-plaintext highlighter-rouge">supportsInterface(InterfaceID)</code> check.</li>
    </ul>
  </li>
  <li>Makes it easier for a single wrapping implementation to be used across all vesting standards that defines multiple recipients, periodic renting of vesting tokens etc.</li>
</ol>

<h2 id="specification">Specification</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SPDX-License-Identifier: CC0-1.0
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"@openzeppelin/contracts/token/ERC721/IERC721.sol"</span><span class="p">;</span>

<span class="cm">/**
 * @title Non-Fungible Vesting Token Standard.
 * @notice A non-fungible token standard used to vest ERC-20 tokens over a vesting release curve 
 *  scheduled using timestamps.
 * @dev Because this standard relies on timestamps for the vesting schedule, it's important to keep track of the 
 *  tokens claimed per Vesting NFT so that a user cannot withdraw more tokens than allotted for a specific Vesting NFT.
 * @custom:interface-id 0xbd3a202b
 */</span>
<span class="k">interface</span> <span class="n">IERC5725</span> <span class="k">is</span> <span class="n">IERC721</span> <span class="p">{</span>
    <span class="cm">/**
     *  This event is emitted when the payout is claimed through the claim function.
     *  @param tokenId the NFT tokenId of the assets being claimed.
     *  @param recipient The address which is receiving the payout.
     *  @param claimAmount The amount of tokens being claimed.
     */</span>
    <span class="k">event</span> <span class="n">PayoutClaimed</span><span class="p">(</span><span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">tokenId</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">recipient</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">claimAmount</span><span class="p">);</span>

    <span class="cm">/**
     *  This event is emitted when an `owner` sets an address to manage token claims for all tokens.
     *  @param owner The address setting a manager to manage all tokens.
     *  @param spender The address being permitted to manage all tokens.
     *  @param approved A boolean indicating whether the spender is approved to claim for all tokens.
     */</span>
    <span class="k">event</span> <span class="n">ClaimApprovalForAll</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">approved</span><span class="p">);</span>

    <span class="cm">/**
     *  This event is emitted when an `owner` sets an address to manage token claims for a `tokenId`.
     *  @param owner The `owner` of `tokenId`.
     *  @param spender The address being permitted to manage a tokenId.
     *  @param tokenId The unique identifier of the token being managed.
     *  @param approved A boolean indicating whether the spender is approved to claim for `tokenId`.
     */</span>
    <span class="k">event</span> <span class="n">ClaimApproval</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">address</span> <span class="k">indexed</span> <span class="n">spender</span><span class="p">,</span> <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">tokenId</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">approved</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Claim the pending payout for the NFT.
     * @dev MUST grant the claimablePayout value at the time of claim being called to `msg.sender`. 
     *  MUST revert if not called by the token owner or approved users. 
     *  MUST emit PayoutClaimed. 
     *  SHOULD revert if there is nothing to claim.
     * @param tokenId The NFT token id.
     */</span>
    <span class="k">function</span> <span class="n">claim</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * @notice Number of tokens for the NFT which have been claimed at the current timestamp.
     * @param tokenId The NFT token id.
     * @return payout The total amount of payout tokens claimed for this NFT.
     */</span>
    <span class="k">function</span> <span class="n">claimedPayout</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">payout</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Number of tokens for the NFT which can be claimed at the current timestamp.
     * @dev It is RECOMMENDED that this is calculated as the `vestedPayout()` subtracted from `payoutClaimed()`.
     * @param tokenId The NFT token id.
     * @return payout The amount of unlocked payout tokens for the NFT which have not yet been claimed.
     */</span>
    <span class="k">function</span> <span class="n">claimablePayout</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">payout</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Total amount of tokens which have been vested at the current timestamp. 
     *  This number also includes vested tokens which have been claimed.
     * @dev It is RECOMMENDED that this function calls `vestedPayoutAtTime` 
     *  with `block.timestamp` as the `timestamp` parameter.
     * @param tokenId The NFT token id.
     * @return payout Total amount of tokens which have been vested at the current timestamp.
     */</span>
    <span class="k">function</span> <span class="n">vestedPayout</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">payout</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Total amount of vested tokens at the provided timestamp. 
     *  This number also includes vested tokens which have been claimed.
     * @dev `timestamp` MAY be both in the future and in the past. 
     *  Zero MUST be returned if the timestamp is before the token was minted.
     * @param tokenId The NFT token id.
     * @param timestamp The timestamp to check on, can be both in the past and the future.
     * @return payout Total amount of tokens which have been vested at the provided timestamp.
     */</span>
    <span class="k">function</span> <span class="n">vestedPayoutAtTime</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">timestamp</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">payout</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Number of tokens for an NFT which are currently vesting.
     * @dev The sum of vestedPayout and vestingPayout SHOULD always be the total payout.
     * @param tokenId The NFT token id.
     * @return payout The number of tokens for the NFT which are vesting until a future date.
     */</span>
    <span class="k">function</span> <span class="n">vestingPayout</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">payout</span><span class="p">);</span>

    <span class="cm">/**
     * @notice The start and end timestamps for the vesting of the provided NFT. 
     *  MUST return the timestamp where no further increase in vestedPayout occurs for `vestingEnd`.
     * @param tokenId The NFT token id.
     * @return vestingStart The beginning of the vesting as a unix timestamp.
     * @return vestingEnd The ending of the vesting as a unix timestamp.
     */</span>
    <span class="k">function</span> <span class="n">vestingPeriod</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span> <span class="n">vestingStart</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">vestingEnd</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Token which is used to pay out the vesting claims.
     * @param tokenId The NFT token id.
     * @return token The token which is used to pay out the vesting claims.
     */</span>
    <span class="k">function</span> <span class="n">payoutToken</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">token</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Sets a global `operator` with permission to manage all tokens owned by the current `msg.sender`.
     * @param operator The address to let manage all tokens.
     * @param approved A boolean indicating whether the spender is approved to claim for all tokens.
     */</span>
    <span class="k">function</span> <span class="n">setClaimApprovalForAll</span><span class="p">(</span><span class="kt">address</span> <span class="n">operator</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">approved</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * @notice Sets a tokenId `operator` with permission to manage a single `tokenId` owned by the `msg.sender`.
     * @param operator The address to let manage a single `tokenId`.
     * @param tokenId the `tokenId` to be managed.
     * @param approved A boolean indicating whether the spender is approved to claim for all tokens.
     */</span>
    <span class="k">function</span> <span class="n">setClaimApproval</span><span class="p">(</span><span class="kt">address</span> <span class="n">operator</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">approved</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * @notice Returns true if `owner` has set `operator` to manage all `tokenId`s.
     * @param owner The owner allowing `operator` to manage all `tokenId`s.
     * @param operator The address who is given permission to spend tokens on behalf of the `owner`.
     */</span>
    <span class="k">function</span> <span class="n">isClaimApprovedForAll</span><span class="p">(</span><span class="kt">address</span> <span class="n">owner</span><span class="p">,</span> <span class="kt">address</span> <span class="n">operator</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">isClaimApproved</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Returns the operating address for a `tokenId`. 
     *  If `tokenId` is not managed, then returns the zero address.
     * @param tokenId The NFT `tokenId` to query for a `tokenId` manager.
     */</span>
    <span class="k">function</span> <span class="n">getClaimApproved</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">operator</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="rationale">Rationale</h2>

<h3 id="terms">Terms</h3>

<p>These are base terms used around the specification which function names and definitions are based on.</p>

<ul>
  <li><em>vesting</em>: Tokens which a vesting NFT is vesting until a future date.</li>
  <li><em>vested</em>: Total amount of tokens a vesting NFT has vested.</li>
  <li><em>claimable</em>: Amount of vested tokens which can be unlocked.</li>
  <li><em>claimed</em>: Total amount of tokens unlocked from a vesting NFT.</li>
  <li><em>timestamp</em>: The unix <code class="language-plaintext highlighter-rouge">timestamp</code> (seconds) representation of dates used for vesting.</li>
</ul>

<h3 id="vesting-functions">Vesting Functions</h3>

<p><strong><code class="language-plaintext highlighter-rouge">vestingPayout</code> + <code class="language-plaintext highlighter-rouge">vestedPayout</code></strong></p>

<p><code class="language-plaintext highlighter-rouge">vestingPayout(uint256 tokenId)</code> and <code class="language-plaintext highlighter-rouge">vestedPayout(uint256 tokenId)</code> add up to the total number of tokens which can be claimed by the end of of the vesting schedule. This is also equal to <code class="language-plaintext highlighter-rouge">vestedPayoutAtTime(uint256 tokenId, uint256 timestamp)</code> with <code class="language-plaintext highlighter-rouge">type(uint256).max</code> as the <code class="language-plaintext highlighter-rouge">timestamp</code>.</p>

<p>The rationale for this is to guarantee that the tokens <code class="language-plaintext highlighter-rouge">vested</code> and tokens <code class="language-plaintext highlighter-rouge">vesting</code> are always in sync. The intent is that the vesting curves created are deterministic across the <code class="language-plaintext highlighter-rouge">vestingPeriod</code>. This creates useful opportunities for integration with these NFTs. For example: A vesting schedule can be iterated through and a vesting curve could be visualized, either on-chain or off-chain.</p>

<p><strong><code class="language-plaintext highlighter-rouge">vestedPayout</code> vs <code class="language-plaintext highlighter-rouge">claimedPayout</code> &amp; <code class="language-plaintext highlighter-rouge">claimablePayout</code></strong></p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">vestedPayout</span> <span class="o">-</span> <span class="n">claimedPayout</span> <span class="o">-</span> <span class="n">claimablePayout</span> <span class="o">=</span> <span class="n">lockedPayout</span>
</code></pre></div></div>

<ul>
  <li><code class="language-plaintext highlighter-rouge">vestedPayout(uint256 tokenId)</code> provides the total amount of payout tokens which have <strong>vested</strong> <em>including <code class="language-plaintext highlighter-rouge">claimedPayout(uint256 tokenId)</code></em>.</li>
  <li><code class="language-plaintext highlighter-rouge">claimedPayout(uint256 tokenId)</code> provides the total amount of payout tokens which have been unlocked at the current <code class="language-plaintext highlighter-rouge">timestamp</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">claimablePayout(uint256 tokenId)</code> provides the amount of payout tokens which can be unlocked at the current <code class="language-plaintext highlighter-rouge">timestamp</code>.</li>
</ul>

<p>The rationale for providing three functions is to support a number of features:</p>

<ol>
  <li>The return of <code class="language-plaintext highlighter-rouge">vestedPayout(uint256 tokenId)</code> will always match the return of <code class="language-plaintext highlighter-rouge">vestedPayoutAtTime(uint256 tokenId, uint256 timestamp)</code> with <code class="language-plaintext highlighter-rouge">block.timestamp</code> as the <code class="language-plaintext highlighter-rouge">timestamp</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">claimablePayout(uint256 tokenId)</code> can be used to easily see the current payout unlock amount and allow for unlock cliffs by returning zero until a <code class="language-plaintext highlighter-rouge">timestamp</code> has been passed.</li>
  <li><code class="language-plaintext highlighter-rouge">claimedPayout(uint256 tokenId)</code> is helpful to see tokens unlocked from an NFT and it is also necessary for the calculation of vested-but-locked payout tokens: <code class="language-plaintext highlighter-rouge">vestedPayout - claimedPayout - claimablePayout = lockedPayout</code>. This would depend on how the vesting curves are configured by the an implementation of this standard.</li>
</ol>

<p><code class="language-plaintext highlighter-rouge">vestedPayoutAtTime(uint256 tokenId, uint256 timestamp)</code> provides functionality to iterate through the <code class="language-plaintext highlighter-rouge">vestingPeriod(uint256 tokenId)</code> and provide a visual of the release curve. The intent is that release curves are created which makes <code class="language-plaintext highlighter-rouge">vestedPayoutAtTime(uint256 tokenId, uint256 timestamp)</code> deterministic.</p>

<h3 id="timestamps">Timestamps</h3>

<p>Generally in Solidity development it is advised against using <code class="language-plaintext highlighter-rouge">block.timestamp</code> as a state dependant variable as the timestamp of a block can be manipulated by a miner. The choice to use a <code class="language-plaintext highlighter-rouge">timestamp</code> over a <code class="language-plaintext highlighter-rouge">block</code> is to allow the interface to work across multiple <strong>Ethereum Virtual Machine</strong> (EVM) compatible networks which generally have different block times. Block proposal with a significantly fabricated timestamp will generally be dropped by all node implementations which makes the window for abuse negligible.</p>

<p>The <code class="language-plaintext highlighter-rouge">timestamp</code> makes cross chain integration easy, but internally, the reference implementation keeps track of the token payout per Vesting NFT to ensure that excess tokens alloted by the vesting terms cannot be claimed.</p>

<h3 id="limitation-of-scope">Limitation of Scope</h3>

<ul>
  <li><strong>Historical claims</strong>: While historical vesting schedules can be determined on-chain with <code class="language-plaintext highlighter-rouge">vestedPayoutAtTime(uint256 tokenId, uint256 timestamp)</code>, historical claims would need to be calculated through historical transaction data. Most likely querying for <code class="language-plaintext highlighter-rouge">PayoutClaimed</code> events to build a historical graph.</li>
</ul>

<h3 id="extension-possibilities">Extension Possibilities</h3>

<p>These feature are not supported by the standard as is, but the standard could be extended to support these more advanced features.</p>

<ul>
  <li><strong>Custom Vesting Curves</strong>: This standard intends on returning deterministic <code class="language-plaintext highlighter-rouge">vesting</code> values given NFT <code class="language-plaintext highlighter-rouge">tokenId</code> and a <strong>timestamp</strong> as inputs. This is intentional as it provides for flexibility in how the vesting curves work under the hood which doesn’t constrain projects who intend on building a complex smart contract vesting architecture.</li>
  <li><strong>NFT Rentals</strong>: Further complex DeFi tools can be created if vesting NFTs could be rented.</li>
</ul>

<p>This is done intentionally to keep the base standard simple. These features can and likely will be added through extensions of this standard.</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<ul>
  <li>The Vesting NFT standard is meant to be fully backwards compatible with any current <a href="./eip-721.md">ERC-721</a> integrations and marketplaces.</li>
  <li>The Vesting NFT standard also supports <a href="./eip-165.md">ERC-165</a> interface detection for detecting <code class="language-plaintext highlighter-rouge">EIP-721</code> compatibility, as well as Vesting NFT compatibility.</li>
</ul>

<h2 id="test-cases">Test Cases</h2>

<p>The reference vesting NFT repository includes tests written in Hardhat.</p>

<h2 id="reference-implementation">Reference Implementation</h2>

<p>A reference implementation of this EIP can be found in <a href="../assets/eip-5725/README.md">ERC-5725 assets</a>.</p>

<h2 id="security-considerations">Security Considerations</h2>

<p><strong>timestamps</strong></p>

<ul>
  <li>Vesting schedules are based on timestamps. As such, it’s important to keep track of the number of tokens which have been claimed and to not give out more tokens than alloted for a specific Vesting NFT.
    <ul>
      <li><code class="language-plaintext highlighter-rouge">vestedPayoutAtTime(tokenId, type(uint256).max)</code>, for example, must return the total payout for a given <code class="language-plaintext highlighter-rouge">tokenId</code></li>
    </ul>
  </li>
</ul>

<p><strong>approvals</strong></p>

<ul>
  <li>When an <a href="./eip-721.md">ERC-721</a> approval is made on a Vesting NFT, the operator would have the rights to transfer the Vesting NFT to themselves and then claim the vested tokens.</li>
  <li>When a ERC-5725 approval is made on a Vesting NFT, the operator would have the rights to claim the vested tokens, but not transfer the NFT away from the owner.</li>
</ul>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
