<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Commit Interface | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Commit Interface | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-5732" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-5732" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Commit Interface</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>A simple commit interface to support commit-reveal scheme which provides <strong>only</strong> a commit
method but no reveal method, allowing implementations to integrate this interface
with arbitrary reveal methods such as <code class="language-plaintext highlighter-rouge">vote</code> or <code class="language-plaintext highlighter-rouge">transfer</code>.</p>

<h2 id="motivation">Motivation</h2>

<ol>
  <li>support commit-reveal privacy for applications such as voting.</li>
  <li>make it harder for attackers for front-running, back-running or sandwich attacks.</li>
</ol>

<h2 id="specification">Specification</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119.</p>

<p>Interfaces referenced in this specification are as follows:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">&gt;=</span><span class="mf">0.7</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.9</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// The EIP-165 identifier of this interface is 0xf14fcbc8
</span><span class="k">interface</span> <span class="n">IERC_COMMIT_CORE</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">commit</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_commitment</span><span class="p">)</span> <span class="k">payable</span> <span class="k">external</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">pragma</span> <span class="n">solidity</span> <span class="o">&gt;=</span><span class="mf">0.7</span><span class="p">.</span><span class="mi">0</span> <span class="o">&lt;</span><span class="mf">0.9</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="c1">// The EIP-165 identifier of this interface is 0x67b2ec2c
</span><span class="k">interface</span> <span class="n">IERC_COMMIT_GENERAL</span> <span class="p">{</span>
    <span class="k">event</span> <span class="n">Commit</span><span class="p">(</span>
        <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">_timePoint</span><span class="p">,</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_from</span><span class="p">,</span>
        <span class="kt">bytes32</span> <span class="k">indexed</span> <span class="n">_commitment</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="n">_extraData</span><span class="p">);</span>
    <span class="k">function</span> <span class="n">commitFrom</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">_from</span><span class="p">,</span>
        <span class="kt">bytes32</span> <span class="n">_commitment</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">_extraData</span><span class="p">)</span>
    <span class="k">payable</span> <span class="k">external</span> <span class="k">returns</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">timePoint</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<ol>
  <li>A compliant contract MUST implement the <code class="language-plaintext highlighter-rouge">IERC_COMMIT_CORE</code> interface.</li>
  <li>A compliant contract SHOULD implement the <code class="language-plaintext highlighter-rouge">IERC_COMMIT_GENERAL</code> interface.</li>
  <li>A compliant contract that implements the <code class="language-plaintext highlighter-rouge">IERC_COMMIT_GENERAL</code> interface MUST accept <code class="language-plaintext highlighter-rouge">commit(_commitment)</code> as equivalent to <code class="language-plaintext highlighter-rouge">commitFrom(msg.sender, _commitment, [/*empty array*/])</code>.</li>
  <li>The <code class="language-plaintext highlighter-rouge">timePoint</code> return value of <code class="language-plaintext highlighter-rouge">commitFrom</code> is RECOMMENDED to use <code class="language-plaintext highlighter-rouge">block.timestamp</code> or <code class="language-plaintext highlighter-rouge">block.number</code> or a number that indicates the ordering of different commitments. When <code class="language-plaintext highlighter-rouge">commitFrom</code> is being called.</li>
  <li>
    <p>A compliant contract that implements <code class="language-plaintext highlighter-rouge">IERC_COMMIT_GENERAL</code> MUST emit event <code class="language-plaintext highlighter-rouge">Commit</code> when a commitment is accepted and recorded. In the parameter of both <code class="language-plaintext highlighter-rouge">Commit</code> and the <code class="language-plaintext highlighter-rouge">commitFrom</code> method, the <code class="language-plaintext highlighter-rouge">_timePoint</code> is a time-point-representing value that represents ordering of commitments in which a latter commitment will always have a <em>greater or equal value</em> than a former commitment, such as <code class="language-plaintext highlighter-rouge">block.timestamp</code> or <code class="language-plaintext highlighter-rouge">block.number</code> or other time scale chosen by implementing contracts.</p>
  </li>
  <li>
    <p>The <code class="language-plaintext highlighter-rouge">extraData</code> is reserved for future behavior extension. If the <code class="language-plaintext highlighter-rouge">_from</code> is different from the TX signer, it is RECOMMENDED that compliant contract SHOULD validate signature for <code class="language-plaintext highlighter-rouge">_from</code>. For EOAs this will be validating its ECDSA signatures on chain. For smart contract accounts, it is RECOMMENDED to use <a href="./eip-1271.md">EIP-1271</a> to validate the signatures.</p>
  </li>
  <li>One or more methods of a compliant contract MAY be used for reveal.</li>
</ol>

<p>But there MUST be a way to supply an extra field of <code class="language-plaintext highlighter-rouge">secret_salt</code>, so that committer can later open the <code class="language-plaintext highlighter-rouge">secret_salt</code> in the reveal TX that exposes the <code class="language-plaintext highlighter-rouge">secret_salt</code>. The size and location of <code class="language-plaintext highlighter-rouge">secret_salt</code> is intentionally unspecified in this EIP to maximize flexibility for integration.</p>

<ol>
  <li>It is RECOMMENDED for compliant contracts to implement <a href="./eip-165.md">EIP-165</a>.</li>
</ol>

<h2 id="rationale">Rationale</h2>

<ol>
  <li>
    <p>One design options is that we can attach a Commit Interface to any individual ERCs such as voting standards or token standards. We choose to have a simple and generalize commit interface so all ERCs can be extended to support commit-reveal without changing their basic method signatures.</p>
  </li>
  <li>
    <p>The key derived design decision we made is we will have  a standardized <code class="language-plaintext highlighter-rouge">commit</code> method without a standardized <code class="language-plaintext highlighter-rouge">reveal</code> method, making room for customized reveal method or using <code class="language-plaintext highlighter-rouge">commit</code> with existing standard.</p>
  </li>
  <li>
    <p>We chose to have a simple one parameter method of <code class="language-plaintext highlighter-rouge">commit</code> in our Core interface to make it fully backward compatible with a few prior-adoptions e.g. ENS</p>
  </li>
  <li>
    <p>We also add a <code class="language-plaintext highlighter-rouge">commitFrom</code> to easy commitment being generated off-chain and submitted by some account on behalf by another account.</p>
  </li>
</ol>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>This EIP is backward compatible with all existing ERCs method signature that has extraData. New EIPs can be designed with an extra field of “salt” to make it easier to support this EIP, but not required.</p>

<p>The <code class="language-plaintext highlighter-rouge">IERC_COMMIT_CORE</code> is backward compatible with ENS implementations and other existing prior-art.</p>

<h2 id="reference-implementation">Reference Implementation</h2>

<h3 id="commit-with-ens-register-as-reveal">Commit with ENS Register as Reveal</h3>

<p>In ENS registering process, currently inside of <code class="language-plaintext highlighter-rouge">ETHRegistrarController</code> contract a commit function is being used to allow registerer fairly register a desire domain to avoid being front-run.</p>

<p>Here is how ENS uses commitment in its registration logic:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">commit</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">commitment</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">commitments</span><span class="p">[</span><span class="n">commitment</span><span class="p">]</span> <span class="o">+</span> <span class="n">maxCommitmentAge</span> <span class="o">&lt;</span> <span class="nb">now</span><span class="p">);</span>
    <span class="n">commitments</span><span class="p">[</span><span class="n">commitment</span><span class="p">]</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>With this EIP it can be updated to</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">commit</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">commitment</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">data</span><span class="p">)</span> <span class="k">public</span> <span class="p">{</span>
    <span class="nb">require</span><span class="p">(</span><span class="n">commitments</span><span class="p">[</span><span class="n">commitment</span><span class="p">]</span> <span class="o">+</span> <span class="n">maxCommitmentAge</span> <span class="o">&lt;</span> <span class="nb">now</span><span class="p">);</span>
    <span class="n">commitments</span><span class="p">[</span><span class="n">commitment</span><span class="p">]</span> <span class="o">=</span> <span class="nb">now</span><span class="p">;</span>
    <span class="k">emit</span> <span class="n">Commit</span><span class="p">(...);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="security-considerations">Security Considerations</h2>

<ol>
  <li>Do not use the reference implementation in production. It is just for demonstration purposes.</li>
  <li>The reveal transactions and parameters, especially <code class="language-plaintext highlighter-rouge">secret_salt</code>, MUST be kept secret before they are revealed.</li>
  <li>The length of <code class="language-plaintext highlighter-rouge">secret_salt</code> must be cryptographically long enough and the random values used to generate <code class="language-plaintext highlighter-rouge">secret_salt</code> must be cryptographically safe.</li>
  <li>Users must NEVER reuse a used <code class="language-plaintext highlighter-rouge">secret_salt</code>. It’s recommended for client applications to warn users who attempt to do so.</li>
  <li>Contract implementations should consider deleting the commitment of a given sender immediately to reduce the chances of a replay attack or re-entry attack.</li>
  <li>Contract implementations may consider including the ordering of commitment received to add restrictions on the order of reveal transactions.</li>
  <li>There is potential for replay attacks across different chainIds or chains resulting from forks. In these cases, the chainId must be included in the generation of commitment. For applications with a higher risk of replay attacks, implementors should consider battle-tested and cryptographically-secure solutions such as <a href="./eip-712.md">EIP-712</a> to compose commitments before creating their own new solution.</li>
  <li>Proper time gaps are suggested if the purpose is to avoid frontrunning attacks.</li>
  <li>For compliant contract that requires the <code class="language-plaintext highlighter-rouge">_timePoint</code> from the next transaction to be <em>strictly greater</em> than that of any previous transaction, <code class="language-plaintext highlighter-rouge">block.timestamp</code> and <code class="language-plaintext highlighter-rouge">block.number</code> are not reliable as two transactions could co-exist in the same block resulting in the same <code class="language-plaintext highlighter-rouge">_timePoint</code> value. In such case, extra measures to enforce this strict monotonicity are required, such as the use of a separate sate variable in the contract to keep track of number of commits it receives, or to reject any second/other TX that shares the same <code class="language-plaintext highlighter-rouge">block.timestamp</code> or <code class="language-plaintext highlighter-rouge">block.number</code>.</li>
</ol>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
