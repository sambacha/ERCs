<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Complex Numbers stored in `bytes32` types | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Complex Numbers stored in `bytes32` types | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-5850" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-5850" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Complex Numbers stored in `bytes32` types</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>This EIP proposes a natural way for complex numbers to be stored in and retrieved from the <code class="language-plaintext highlighter-rouge">bytes32</code> data-type.  It splits the storage space exactly in half and, most importantly, assigns the real number part to the least significant 16 bytes and the imaginary number part to the most significant 16 bytes.</p>

<h2 id="motivation">Motivation</h2>

<p>Complex numbers are an essential tool for many mathematical and scientific calculations.  For example, Fourier Transforms, Characteristic functions, AC Circuits and Navier-Stokes equations all require the concept.</p>

<p>Complex numbers can be represented in many different forms (polynomial, cartesian, polar, exponential).  The EIP creates a standard that can accomodate cartesian, polar and exponential formats with example code given for the Cartesian representation, where a complex number is just the pair of real numbers which gives the real and imaginary co-ordinates of the complex number. Equal storage capacity is assigned to both components and the order they appear is explicitly defined.</p>

<p>Packing complex numbers into a single <code class="language-plaintext highlighter-rouge">bytes32</code> data object halves storage costs and creates a more natural code object that can be passed around the solidity ecosystem.  Existing code may not need to be rewritten for complex numbers.  For example, mappings by <code class="language-plaintext highlighter-rouge">bytes32</code> are common and indexing in the 2D complex plane may improve code legibility.</p>

<p>Decimal numbers, either fix or floating, are not yet fully supported by Solidity so enforcing similar standards for complex versions is premature.  It can be suggested that fixed point methods such as prb-math be used with 18 decimal places, or floating point methods like abdk.  However, it should be noted that this EIP supports any decimal number representation so long as it fits inside the 16 bytes space.</p>

<h2 id="specification">Specification</h2>

<p>A complex number would be defined as <code class="language-plaintext highlighter-rouge">bytes32</code> and a cartesian representation would be initalized with the <code class="language-plaintext highlighter-rouge">cnNew</code> function and converted back with <code class="language-plaintext highlighter-rouge">RealIm</code>, both given below.</p>

<p>To create the complex number one would use</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">cnNew</span><span class="p">(</span><span class="kt">int128</span> <span class="n">_Real</span><span class="p">,</span> <span class="kt">int128</span> <span class="n">_Imag</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">){</span>
    <span class="kt">bytes32</span> <span class="n">Imag32</span> <span class="o">=</span> <span class="kt">bytes16</span><span class="p">(</span><span class="kt">uint128</span><span class="p">(</span><span class="n">_Imag</span><span class="p">));</span>
    <span class="kt">bytes32</span> <span class="n">Real32</span> <span class="o">=</span> <span class="kt">bytes16</span><span class="p">(</span><span class="kt">uint128</span><span class="p">(</span><span class="n">_Real</span><span class="p">));</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Real32</span><span class="o">&gt;&gt;</span> <span class="mi">128</span><span class="p">)</span> <span class="o">|</span> <span class="n">Imag32</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>and to convert back</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">RealIm</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">_cn</span><span class="p">)</span>  <span class="k">public</span> <span class="k">pure</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">int128</span> <span class="n">Real</span><span class="p">,</span> <span class="kt">int128</span> <span class="n">Imag</span><span class="p">){</span>
    <span class="kt">bytes16</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">memory</span> <span class="n">tmp</span> <span class="o">=</span> <span class="p">[</span><span class="kt">bytes16</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="mi">0</span><span class="p">];</span>
    <span class="k">assembly</span> <span class="p">{</span>
        <span class="n">mstore</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">_cn</span><span class="p">)</span>
        <span class="n">mstore</span><span class="p">(</span><span class="n">add</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">_cn</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">Imag</span><span class="o">=</span><span class="kt">int128</span><span class="p">(</span><span class="kt">uint128</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
    <span class="n">Real</span><span class="o">=</span><span class="kt">int128</span><span class="p">(</span><span class="kt">uint128</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="rationale">Rationale</h2>

<p>An EIP is required as this proposal defines a complex numbers storage/type standard for multiple apps to use.</p>

<p>This EIP proposes to package both the real and imaginary within one existing data type, <code class="language-plaintext highlighter-rouge">bytes32</code>.  This allows compact storage without the need for structures and facilitates easy library implementations.  The <code class="language-plaintext highlighter-rouge">bytes32</code> would remain available for existing, non-complex number uses.
Only the split and position of the real &amp; imaginary parts is defined in this EIP.  Manipulation of complex numbers (addition, multiplication etc.), number of decimal places and other such topics are left for other EIP discussions.  This keeps this EIP more focused and therfore more likely to succeed.</p>

<p>Defining real numbers in the 16 least-significant bytes allows direct conversion from <code class="language-plaintext highlighter-rouge">uint128</code> to <code class="language-plaintext highlighter-rouge">bytes32</code> for positive integers less than 2**127.<br />
Direct conversion back from <code class="language-plaintext highlighter-rouge">bytes32</code> -&gt; <code class="language-plaintext highlighter-rouge">uint</code> -&gt; <code class="language-plaintext highlighter-rouge">int</code> are not recommended as the complex number may contain imaginary parts and/or the real part may be negative. It is better to always use <code class="language-plaintext highlighter-rouge">RealIm</code> for separating the complex part.</p>

<p>Libraries for complex number manipulation can be implemented with the <code class="language-plaintext highlighter-rouge">Using Complex for bytes32</code> syntax where <code class="language-plaintext highlighter-rouge">Complex</code> would be the name of the library.</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>There is no impact on other uses of the <code class="language-plaintext highlighter-rouge">bytes32</code> datatype.</p>

<h2 id="security-considerations">Security Considerations</h2>

<p>If complex numbers are manipulated in <code class="language-plaintext highlighter-rouge">bytes32</code> form then overflow checks must be performed manually during the manipulation.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
