<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Elastic Signature | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Elastic Signature | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-6327" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-6327" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Elastic Signature</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>Elastic signature (ES) aims to sign data with a human friendly secret. The secret will be verified fully on-chain and is not stored anywhere. A user can change the secret as often as they need to. The secret does not have a fixed length. The secret will be like a password, which is a better understood concept than private key. This is specifically true for non-technical users. This EIP defines a smart contract interface to verify and authorize operations with ES.</p>

<h2 id="motivation">Motivation</h2>

<p>What would a changeable “private key” enable us? For years, we have been looking for ways to lower on-boarding barrier for users, especially those with less technical experiences. Private key custody solutions seem to provide an user friendly on-boarding experience, but it is vendor dependent and is not decentralized. ES makes a breakthrough with Zero-knowledge technology. Users generate proof of knowing the secret and a smart contract will verify the proof.</p>

<h3 id="use-case">Use case</h3>

<p>ES is an alternative signing algorithm. It is not an either-or solution to the private key. It is designed to serve as an additional signing mechanism on top of the private key signature.</p>

<ul>
  <li>A DeFi app can utilize ES into their transfer fund process. Users will be required to provide their passwords to complete the transaction. This gives an extra protection even if the private key is compromised.</li>
  <li>ES can also be used as a plugin to a smart contract wallet, like Account Abstraction <a href="./eip-4337.md">ERC-4337</a>. A decentralized password is picked instead of the private key. This could lead to a smooth onboarding experiences for new Ethereum Dapp users.</li>
</ul>

<h2 id="specification">Specification</h2>

<p>Let:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">pwdhash</code> represents the hash of the private secret (password).</li>
  <li><code class="language-plaintext highlighter-rouge">datahash</code> represents the hash of an intended transaction data.</li>
  <li><code class="language-plaintext highlighter-rouge">fullhash</code> represents the hash of <code class="language-plaintext highlighter-rouge">datahash</code> and all the well-known variables.</li>
  <li><code class="language-plaintext highlighter-rouge">expiration</code> is the timestamp after which the intended transaction expires.</li>
  <li><code class="language-plaintext highlighter-rouge">allhash</code> represents the hash of <code class="language-plaintext highlighter-rouge">fullhash</code> and <code class="language-plaintext highlighter-rouge">pwdhash</code>.</li>
</ul>

<p>There are three parties involved, Verifier, Requester and Prover.</p>

<ul>
  <li>A verifier,
    <ul>
      <li>SHOULD compute <code class="language-plaintext highlighter-rouge">fullhash</code> from a <code class="language-plaintext highlighter-rouge">datahash</code>, which is provided by the requester.</li>
      <li>SHOULD derive <code class="language-plaintext highlighter-rouge">pwdhash</code> for a given address. The address can be an EOA or a smart contract wallet.</li>
      <li>SHOULD verify the proof with the derived <code class="language-plaintext highlighter-rouge">pwdhash</code>, the computed <code class="language-plaintext highlighter-rouge">fullhash</code> and a <code class="language-plaintext highlighter-rouge">allhash</code>, which is submitted by the requester.</li>
    </ul>
  </li>
  <li>A requester
    <ul>
      <li>SHOULD generate <code class="language-plaintext highlighter-rouge">datahash</code> and decide an <code class="language-plaintext highlighter-rouge">expiration</code>.</li>
      <li>SHALL request a verification from the verifier with,
        <ul>
          <li><code class="language-plaintext highlighter-rouge">proof</code> and <code class="language-plaintext highlighter-rouge">allhash</code> which are provided by the prover;</li>
          <li><code class="language-plaintext highlighter-rouge">datahash</code>;</li>
          <li><code class="language-plaintext highlighter-rouge">expiration</code>.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>A prover
    <ul>
      <li>SHOULD generate the <code class="language-plaintext highlighter-rouge">proof</code> and <code class="language-plaintext highlighter-rouge">allhash</code> from,
        <ul>
          <li><code class="language-plaintext highlighter-rouge">datahash</code> and <code class="language-plaintext highlighter-rouge">expiration</code> which are agreed with the requester;</li>
          <li><code class="language-plaintext highlighter-rouge">nonce</code> and other well-known variables.</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>There are also some requirements.</p>

<ul>
  <li>well-known variable SHOULD be available to all parties.
    <ul>
      <li>SHOULD include a <code class="language-plaintext highlighter-rouge">nonce</code>.</li>
      <li>SHOULD include a <code class="language-plaintext highlighter-rouge">chainid</code>.</li>
      <li>MAY include any variable that is specific to the verifier.</li>
    </ul>
  </li>
  <li>public statements SHOULD include,
    <ul>
      <li>one reflecting the <code class="language-plaintext highlighter-rouge">pwdhash</code>;</li>
      <li>one reflecting the <code class="language-plaintext highlighter-rouge">fullhash</code>;</li>
      <li>one reflecting the <code class="language-plaintext highlighter-rouge">allhash</code>.</li>
    </ul>
  </li>
  <li>The computation of <code class="language-plaintext highlighter-rouge">fullhash</code> SHOULD be agreed by both the verifier and the prover.</li>
  <li>The computation of <code class="language-plaintext highlighter-rouge">datahash</code></li>
</ul>

<h3 id="ielasticsignature-interface"><code class="language-plaintext highlighter-rouge">IElasticSignature</code> Interface</h3>

<p>This is the verifier interface.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">interface</span> <span class="n">IElasticSignature</span> <span class="p">{</span>
    <span class="cm">/**
     * Event emitted after user set/reset their password
     * @param user - an user's address, for whom the password hash is set. It could be a smart contract wallet address
     *  or an EOA wallet address.
     * @param pwdhash - a password hash
     */</span>
    <span class="k">event</span> <span class="n">SetPassword</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">user</span><span class="p">,</span> <span class="kt">uint</span> <span class="k">indexed</span> <span class="n">pwdhash</span><span class="p">);</span>

    <span class="cm">/**
     * Event emitted after a successful verification performed for an user
     * @param user - an user's address, for whom the submitted `proof` is verified. It could be a smart contract wallet
     *  address or an EOA wallet address.
     * @param nonce - a new nonce, which is newly generated to replace the last used nonce. 
     */</span>
    <span class="k">event</span> <span class="n">Verified</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">user</span><span class="p">,</span> <span class="kt">uint</span> <span class="k">indexed</span> <span class="n">nonce</span><span class="p">);</span>

    <span class="cm">/**
     * Get `pwdhash` for a user
     * @param user - a user's address 
     * @return - the `pwdhash` for the given address
     */</span>
    <span class="k">function</span> <span class="n">pwdhashOf</span><span class="p">(</span><span class="kt">address</span> <span class="n">user</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint</span><span class="p">);</span>

    <span class="cm">/**
     * Update an user's `pwdhash`
     * @param proof1 - proof generated by the old password
     * @param expiration1 - old password signing expiry seconds
     * @param allhash1 - allhash generated with the old password
     * @param proof2 - proof generated by the new password
     * @param pwdhash2 - hash of the new password
     * @param expiration2 - new password signing expiry seconds
     * @param allhash2 - allhash generated with the new password
     */</span>
    <span class="k">function</span> <span class="n">resetPassword</span><span class="p">(</span>
        <span class="kt">uint</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="k">memory</span> <span class="n">proof1</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">expiration1</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">allhash1</span><span class="p">,</span>
        <span class="kt">uint</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="k">memory</span> <span class="n">proof2</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">pwdhash2</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">expiration2</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">allhash2</span>
    <span class="p">)</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * Verify a proof for a given user
     * It should be invoked by other contracts. The other contracts provide the `datahash`. The `proof` is generated by
     *  the user. 
     * @param user -  a user's address, for whom the verification will be carried out.
     * @param proof - a proof generated by the password
     * @param datahash - the data what user signing, this is the hash of the data
     * @param expiration - number of seconds from now, after which the proof is expired 
     * @param allhash - public statement, generated along with the `proof`
     */</span>
    <span class="k">function</span> <span class="n">verify</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">user</span><span class="p">,</span>
        <span class="kt">uint</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="k">memory</span> <span class="n">proof</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">datahash</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">expiration</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">allhash</span>
    <span class="p">)</span> <span class="k">external</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">verify</code> function SHOULD be called by another contract. The other contract SHOULD generate the <code class="language-plaintext highlighter-rouge">datahash</code> to call this. The function SHOULD verify if the <code class="language-plaintext highlighter-rouge">allhash</code> is computed correctly and honestly with the password.</p>

<h2 id="rationale">Rationale</h2>

<p>The contract will store everyone’s <code class="language-plaintext highlighter-rouge">pwdhash</code>.</p>

<p><img src="../assets/eip-6327/zkpass-1.png" alt="verifier-contract" /></p>

<p>The chart below shows ZK circuit logic.</p>

<p><img src="../assets/eip-6327/zkpass-2.png" alt="circuit-logic" /></p>

<p>To verify the signature, it needs <code class="language-plaintext highlighter-rouge">proof</code>, <code class="language-plaintext highlighter-rouge">allhash</code>, <code class="language-plaintext highlighter-rouge">pwdhash</code> and <code class="language-plaintext highlighter-rouge">fullhash</code>.</p>

<p><img src="../assets/eip-6327/zkpass-3.png" alt="workflow" /></p>

<p>The prover generates <code class="language-plaintext highlighter-rouge">proof</code> along with the public outputs. They will send all of them to a third-party requester contract. The requester will generate the <code class="language-plaintext highlighter-rouge">datahash</code>. It sends <code class="language-plaintext highlighter-rouge">datahash</code>, <code class="language-plaintext highlighter-rouge">proof</code>, <code class="language-plaintext highlighter-rouge">allhash</code>, <code class="language-plaintext highlighter-rouge">expiration</code> and prover’s address to the verifier contract. The contract verifies that the <code class="language-plaintext highlighter-rouge">datahash</code> is from the prover, which means the withdrawal operation is signed by the prover’s password.</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>This EIP is backward compatible with previous work on signature validation since this method is specific to password based signatures and not EOA signatures.</p>

<h2 id="reference-implementation">Reference Implementation</h2>

<p>Example implementation of a signing contract:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"../interfaces/IElasticSignature.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"./verifier.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">ZKPass</span> <span class="k">is</span> <span class="n">IElasticSignature</span> <span class="p">{</span>
    <span class="n">Verifier</span> <span class="n">verifier</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Verifier</span><span class="p">();</span>

    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="n">pwdhashOf</span><span class="p">;</span>

    <span class="k">mapping</span><span class="p">(</span><span class="kt">address</span> <span class="o">=&gt;</span> <span class="kt">uint</span><span class="p">)</span> <span class="k">public</span> <span class="n">nonceOf</span><span class="p">;</span>

    <span class="k">constructor</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">resetPassword</span><span class="p">(</span>
        <span class="kt">uint</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="k">memory</span> <span class="n">proof1</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">expiration1</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">allhash1</span><span class="p">,</span>
        <span class="kt">uint</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="k">memory</span> <span class="n">proof2</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">pwdhash2</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">expiration2</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">allhash2</span>
    <span class="p">)</span> <span class="k">public</span> <span class="k">override</span> <span class="p">{</span>
        <span class="kt">uint</span> <span class="n">nonce</span> <span class="o">=</span> <span class="n">nonceOf</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">];</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">nonce</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">//init password
</span>
            <span class="n">pwdhashOf</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">pwdhash2</span><span class="p">;</span>
            <span class="n">nonceOf</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">verify</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">proof2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">expiration2</span><span class="p">,</span> <span class="n">allhash2</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="c1">//reset password
</span>
            <span class="c1">// check old pwdhash
</span>            <span class="n">verify</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">proof1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">expiration1</span><span class="p">,</span> <span class="n">allhash1</span><span class="p">);</span>

            <span class="c1">// check new pwdhash
</span>            <span class="n">pwdhashOf</span><span class="p">[</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">]</span> <span class="o">=</span> <span class="n">pwdhash2</span><span class="p">;</span>
            <span class="n">verify</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">proof2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">expiration2</span><span class="p">,</span> <span class="n">allhash2</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">emit</span> <span class="n">SetPassword</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">pwdhash2</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">verify</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">user</span><span class="p">,</span>
        <span class="kt">uint</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="k">memory</span> <span class="n">proof</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">datahash</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">expiration</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">allhash</span>
    <span class="p">)</span> <span class="k">public</span> <span class="k">override</span> <span class="p">{</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="n">block</span><span class="p">.</span><span class="n">timestamp</span> <span class="o">&lt;</span> <span class="n">expiration</span><span class="p">,</span>
            <span class="s">"ZKPass::verify: expired"</span>
        <span class="p">);</span>

        <span class="kt">uint</span> <span class="n">pwdhash</span> <span class="o">=</span> <span class="n">pwdhashOf</span><span class="p">[</span><span class="n">user</span><span class="p">];</span>
        <span class="nb">require</span><span class="p">(</span>
            <span class="n">pwdhash</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s">"ZKPass::verify: user not exist"</span>
        <span class="p">);</span>

        <span class="kt">uint</span> <span class="n">nonce</span> <span class="o">=</span> <span class="n">nonceOf</span><span class="p">[</span><span class="n">user</span><span class="p">];</span>
        <span class="kt">uint</span> <span class="n">fullhash</span> <span class="o">=</span> <span class="kt">uint</span><span class="p">(</span><span class="nb">keccak256</span><span class="p">(</span><span class="n">abi</span><span class="p">.</span><span class="n">encodePacked</span><span class="p">(</span><span class="n">expiration</span><span class="p">,</span> <span class="n">block</span><span class="p">.</span><span class="n">chainid</span><span class="p">,</span> <span class="n">nonce</span><span class="p">,</span> <span class="n">datahash</span><span class="p">)))</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span> <span class="c1">// 256b-&gt;254b
</span>        <span class="nb">require</span><span class="p">(</span>
            <span class="n">verifyProof</span><span class="p">(</span><span class="n">proof</span><span class="p">,</span> <span class="n">pwdhash</span><span class="p">,</span> <span class="n">fullhash</span><span class="p">,</span> <span class="n">allhash</span><span class="p">),</span>
            <span class="s">"ZKPass::verify: verify proof fail"</span>
        <span class="p">);</span>

        <span class="n">nonceOf</span><span class="p">[</span><span class="n">user</span><span class="p">]</span> <span class="o">=</span> <span class="n">nonce</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>

        <span class="k">emit</span> <span class="n">Verified</span><span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">nonce</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">/////////// util ////////////
</span>
    <span class="k">function</span> <span class="n">verifyProof</span><span class="p">(</span>
        <span class="kt">uint</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="k">memory</span> <span class="n">proof</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">pwdhash</span><span class="p">,</span>
        <span class="kt">uint</span> <span class="n">fullhash</span><span class="p">,</span> <span class="c1">//254b
</span>        <span class="kt">uint</span> <span class="n">allhash</span>
    <span class="p">)</span> <span class="k">internal</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span>
            <span class="n">verifier</span><span class="p">.</span><span class="n">verifyProof</span><span class="p">(</span>
                <span class="p">[</span><span class="n">proof</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">proof</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                <span class="p">[[</span><span class="n">proof</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">proof</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="n">proof</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">proof</span><span class="p">[</span><span class="mi">5</span><span class="p">]]],</span>
                <span class="p">[</span><span class="n">proof</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">proof</span><span class="p">[</span><span class="mi">7</span><span class="p">]],</span>
                <span class="p">[</span><span class="n">pwdhash</span><span class="p">,</span> <span class="n">fullhash</span><span class="p">,</span> <span class="n">allhash</span><span class="p">]</span>
            <span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>verifier.sol is auto generated by snarkjs, the source code circuit.circom is below</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">pragma</span> <span class="nx">circom</span> <span class="mf">2.0</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="nx">include</span> <span class="dl">"</span><span class="s2">../../node_modules/circomlib/circuits/poseidon.circom</span><span class="dl">"</span><span class="p">;</span>

<span class="nx">template</span> <span class="nx">Main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">signal</span> <span class="nx">input</span> <span class="k">in</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
    <span class="nx">signal</span> <span class="nx">output</span> <span class="nx">out</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>

    <span class="nx">component</span> <span class="nx">poseidon1</span> <span class="o">=</span> <span class="nx">Poseidon</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
    <span class="nx">component</span> <span class="nx">poseidon2</span> <span class="o">=</span> <span class="nx">Poseidon</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>

    <span class="nx">poseidon1</span><span class="p">.</span><span class="nx">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;==</span> <span class="k">in</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>  <span class="c1">//pwd</span>
    <span class="nx">poseidon1</span><span class="p">.</span><span class="nx">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;==</span> <span class="k">in</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>  <span class="c1">//address</span>
    <span class="nx">out</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;==</span> <span class="nx">poseidon1</span><span class="p">.</span><span class="nx">out</span><span class="p">;</span> <span class="c1">//pwdhash</span>

    <span class="nx">poseidon2</span><span class="p">.</span><span class="nx">inputs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;==</span> <span class="nx">poseidon1</span><span class="p">.</span><span class="nx">out</span><span class="p">;</span>
    <span class="nx">poseidon2</span><span class="p">.</span><span class="nx">inputs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;==</span> <span class="k">in</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">//fullhash</span>
    <span class="nx">out</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;==</span> <span class="k">in</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span> <span class="c1">//fullhash</span>
    <span class="nx">out</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&lt;==</span> <span class="nx">poseidon2</span><span class="p">.</span><span class="nx">out</span><span class="p">;</span> <span class="c1">//allhash</span>
<span class="p">}</span>

<span class="nx">component</span> <span class="nx">main</span> <span class="o">=</span> <span class="nx">Main</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="security-considerations">Security Considerations</h2>

<p>Since the pwdhash is public, it is possible to be crack the password. We estimate the Poseidon hash rate of RTX3090 would be 100Mhash/s, this is the estimate of crack time:</p>

<p>8 chars (number) : 1 secs</p>

<p>8 chars (number + english) : 25 days</p>

<p>8 chars (number + english + symbol) : 594 days</p>

<p>12 chars (number) : 10000 secs</p>

<p>12 chars (number + english) : 1023042 years</p>

<p>12 chars (number + english + symbol) : 116586246 years</p>

<p>The crack difficulty of private key is 2^256, the crack difficulty of 40 chars (number + english + symbol) is 92^40, 92^40 &gt; 2^256, so when password is 40 chars , it is more difficult to be crack than private key.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
