<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Contract clock | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Contract clock | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-6372" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-6372" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Contract clock</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>Many contracts rely on some clock for enforcing delays and storing historical data. While some contracts rely on block numbers, others use timestamps. There is currently no easy way to discover which time-tracking function a contract internally uses. This EIP proposes to standardize an interface for contracts to expose their internal clock and thus improve composability and interoperability.</p>

<h2 id="motivation">Motivation</h2>

<p>Many contracts check or store time-related information. For example, timelock contracts enforce a delay before an operation can be executed. Similarly, DAOs enforce a voting period during which stakeholders can approve or reject a proposal. Last but not least, voting tokens often store the history of voting power using timed snapshots.</p>

<p>Some contracts do time tracking using timestamps while others use block numbers. In some cases, more exotic functions might be used to track time.</p>

<p>There is currently no interface for an external observer to detect which clock a contract uses. This seriously limits interoperability and forces devs to make risky assumptions.</p>

<h2 id="specification">Specification</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119.</p>

<p>Compliant contracts MUST implement the <code class="language-plaintext highlighter-rouge">clock</code> and <code class="language-plaintext highlighter-rouge">CLOCK_MODE</code> functions as specified below.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">interface</span> <span class="n">IERC6372</span> <span class="p">{</span>
  <span class="k">function</span> <span class="n">clock</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint48</span><span class="p">);</span>
  <span class="k">function</span> <span class="n">CLOCK_MODE</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">string</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="methods">Methods</h3>

<h4 id="clock">clock</h4>

<p>This function returns the current timepoint according to the mode the contract is operating on. It MUST be a <strong>non-decreasing</strong> function of the chain, such as <code class="language-plaintext highlighter-rouge">block.timestamp</code> or <code class="language-plaintext highlighter-rouge">block.number</code>.</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">clock</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">function</span>
  <span class="na">stateMutability</span><span class="pi">:</span> <span class="s">view</span>
  <span class="na">inputs</span><span class="pi">:</span> <span class="pi">[]</span>
  <span class="na">outputs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">timepoint</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">uint48</span>
</code></pre></div></div>

<h4 id="clock_mode">CLOCK_MODE</h4>

<p>This function returns a machine-readable string description of the clock the contract is operating on.</p>

<p>This string MUST be formatted like a URL query string (a.k.a. <code class="language-plaintext highlighter-rouge">application/x-www-form-urlencoded</code>), decodable in standard JavaScript with <code class="language-plaintext highlighter-rouge">new URLSearchParams(CLOCK_MODE)</code>.</p>

<ul>
  <li>If operating using <strong>block number</strong>:
    <ul>
      <li>If the block number is that of the <code class="language-plaintext highlighter-rouge">NUMBER</code> opcode (<code class="language-plaintext highlighter-rouge">0x43</code>), then this function MUST return <code class="language-plaintext highlighter-rouge">mode=blocknumber&amp;from=default</code>.</li>
      <li>If it is any other block number, then this function MUST return <code class="language-plaintext highlighter-rouge">mode=blocknumber&amp;from=&lt;CAIP-2-ID&gt;</code>, where <code class="language-plaintext highlighter-rouge">&lt;CAIP-2-ID&gt;</code> is a CAIP-2 Blockchain ID such as <code class="language-plaintext highlighter-rouge">eip155:1</code>.</li>
    </ul>
  </li>
  <li>If operating using <strong>timestamp</strong>, then this function MUST return <code class="language-plaintext highlighter-rouge">mode=timestamp</code>.</li>
  <li>If operating using any other mode, then this function SHOULD return a unique identifier for the encoded <code class="language-plaintext highlighter-rouge">mode</code> field.</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">CLOCK_MODE</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">function</span>
  <span class="na">stateMutability</span><span class="pi">:</span> <span class="s">view</span>
  <span class="na">inputs</span><span class="pi">:</span> <span class="pi">[]</span>
  <span class="na">outputs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">descriptor</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s">string</span>
</code></pre></div></div>

<h3 id="expected-properties">Expected properties</h3>

<ul>
  <li>The <code class="language-plaintext highlighter-rouge">clock()</code> function MUST be non-decreasing.</li>
</ul>

<h2 id="rationale">Rationale</h2>

<p><code class="language-plaintext highlighter-rouge">clock</code> returns <code class="language-plaintext highlighter-rouge">uint48</code> as it is largely sufficient for storing realistic values. In timestamp mode, <code class="language-plaintext highlighter-rouge">uint48</code> will be enough until the year 8921556. Even in block number mode, with 10,000 blocks per second, it would be enough until the year 2861. Using a type smaller than <code class="language-plaintext highlighter-rouge">uint256</code> allows storage packing of timepoints with other associated values, greatly reducing the cost of writing and reading from storage.</p>

<p>Depending on the evolution of the blockchain (particularly layer twos), using a smaller type, such as <code class="language-plaintext highlighter-rouge">uint32</code> might cause issues fairly quickly. On the other hand, anything bigger than <code class="language-plaintext highlighter-rouge">uint48</code> appears wasteful.</p>

<p>In addition to timestamps, it is sometimes necessary to define durations or delays, which are a difference between timestamps. In the general case, we would expect these values to be represented with the same type than timepoints (<code class="language-plaintext highlighter-rouge">uint48</code>). However, we believe that in most cases <code class="language-plaintext highlighter-rouge">uint32</code> is a good alternative, as it represents over 136 years if the clock operates using seconds. In most cases, we recommend using <code class="language-plaintext highlighter-rouge">uint48</code> for storing timepoints and using <code class="language-plaintext highlighter-rouge">uint32</code> for storing durations. That recommendation applies to “reasonable” durations (delay for a timelock, voting or vesting duration, …) when operating with timestamps or block numbers that are more than 1 second apart.</p>

<h2 id="security-considerations">Security Considerations</h2>

<p>No known security issues.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
