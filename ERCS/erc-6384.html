<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Human-readable offline signatures | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Human-readable offline signatures | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-6384" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-6384" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Human-readable offline signatures</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>This EIP introduces the <code class="language-plaintext highlighter-rouge">evalEIP712Buffer</code> function, which takes an <a href="./eip-712.md">EIP-712</a> buffer and returns a human-readable text description.</p>

<h2 id="motivation">Motivation</h2>

<p>The use case of Web3 off-chain signatures intended to be used within on-chain transaction is gaining traction and being used in multiple leading protocols (e.g. OpenSea) and standards <a href="./eip-2612.md">EIP-2612</a>, mainly as it offers a fee-less experience.
Attackers are known to actively and successfully abuse such off-chain signatures, leveraging the fact that users are blindly signing off-chain messages, since they are not humanly readable.
While <a href="./eip-712.md">EIP-712</a> originally declared in its title that being ”humanly readable” is one of its goals, it did not live up to its promise eventually and EIP-712 messages are not understandable by an average user.</p>

<p>In one example, victims browse a malicious phishing website. It requests the victim to sign a message that will put their NFT token for sale on OpenSea platform, virtually for free.</p>

<p>The user interface for some popular wallet implementations is not conveying the actual meaning of signing such transactions.</p>

<p>In this proposal we offer a secure and scalable method to bring true human readability to EIP-712 messages by leveraging their bound smart contracts.
As a result, once implemented this EIP wallets can upgrade their user experience from current state:</p>

<p><img src="../assets/eip-6384/media/MiceyMask-non-compliant.png" alt="" /></p>

<p>to a much clearer user experience:</p>

<p><img src="../assets/eip-6384/media/ZenGo-EIP-compliant-warning.png" alt="" /></p>

<p>The proposed solution solves the readability issues by allowing the wallet to query the <code class="language-plaintext highlighter-rouge">verifyingContract</code>. The incentives for keeping the EIP-712 message description as accurate as possible are aligned, as the responsibility for the description is now owned by the contract, that:</p>

<ul>
  <li>Knows the message meaning exactly (and probably can reuse the code that handles this message when received on chain)</li>
  <li>Natively incentivized to provide the best explanation to prevent a possible fraud</li>
  <li>Not involving a third party that needs to be trusted</li>
  <li>Maintains the fee-less customer experience as the added function is in “view” mode and does not require an on-chain execution and fees.</li>
  <li>Maintains Web3’s composability property</li>
</ul>

<h2 id="specification">Specification</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119.</p>

<p>EIP-712 already formally binds an off-chain signature to a contract, with the <code class="language-plaintext highlighter-rouge">verifyingContract</code> parameter. We suggest adding a “view” function (<code class="language-plaintext highlighter-rouge">"stateMutability":"view"</code>) to such contracts, that returns a human readable description of the meaning of this specific off-chain buffer.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @dev Returns the expected result of the offchain message.
*/</span>

     <span class="k">function</span> <span class="n">evalEIP712Buffer</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">domainHash</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">primaryType</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">typedDataBuffer</span><span class="p">)</span>
     <span class="k">external</span>
     <span class="k">view</span>
     <span class="k">returns</span> <span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="k">memory</span><span class="p">)</span> <span class="p">{</span>
   <span class="p">...</span>

<span class="p">}</span>
</code></pre></div></div>

<p><strong>Every compliant contract MUST implement this function.</strong></p>

<p>Using this function, wallets can submit the proposed off-chain signature to the contract and present the results to the user, allowing them to enjoy an “on-chain simulation equivalent” experience to their off-chain message.</p>

<p>This function will have a well known name and signature, such that there is no need for updates in the EIP-712 structure.</p>

<h3 id="functions-inputs">Function’s inputs</h3>

<p>The inputs of the function:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">domainHash</code> is the EIP-712’s domainSeparator, a hashed <code class="language-plaintext highlighter-rouge">eip712Domain</code> struct.</li>
  <li><code class="language-plaintext highlighter-rouge">primaryType</code>is the EIP-712’s <code class="language-plaintext highlighter-rouge">primaryType</code>.</li>
  <li><code class="language-plaintext highlighter-rouge">typedDataBuffer</code> is an ABI encoded message part of the EIP-712 full message.</li>
</ul>

<h3 id="functions-outputs">Function’s output(s)</h3>

<p>The output of the the function is an array of strings. The wallet SHOULD display them to its end-users. The wallet MAY choose to augment the returned strings with additional data. (e.g. resolve contract addresses to their name)</p>

<p>The strings SHOULD NOT be formatted (e.g. should not contain HTML code) and wallets SHOULD treat this string as an untrusted input and handle its rendering as such.</p>

<h3 id="support-for-eip-712-messages-that-are-not-meant-to-be-used-on-chain">Support for EIP-712 messages that are not meant to be used on-chain</h3>

<p>If <code class="language-plaintext highlighter-rouge">verifyingContract</code> is not included in the EIP-712 domain separator, wallets MUST NOT retrieve a human-readable description using this EIP. In this case, wallets SHOULD fallback to their original EIP-712 display.</p>

<h2 id="rationale">Rationale</h2>

<ul>
  <li>We chose to implement the <code class="language-plaintext highlighter-rouge">typeDataBuffer</code> parameter as abi encoded as it is a generic way to pass the data to the contract. The alternative was to pass the <code class="language-plaintext highlighter-rouge">typedData</code> struct, which is not generic as it requires the contract to specify the message data.</li>
  <li>We chose to return an array of strings and not a single string as there are potential cases where the message is composed of multiple parts. For example, in the case of a multiple assets transfers in the same <code class="language-plaintext highlighter-rouge">typedDataBuffer</code>, the contract is advised to describe each transfer in a separate string to allow the wallet to display each transfer separately.</li>
</ul>

<h3 id="alternative-solutions">Alternative solutions</h3>

<h4 id="third-party-services">Third party services:</h4>

<p>Currently, the best choice for users is to rely on some 3rd party solutions that get the proposed message as input and explain its intended meaning to the user. This approach is:</p>

<ul>
  <li>Not scalable: 3rd party provider needs to learn all such proprietary messages</li>
  <li>Not necessarily correct: the explanation is based on 3rd party interpretation of the original message author</li>
  <li>Introduces an unnecessary dependency of a third party which may have some operational, security, and privacy implications.</li>
</ul>

<h4 id="domain-name-binding">Domain name binding</h4>

<p>Alternatively, wallets can bind domain name to a signature. i.e. only accept EIP-712 message if it comes from a web2 domain that its <code class="language-plaintext highlighter-rouge">name</code> as defined by EIP-712 is included in <code class="language-plaintext highlighter-rouge">eip712Domain</code>. However this approach has the following disadvantages:</p>

<ul>
  <li>It breaks Web3’s composability, as now other dapps cannot interact with such messages</li>
  <li>Does not protect against bad messages coming from the specified web2 domain, e.g. when web2 domain is hacked</li>
  <li>Some current connector, such as WalletConnect do not allow wallets to verify the web2 domain authenticity</li>
</ul>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>For non-supporting contracts the wallets will default to showing whatever they are showing today.
Non-supporting wallets will not call this function and will default to showing whatever they are showing today.</p>

<h2 id="reference-implementation">Reference Implementation</h2>

<p>A reference implementation can be found <a href="../assets/eip-6384/implementation/src/MyToken/MyToken.sol">here</a>.
This toy example shows how an <a href="./eip-20.md">EIP-20</a> contract supporting this EIP implements an EIP-712 support for “transferWithSig” functionality (a non-standard variation on Permit, as the point of this EIP is to allow readability to non-standard EIP-712 buffers).
To illustrate the usability of this EIP to some real world use case, a helper function for the actual OpenSea’s SeaPort EIP-712 is implemented too in <a href="../assets/eip-6384/implementation/src/SeaPort/SeaPort712ParserHelper.sol">here</a>.</p>

<h2 id="security-considerations">Security Considerations</h2>

<h3 id="the-threat-model">The threat model:</h3>

<p>The attack is facilitated by a rogue web2 interface (“dapp”) that provides bad parameters for an EIP-712 formatted message that is intended to be consumed by a legitimate contract. Therefore, the message is controlled by attackers and cannot be trusted, however the contract is controlled by a legitimate party and can be trusted.</p>

<p>The attacker intends to use that signed EIP-712 message on-chain later on, with a transaction crafted by the attackers. If the subsequent on-chain transaction was to be sent by the victim, then a regular transaction simulation would have sufficed.</p>

<p>The case of a rogue contract is irrelevant, as such a rogue contract can already facilitate the attack regardless of the existence of the EIP-712 formatted message.</p>

<p>Having said that, a rogue contract may try to abuse this functionality in order to send some maliciously crafted string in order to exploit vulnerabilities in wallet rendering of the string. Therefore wallets should treat this string as an untrusted input and handle its renderring it as such.</p>

<h3 id="analysis-of-the-proposed-solution">Analysis of the proposed solution</h3>

<p>The explanation is controlled by the relevant contract which is controlled by a legitimate party. The attacker must specify the relevant contract address, as otherwise it will not be accepted by it. Therefore, the attacker cannot create false explanations using this method.
Please note that if the explanation was part of the message to sign it would have been under the control of the attacker and hence irrelevant for security purposes.</p>

<p>Since the added functionality to the contract has the “view” modifier, it cannot change the on-chain state and harm the existing functionalities of the contract.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
