<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Multi-operator, per-token ERC-721 approvals. | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Multi-operator, per-token ERC-721 approvals. | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-6464" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-6464" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Multi-operator, per-token ERC-721 approvals.</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p><a href="./eip-721.md">ERC-721</a> did not foresee the approval of multiple operators to manage a specific token on behalf of its owner. This lead to the establishment of <code class="language-plaintext highlighter-rouge">setApprovalForAll()</code> as the predominant way to authorise operators, which affords the approved address control over all assets and creates an unnecessarily broad security risk that has already been exploited in a multitude of phishing attacks. The presented EIP extends ERC-721 by introducing a fine-grained, on-chain approval mechanism that allows owners to authorise multiple, specific operators on a per-token basis; this removes unnecessary access permissions and shrinks the surface for exploits to a minimum. The provided reference implementation further enables cheap revocation of all approvals on a per-owner or per-token basis.</p>

<h2 id="motivation">Motivation</h2>

<p>The NFT standard defined in ERC-721 allows token owners to “approve” arbitrary addresses to control their tokens—the approved addresses are known as “operators”. Two types of approval were defined:</p>

<ol>
  <li><code class="language-plaintext highlighter-rouge">approve(address,uint256)</code> provides a mechanism for only a single operator to be approved for a given <code class="language-plaintext highlighter-rouge">tokenId</code>; and</li>
  <li><code class="language-plaintext highlighter-rouge">setApprovalForAll(address,bool)</code> toggles whether an operator is approved for <em>every</em> token owned by <code class="language-plaintext highlighter-rouge">msg.sender</code>.</li>
</ol>

<p>With the introduction of multiple NFT marketplaces, the ability to approve multiple operators for a particular token is necessary if sellers wish to allow each marketplace to transfer a token upon sale. There is, however, no mechanism for achieving this without using <code class="language-plaintext highlighter-rouge">setApprovalForAll()</code>. This is in conflict with the principle of least privilege and creates an attack vector that is exploited by phishing for malicious (i.e. zero-cost) sell-side signatures that are executed by legitimate marketplace contracts.</p>

<p>This EIP therefore defines a fine-grained approach for approving multiple operators but scoped to specific token(s).</p>

<h3 id="goals">Goals</h3>

<ol>
  <li>Ease of adoption for marketplaces; requires minimal changes to existing workflows.</li>
  <li>Ease of adoption for off-chain approval-indexing services.</li>
  <li>Simple revocation of approvals; i.e. not requiring one per grant.</li>
</ol>

<h3 id="non-goals">Non-goals</h3>

<ol>
  <li>Security measures for protecting NFTs other than through limiting the scope of operator approvals.</li>
  <li>Compatibility with <a href="./eip-1155.md">ERC-1155</a> semi-fungible tokens. However we note that the mechanisms described herein are also applicable to ERC-1155 token <em>types</em> without requiring approval for all other types.</li>
</ol>

<h2 id="specification">Specification</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>

<p>To comply with this EIP, a contract MUST implement <code class="language-plaintext highlighter-rouge">IERC6464</code> (defined herein) and the <code class="language-plaintext highlighter-rouge">ERC165</code> and <code class="language-plaintext highlighter-rouge">ERC721</code> interfaces; see <a href="./eip-165.md">ERC-165</a> and ERC-721 respectively.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @notice Extends ERC-721 to include per-token approval for multiple operators.
 * @dev Off-chain indexers of approvals SHOULD assume that an operator is approved if either of `ERC721.Approval(…)` or
 * `ERC721.ApprovalForAll(…, true)` events are witnessed without the corresponding revocation(s), even if an
 * `ExplicitApprovalFor(…, false)` is emitted.
 * @dev TODO: the ERC-165 identifier for this interface is TBD.
 */</span>
<span class="k">interface</span> <span class="n">IERC6464</span> <span class="k">is</span> <span class="n">ERC721</span> <span class="p">{</span>
    <span class="cm">/**
     * @notice Emitted when approval is explicitly granted or revoked for a token.
     */</span>
    <span class="k">event</span> <span class="n">ExplicitApprovalFor</span><span class="p">(</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">operator</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">tokenId</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">approved</span>
    <span class="p">);</span>

    <span class="cm">/**
     * @notice Emitted when all explicit approvals, as granted by either `setExplicitApprovalFor()` function, are
     * revoked for all tokens.
     * @dev MUST be emitted upon calls to `revokeAllExplicitApprovals()`.
     */</span>
    <span class="k">event</span> <span class="n">AllExplicitApprovalsRevoked</span><span class="p">(</span><span class="kt">address</span> <span class="k">indexed</span> <span class="n">owner</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Emitted when all explicit approvals, as granted by either `setExplicitApprovalFor()` function, are
     * revoked for the specific token.
     * @param owner MUST be `ownerOf(tokenId)` as per ERC721; in the case of revocation due to transfer, this MUST be
     * the `from` address expected to be emitted in the respective `ERC721.Transfer()` event.
     */</span>
    <span class="k">event</span> <span class="n">AllExplicitApprovalsRevoked</span><span class="p">(</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">owner</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">tokenId</span>
    <span class="p">);</span>

    <span class="cm">/**
     * @notice Approves the operator to manage the asset on behalf of its owner.
     * @dev Throws if `msg.sender` is not the current NFT owner, or an authorised operator of the current owner.
     * @dev Approvals set via this method MUST be revoked upon transfer of the token to a new owner; equivalent to
     * calling `revokeAllExplicitApprovals(tokenId)`, including associated events.
     * @dev MUST emit `ApprovalFor(operator, tokenId, approved)`.
     * @dev MUST NOT have an effect on any standard ERC721 approval setters / getters.
     */</span>
    <span class="k">function</span> <span class="n">setExplicitApproval</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">operator</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">approved</span>
    <span class="p">)</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * @notice Approves the operator to manage the token(s) on behalf of their owner.
     * @dev MUST be equivalent to calling `setExplicitApprovalFor(operator, tokenId, approved)` for each `tokenId` in
     * the array.
     */</span>
    <span class="k">function</span> <span class="n">setExplicitApproval</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">operator</span><span class="p">,</span>
        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">tokenIds</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">approved</span>
    <span class="p">)</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * @notice Revokes all explicit approvals granted by `msg.sender`.
     * @dev MUST emit `AllExplicitApprovalsRevoked(msg.sender)`.
     */</span>
    <span class="k">function</span> <span class="n">revokeAllExplicitApprovals</span><span class="p">()</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * @notice Revokes all excplicit approvals granted for the specified token.
     * @dev Throws if `msg.sender` is not the current NFT owner, or an authorised operator of the current owner.
     * @dev MUST emit `AllExplicitApprovalsRevoked(msg.sender, tokenId)`.
     */</span>
    <span class="k">function</span> <span class="n">revokeAllExplicitApprovals</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * @notice Query whether an address is an approved operator for a token.
     */</span>
    <span class="k">function</span> <span class="n">isExplicitlyApprovedFor</span><span class="p">(</span><span class="kt">address</span> <span class="n">operator</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span>
        <span class="k">external</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">interface</span> <span class="n">IERC6464AnyApproval</span> <span class="k">is</span> <span class="n">ERC721</span> <span class="p">{</span>
    <span class="cm">/**
     * @notice Returns true if any of the following criteria are met:
     * 1. `isExplicitlyApprovedFor(operator, tokenId) == true`; OR
     * 2. `isApprovedForAll(ownerOf(tokenId), operator) == true`; OR
     * 3. `getApproved(tokenId) == operator`.
     * @dev The criteria MUST be extended if other mechanism(s) for approving operators are introduced. The criteria
     * MUST include all approval approaches.
     */</span>
    <span class="k">function</span> <span class="n">isApprovedFor</span><span class="p">(</span><span class="kt">address</span> <span class="n">operator</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span>
        <span class="k">external</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="rationale">Rationale</h2>

<h3 id="draft-notes-to-be-expanded-upon">Draft notes to be expanded upon</h3>

<ol>
  <li>Approvals granted via the newly introduced methods are called <em>explicit</em> as a means of easily distinguishing them from those granted via the standard <code class="language-plaintext highlighter-rouge">ERC721.approve()</code> and <code class="language-plaintext highlighter-rouge">ERC721.setApprovalForAll()</code> functions. However they follow the same intent: authorising operators to act on the owner’s behalf.</li>
  <li>Abstracting <code class="language-plaintext highlighter-rouge">isApprovedFor()</code> into <code class="language-plaintext highlighter-rouge">IERC6464AnyApproval</code> interface, as against keeping it in <code class="language-plaintext highlighter-rouge">IERC6464</code> allows for modularity of plain <code class="language-plaintext highlighter-rouge">IERC6464</code> implementations while also standardising the interface for checking approvals when interfacing with specific implementations and any future approval EIPs.</li>
  <li>Inclusion of an indexed owner address in <code class="language-plaintext highlighter-rouge">AllExplicitApprovalsRevoked(address,uint256)</code> assists off-chain indexing of existing approvals.</li>
  <li>Re <code class="language-plaintext highlighter-rouge">IERC6464AnyApproval</code>: With an increasing number of approval mechanisms it becomes cumbersome for marketplaces to integrate with them since they have to query multiple interfaces to check if they are approved to manage tokens. This provides a streamlined interface, intended to simplify data ingestion for them.</li>
</ol>

<!--
  The rationale fleshes out the specification by describing what motivated the design and why particular design decisions were made. It should describe alternate designs that were considered and related work, e.g. how the feature is supported in other languages.

  The current placeholder is acceptable for a draft.

  TODO: Remove this comment before submitting
-->

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>This extension was written to allow for the smallest change possible to the original ERC-721 spec while still providing a mechanism to grant, revoke and track approvals of multiple operators on a per-token basis.</p>

<p>Extended contracts remain fully compatible with all existing platforms.</p>

<p><strong>Note</strong> the <code class="language-plaintext highlighter-rouge">Security Considerations</code> sub-section on <code class="language-plaintext highlighter-rouge">Other risks</code> regarding interplay of approval types.</p>

<h2 id="reference-implementation">Reference Implementation</h2>

<p>TODO: add internal link to assets directory when the implementation is in place.</p>

<p>An efficient mechanism for broad revocation of approvals via incrementing nonces is included.</p>

<h2 id="security-considerations">Security Considerations</h2>

<h3 id="threat-model">Threat model</h3>

<h3 id="mitigations">Mitigations</h3>

<h3 id="other-risks">Other risks</h3>

<p>TODO: Interplay with <code class="language-plaintext highlighter-rouge">setApprovalForAll()</code>.</p>

<!--
  All EIPs must contain a section that discusses the security implications/considerations relevant to the proposed change. Include information that might be important for security discussions, surfaces risks and can be used throughout the life cycle of the proposal. For example, include security-relevant design decisions, concerns, important discussions, implementation-specific guidance and pitfalls, an outline of threats and risks and how they are being addressed. EIP submissions missing the "Security Considerations" section will be rejected. An EIP cannot proceed to status "Final" without a Security Considerations discussion deemed sufficient by the reviewers.

  The current placeholder is acceptable for a draft.

  TODO: Remove this comment before submitting
-->

<p>Needs discussion.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
