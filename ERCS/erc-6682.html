<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>NFT Flashloans | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="NFT Flashloans | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-6682" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-6682" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">NFT Flashloans</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>This standard is an extension of the existing flashloan standard (<a href="./eip-3156.md">ERC-3156</a>) to support <a href="./eip-721.md">ERC-721</a> NFT flashloans. It proposes a way for flashloan providers to lend NFTs to contracts, with the condition that the loan is repaid in the same transaction along with some fee.</p>

<h2 id="motivation">Motivation</h2>

<p>The current flashloan standard, <a href="./eip-3156.md">ERC-3156</a>, only supports <a href="./eip-20.md">ERC-20</a> tokens. ERC-721 tokens are sufficiently different from ERC-20 tokens that they require an extension of this existing standard to support them.</p>

<p>An NFT flash loan could be useful in any action where NFT ownership is checked. For example, claiming airdrops, claiming staking rewards, or taking an in-game action such as claiming farmed resources.</p>

<h2 id="specification">Specification</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>

<h3 id="contract-interface">Contract Interface</h3>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">19</span><span class="p">;</span>

<span class="k">interface</span> <span class="n">IERC6682</span> <span class="p">{</span>
    <span class="c1">/// @dev The address of the token used to pay flash loan fees.
</span>    <span class="k">function</span> <span class="n">flashFeeToken</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>

    <span class="c1">/// @dev Whether or not the NFT is available for a flash loan.
</span>    <span class="c1">/// @param token The address of the NFT contract.
</span>    <span class="c1">/// @param tokenId The ID of the NFT.
</span>    <span class="k">function</span> <span class="n">availableForFlashLoan</span><span class="p">(</span><span class="kt">address</span> <span class="n">token</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">flashFeeToken</code> function MUST return the address of the token used to pay flash loan fees.</p>

<p>If the token used to pay the flash loan fees is ETH then <code class="language-plaintext highlighter-rouge">flashFeeToken</code> MUST return <code class="language-plaintext highlighter-rouge">address(0)</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">availableForFlashLoan</code> function MUST return whether or not the <code class="language-plaintext highlighter-rouge">tokenId</code> of <code class="language-plaintext highlighter-rouge">token</code> is available for a flashloan. If the <code class="language-plaintext highlighter-rouge">tokenId</code> is not currently available for a flashloan <code class="language-plaintext highlighter-rouge">availableForFlashLoan</code> MUST return <code class="language-plaintext highlighter-rouge">false</code> instead of reverting.</p>

<p>Implementers <code class="language-plaintext highlighter-rouge">MUST</code> also implement <code class="language-plaintext highlighter-rouge">IERC3156FlashLender</code>.</p>

<h2 id="rationale">Rationale</h2>

<p>The above modifications are the simplest possible additions to the existing flashloan standard to support NFTs.</p>

<p>We choose to extend as much of the existing flashloan standard (<a href="./eip-3156.md">ERC-3156</a>) as possible instead of creating a wholly new standard because the flashloan standard is already widely adopted and few changes are required to support NFTs.</p>

<p>In most cases, the handling of fee payments will be desired to be paid in a separate currency to the loaned NFTs because NFTs themselves cannot always be fractionalized. Consider the following example where the flashloan provider charges a 0.1 ETH fee on each NFT that is flashloaned; The interface must provide methods that allow the borrower to determine the fee rate on each NFT and also the currency that the fee should be paid in.</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>This EIP is fully backwards compatible with <a href="./eip-3156.md">ERC-3156</a> with the exception of the <code class="language-plaintext highlighter-rouge">maxFlashLoan</code> method. This method does not make sense within the context of NFTs because NFTs are not fungible. However it is part of the existing flashloan standard and so it is not possible to remove it without breaking backwards compatibility. It is RECOMMENDED that any contract implementing this EIP without the intention of supporting ERC-20 flashloans should always return <code class="language-plaintext highlighter-rouge">1</code> from <code class="language-plaintext highlighter-rouge">maxFlashLoan</code>. The <code class="language-plaintext highlighter-rouge">1</code> reflects the fact that only one NFT can be flashloaned per <code class="language-plaintext highlighter-rouge">flashLoan</code> call. For example:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">maxFlashLoan</span><span class="p">(</span><span class="kt">address</span> <span class="n">token</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// if a contract also supports flash loans for ERC20 tokens then it can
</span>    <span class="c1">// return some value here instead of 1
</span>    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="reference-implementation">Reference Implementation</h2>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SPDX-License-Identifier: CC0-1.0
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">19</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"../interfaces/IERC20.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"../interfaces/IERC721.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"../interfaces/IERC3156FlashBorrower.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"../interfaces/IERC3156FlashLender.sol"</span><span class="p">;</span>
<span class="k">import</span> <span class="s">"../interfaces/IERC6682.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">ExampleFlashLender</span> <span class="k">is</span> <span class="n">IERC6682</span><span class="p">,</span> <span class="n">IERC3156FlashLender</span> <span class="p">{</span>
    <span class="kt">uint256</span> <span class="k">internal</span> <span class="n">_feePerNFT</span><span class="p">;</span>
    <span class="kt">address</span> <span class="k">internal</span> <span class="n">_flashFeeToken</span><span class="p">;</span>

    <span class="k">constructor</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">feePerNFT_</span><span class="p">,</span> <span class="kt">address</span> <span class="n">flashFeeToken_</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">_feePerNFT</span> <span class="o">=</span> <span class="n">feePerNFT_</span><span class="p">;</span>
        <span class="n">_flashFeeToken</span> <span class="o">=</span> <span class="n">flashFeeToken_</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">flashFeeToken</span><span class="p">()</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_flashFeeToken</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">availableForFlashLoan</span><span class="p">(</span><span class="kt">address</span> <span class="n">token</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// return if the NFT is owned by this contract
</span>        <span class="k">try</span> <span class="n">IERC721</span><span class="p">(</span><span class="n">token</span><span class="p">).</span><span class="n">ownerOf</span><span class="p">(</span><span class="n">tokenId</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span> <span class="n">result</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">result</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">flashFee</span><span class="p">(</span><span class="kt">address</span> <span class="n">token</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">)</span> <span class="k">public</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">_feePerNFT</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">flashLoan</span><span class="p">(</span><span class="n">IERC3156FlashBorrower</span> <span class="n">receiver</span><span class="p">,</span> <span class="kt">address</span> <span class="n">token</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">calldata</span> <span class="n">data</span><span class="p">)</span>
        <span class="k">public</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// check that the NFT is available for a flash loan
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">availableForFlashLoan</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">),</span> <span class="s">"IERC6682: NFT not available for flash loan"</span><span class="p">);</span>

        <span class="c1">// transfer the NFT to the borrower
</span>        <span class="n">IERC721</span><span class="p">(</span><span class="n">token</span><span class="p">).</span><span class="n">safeTransferFrom</span><span class="p">(</span><span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="kt">address</span><span class="p">(</span><span class="n">receiver</span><span class="p">),</span> <span class="n">tokenId</span><span class="p">);</span>

        <span class="c1">// calculate the fee
</span>        <span class="kt">uint256</span> <span class="n">fee</span> <span class="o">=</span> <span class="n">flashFee</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">);</span>

        <span class="c1">// call the borrower
</span>        <span class="kt">bool</span> <span class="n">success</span> <span class="o">=</span>
            <span class="n">receiver</span><span class="p">.</span><span class="n">onFlashLoan</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">tokenId</span><span class="p">,</span> <span class="n">fee</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">keccak256</span><span class="p">(</span><span class="s">"ERC3156FlashBorrower.onFlashLoan"</span><span class="p">);</span>

        <span class="c1">// check that flashloan was successful
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">success</span><span class="p">,</span> <span class="s">"IERC6682: Flash loan failed"</span><span class="p">);</span>
        
        <span class="c1">// check that the NFT was returned by the borrower
</span>        <span class="nb">require</span><span class="p">(</span><span class="n">IERC721</span><span class="p">(</span><span class="n">token</span><span class="p">).</span><span class="n">ownerOf</span><span class="p">(</span><span class="n">tokenId</span><span class="p">)</span> <span class="o">==</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="s">"IERC6682: NFT not returned by borrower"</span><span class="p">);</span>

        <span class="c1">// transfer the fee from the borrower
</span>        <span class="n">IERC20</span><span class="p">(</span><span class="n">flashFeeToken</span><span class="p">()).</span><span class="n">transferFrom</span><span class="p">(</span><span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">,</span> <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">),</span> <span class="n">fee</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">success</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">maxFlashLoan</span><span class="p">(</span><span class="kt">address</span> <span class="n">token</span><span class="p">)</span> <span class="k">public</span> <span class="k">pure</span> <span class="k">override</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// if a contract also supports flash loans for ERC20 tokens then it can
</span>        <span class="c1">// return some value here instead of 1
</span>        <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">onERC721Received</span><span class="p">(</span><span class="kt">address</span><span class="p">,</span> <span class="kt">address</span><span class="p">,</span> <span class="kt">uint256</span><span class="p">,</span> <span class="kt">bytes</span> <span class="k">memory</span><span class="p">)</span> <span class="k">public</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes4</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nb">this</span><span class="p">.</span><span class="n">onERC721Received</span><span class="p">.</span><span class="nb">selector</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="security-considerations">Security Considerations</h2>

<p>It’s possible that the <code class="language-plaintext highlighter-rouge">flashFeeToken</code> method could return a malicious contract. Borrowers who intend to call the address that is returned from the <code class="language-plaintext highlighter-rouge">flashFeeToken</code> method should take care to ensure that the contract is not malicious. One way they could do this is by verifying that the returned address from <code class="language-plaintext highlighter-rouge">flashFeeToken</code> matches that of a user input.</p>

<p>Needs discussion.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
