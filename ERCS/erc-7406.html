<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Multi-Namespace Onchain Registry | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Multi-Namespace Onchain Registry | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-7406" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-7406" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Multi-Namespace Onchain Registry</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>This EIP proposes a universally accepted description for onchain registry entries with support for multi-namespaces, where each entry is structured as a mapping type. The multi-namespace registry enables the storage of a collection of key-value mappings within the blockchain, serving as a definitive source of information with a traceable history of changes. These mapping records act as pointers combined with onchain assets, offering enhanced versatility in various use cases by encapsulating extensive details. The proposed solution introduces a general mapping data structure that is flexible enough to support and be compatible with different situations, providing a more scalable and powerful alternative to current ENS-like registries.</p>

<h2 id="motivation">Motivation</h2>

<p>Blockchain-based registries are fundamental components for decentralized applications, enabling the storage and retrieval of essential information. Existing solutions, like the ENS registry, serve specific use cases but may lack the necessary flexibility to accommodate more complex scenarios. The need for a more general mapping data structure with multi-namespace support arises to empower developers with a single registry capable of handling diverse use cases efficiently.</p>

<p>The proposed multi-namespace registry offers several key advantages:</p>

<ul>
  <li><strong>Versatility</strong>: Developers can define and manage multiple namespaces, each with its distinct set of keys, allowing for more granular control and organization of data. For instance, single same key can derive as different pointers to various values based on difference namespaces, which a namespace can be specified as a session type, if this registry stores sessions, or short URL -&gt; full URL mapping is registry stores such type of data.</li>
  <li><strong>Traceable History</strong>: By leveraging multi-namespace capabilities, the registry can support entry versioning by using multi-namespace distinct as version number, enabling tracking of data change history, reverting data, or data tombstoning. This facilitates data management and governance within a single contract.</li>
  <li><strong>Enhanced Compatibility</strong>: The proposed structure is designed to be compatible with various use cases beyond the scope of traditional ENS-like registries, promoting its adoption in diverse decentralized applications.</li>
</ul>

<h2 id="specification">Specification</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119.</p>

<h3 id="registry-specification"><strong>Registry specification</strong></h3>

<p>The multi namespace registry contract exposes the following functions:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">owner</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">key</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>Returns the owner of the specified <strong>key</strong> under the given <strong>namespace</strong>.</li>
</ul>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">resolver</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">key</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">);</span>
</code></pre></div></div>

<ul>
  <li>Returns the resolver address for the specified <strong>key</strong> under the given <strong>namespace</strong>.</li>
</ul>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">setOwner</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">key</span><span class="p">,</span> <span class="kt">address</span> <span class="n">newOwner</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</code></pre></div></div>

<ul>
  <li>Transfers ownership of the <strong>key</strong> under the specified <strong>namespace</strong> to another owner. This function may only be called by the current owner of the <strong>key</strong> under a specific <strong>namespace</strong>. The same <strong>key</strong> under different <strong>namespaces</strong> may have different owners. A successful call to this function logs the event <strong>Transfer(bytes32 namespace, bytes32 key, address newOwner)</strong>.</li>
</ul>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">createNamespace</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</code></pre></div></div>

<ul>
  <li>Create a new <strong>namespace</strong> such as a new version or a new type of protocol in current registry. A successful call to this function logs the event <strong>NewNamespace(bytes32 namespace)</strong>.</li>
</ul>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">setResolver</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">key</span><span class="p">,</span> <span class="kt">address</span> <span class="n">newResolver</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</code></pre></div></div>

<ul>
  <li>Sets the resolver address for the <strong>key</strong> under the given <strong>namespace</strong>. This function may only be called by the owner of the key under a specific <strong>namespace</strong>. The same key under different namespaces may have different resolvers. A successful call to this function logs the event <strong>NewResolver(bytes32 namespace, bytes32 key, address newResolver)</strong>.</li>
</ul>

<h3 id="resolver-specification"><strong>Resolver specification</strong></h3>

<p>The multi-namespace resolver contract can utilize the same specification as defined in <a href="./eip-137.md">ERC-137</a>.</p>

<h2 id="rationale">Rationale</h2>

<p>By supporting multiple namespaces, the registry caters to various use cases, including but not limited to identity management, session management, record tracking, and decentralized content publishing. This flexibility enables developers to design and implement more complex decentralized applications with ease.</p>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>As this EIP introduces a new feature and does not modify any existing behaviors, there are no backwards compatibility issues.</p>

<h2 id="reference-implementation">Reference Implementation</h2>

<h3 id="appendix-a-registry-implementation"><em>Appendix A: Registry Implementation</em></h3>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">12</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"./IERC7406Interface.sol"</span><span class="p">;</span>

<span class="k">contract</span> <span class="n">ERC7406</span> <span class="p">{</span>
    <span class="k">struct</span> <span class="n">Record</span> <span class="p">{</span>
        <span class="kt">address</span> <span class="n">owner</span><span class="p">;</span>
        <span class="kt">address</span> <span class="n">resolver</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="c1">// A map is used to record namespace existence
</span>    <span class="k">mapping</span><span class="p">(</span><span class="n">byte32</span><span class="o">=&gt;</span><span class="kt">uint</span><span class="p">)</span> <span class="n">namespaces</span><span class="p">;</span>
    <span class="k">mapping</span><span class="p">(</span><span class="kt">bytes32</span><span class="o">=&gt;</span><span class="k">mapping</span><span class="p">(</span><span class="kt">bytes32</span><span class="o">=&gt;</span><span class="n">Record</span><span class="p">))</span> <span class="n">records</span><span class="p">;</span>

    <span class="k">event</span> <span class="n">NewOwner</span><span class="p">(</span><span class="kt">bytes32</span> <span class="k">indexed</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="k">indexed</span> <span class="n">key</span><span class="p">,</span> <span class="kt">address</span> <span class="n">owner</span><span class="p">);</span>
    <span class="k">event</span> <span class="n">Transfer</span><span class="p">(</span><span class="kt">bytes32</span> <span class="k">indexed</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="k">indexed</span> <span class="n">key</span><span class="p">,</span> <span class="kt">address</span> <span class="n">owner</span><span class="p">);</span>
    <span class="k">event</span> <span class="n">NewResolver</span><span class="p">(</span><span class="kt">bytes32</span> <span class="k">indexed</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="k">indexed</span> <span class="n">key</span><span class="p">,</span> <span class="kt">address</span> <span class="n">resolver</span><span class="p">);</span>
    <span class="k">event</span> <span class="n">NewNamespace</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">)</span>

    <span class="k">modifier</span> <span class="n">only_owner</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">records</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">key</span><span class="p">].</span><span class="n">owner</span> <span class="o">!=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="n">_</span>
    <span class="p">}</span>

    <span class="k">modifier</span> <span class="n">only_approver</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">owner</span> <span class="o">!=</span> <span class="n">msg</span><span class="p">.</span><span class="n">sender</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="n">_</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">ERC7406</span><span class="p">(</span><span class="kt">address</span> <span class="n">approver</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">records</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">].</span><span class="n">owner</span> <span class="o">=</span> <span class="n">approver</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">owner</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">key</span><span class="p">)</span> <span class="k">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">records</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">key</span><span class="p">].</span><span class="n">owner</span><span class="p">;</span>
    <span class="p">}</span>
  
    <span class="k">function</span> <span class="n">createNamespace</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">)</span> <span class="n">only_approver</span><span class="p">()</span> <span class="p">{</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
       <span class="n">NewNamespace</span><span class="p">(</span><span class="n">namespace</span><span class="p">);</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">namespaces</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
           <span class="k">return</span><span class="p">;</span>
       <span class="p">}</span>
       <span class="n">namespaces</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">resolver</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">key</span><span class="p">)</span> <span class="k">constant</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">address</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">namespaces</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="k">throw</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">records</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">key</span><span class="p">].</span><span class="n">resolver</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">setOwner</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">key</span><span class="p">,</span> <span class="kt">address</span> <span class="n">owner</span><span class="p">)</span> <span class="n">only_owner</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Transfer</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">owner</span><span class="p">);</span>
        <span class="n">records</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">key</span><span class="p">].</span><span class="n">owner</span> <span class="o">=</span> <span class="n">owner</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">function</span> <span class="n">setResolver</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">namespace</span><span class="p">,</span> <span class="kt">bytes32</span> <span class="n">key</span><span class="p">,</span> <span class="kt">address</span> <span class="n">resolver</span><span class="p">)</span> <span class="n">only_approver</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">namespaces</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">this</span><span class="p">.</span><span class="n">createNamespace</span><span class="p">(</span><span class="n">namespace</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">NewResolver</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">namespace</span><span class="p">,</span> <span class="n">resolver</span><span class="p">);</span>
        <span class="n">records</span><span class="p">[</span><span class="n">namespace</span><span class="p">][</span><span class="n">key</span><span class="p">].</span><span class="n">resolver</span> <span class="o">=</span> <span class="n">resolver</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<h2 id="security-considerations">Security Considerations</h2>

<p>The proposed multi-namespace registry introduces several security considerations due to its ability to manage various namespaces and access controls. Thorough testing, auditing, and peer reviews will be conducted to identify and mitigate potential attack vectors and vulnerabilities. Security-conscious developers are encouraged to contribute to the audit process.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
