<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Public Non-Fungible Tokens Emote Repository | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Public Non-Fungible Tokens Emote Repository | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-7409" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-7409" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Public Non-Fungible Tokens Emote Repository</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>❗️ <strong><a href="./eip-7409.md">ERC-7409</a> supersedes <a href="./eip-6381.md">ERC-6381</a>.</strong> ❗️</p>

<p>The Public Non-Fungible Tokens Emote Repository standard provides an enhanced interactive utility for <a href="./eip-721.md">ERC-721</a> and <a href="./eip-1155.md">ERC-1155</a> by allowing NFTs to be emoted at.</p>

<p>This proposal introduces the ability to react to NFTs using Unicode standardized emoji in a public non-gated repository smart contract that is accessible at the same address in all of the networks.</p>

<h2 id="motivation">Motivation</h2>

<p>With NFTs being a widespread form of tokens in the Ethereum ecosystem and being used for a variety of use cases, it is time to standardize additional utility for them. Having the ability for anyone to interact with an NFT introduces an interactive aspect to owning an NFT and unlocks feedback-based NFT mechanics.</p>

<p>This ERC introduces new utilities for <a href="./eip-721.md">ERC-721</a> based tokens in the following areas:</p>

<ul>
  <li><a href="#interactivity">Interactivity</a></li>
  <li><a href="#feedback-based-evolution">Feedback based evolution</a></li>
  <li><a href="#valuation">Valuation</a></li>
</ul>

<p>This proposal fixes the compatibility issue in the <a href="./eip-6381.md">ERC-6381</a> interface specification, where emojis are represented using <code class="language-plaintext highlighter-rouge">bytes4</code> values. The introduction of variation flags and emoji skin tones has rendered the <code class="language-plaintext highlighter-rouge">bytes4</code> namespace insufficient for representing all possible emojis, so the new standard used <code class="language-plaintext highlighter-rouge">string</code> instead. Apart from this fix, this proposal is functionally equivalent to <a href="./eip-6381.md">ERC-6381</a>.</p>

<h3 id="interactivity">Interactivity</h3>

<p>The ability to emote on an NFT introduces the aspect of interactivity to owning an NFT. This can either reflect the admiration for the emoter (person emoting to an NFT) or can be a result of a certain action performed by the token’s owner. Accumulating emotes on a token can increase its uniqueness and/or value.</p>

<h3 id="feedback-based-evolution">Feedback based evolution</h3>

<p>Standardized on-chain reactions to NFTs allow for feedback based evolution.</p>

<p>Current solutions are either proprietary or off-chain and therefore subject to manipulation and distrust. Having the ability to track the interaction on-chain allows for trust and objective evaluation of a given token. Designing the tokens to evolve when certain emote thresholds are met incentivizes interaction with the token collection.</p>

<h3 id="valuation">Valuation</h3>

<p>Current NFT market heavily relies on previous values the token has been sold for, the lowest price of the listed token and the scarcity data provided by the marketplace. There is no real time indication of admiration or desirability of a specific token. Having the ability for users to emote to the tokens adds the possibility of potential buyers and sellers gauging the value of the token based on the impressions the token has collected.</p>

<h2 id="specification">Specification</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119.</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">/// @title ERC-7409 Emotable Extension for Non-Fungible Tokens
/// @dev See https://eips.ethereum.org/EIPS/eip-7409
/// @dev Note: the ERC-165 identifier for this interface is 0x1b3327ab.
</span>
<span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">16</span><span class="p">;</span>

<span class="k">interface</span> <span class="n">IERC7409</span> <span class="cm">/*is IERC165*/</span> <span class="p">{</span>
    <span class="cm">/**
     * @notice Used to notify listeners that the token with the specified ID has been emoted to or that the reaction has been revoked.
     * @dev The event MUST only be emitted if the state of the emote is changed.
     * @param emoter Address of the account that emoted or revoked the reaction to the token
     * @param collection Address of the collection smart contract containing the token being emoted to or having the reaction revoked
     * @param tokenId ID of the token
     * @param emoji Unicode identifier of the emoji
     * @param on Boolean value signifying whether the token was emoted to (`true`) or if the reaction has been revoked (`false`)
     */</span>
    <span class="k">event</span> <span class="n">Emoted</span><span class="p">(</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">emoter</span><span class="p">,</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">collection</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="k">indexed</span> <span class="n">tokenId</span><span class="p">,</span>
        <span class="kt">string</span> <span class="n">emoji</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">on</span>
    <span class="p">);</span>

    <span class="cm">/**
     * @notice Used to get the number of emotes for a specific emoji on a token.
     * @param collection Address of the collection containing the token being checked for emoji count
     * @param tokenId ID of the token to check for emoji count
     * @param emoji Unicode identifier of the emoji
     * @return Number of emotes with the emoji on the token
     */</span>
    <span class="k">function</span> <span class="n">emoteCountOf</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">collection</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span>
        <span class="kt">string</span> <span class="k">memory</span> <span class="n">emoji</span>
    <span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Used to get the number of emotes for a specific emoji on a set of tokens.
     * @param collections An array of addresses of the collections containing the tokens being checked for emoji count
     * @param tokenIds An array of IDs of the tokens to check for emoji count
     * @param emojis An array of unicode identifiers of the emojis
     * @return An array of numbers of emotes with the emoji on the tokens
     */</span>
    <span class="k">function</span> <span class="n">bulkEmoteCountOf</span><span class="p">(</span>
        <span class="kt">address</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">collections</span><span class="p">,</span>
        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">tokenIds</span><span class="p">,</span>
        <span class="kt">string</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">emojis</span>
    <span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Used to get the information on whether the specified address has used a specific emoji on a specific
     *  token.
     * @param emoter Address of the account we are checking for a reaction to a token
     * @param collection Address of the collection smart contract containing the token being checked for emoji reaction
     * @param tokenId ID of the token being checked for emoji reaction
     * @param emoji The ASCII emoji code being checked for reaction
     * @return A boolean value indicating whether the `emoter` has used the `emoji` on the token (`true`) or not
     *  (`false`)
     */</span>
    <span class="k">function</span> <span class="n">hasEmoterUsedEmote</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">emoter</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">collection</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span>
        <span class="kt">string</span> <span class="k">memory</span> <span class="n">emoji</span>
    <span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Used to get the information on whether the specified addresses have used specific emojis on specific
     *  tokens.
     * @param emoters An array of addresses of the accounts we are checking for reactions to tokens
     * @param collections An array of addresses of the collection smart contracts containing the tokens being checked
     *  for emoji reactions
     * @param tokenIds An array of IDs of the tokens being checked for emoji reactions
     * @param emojis An array of the ASCII emoji codes being checked for reactions
     * @return An array of boolean values indicating whether the `emoter`s has used the `emoji`s on the tokens (`true`)
     *  or not (`false`)
     */</span>
    <span class="k">function</span> <span class="n">haveEmotersUsedEmotes</span><span class="p">(</span>
        <span class="kt">address</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">emoters</span><span class="p">,</span>
        <span class="kt">address</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">collections</span><span class="p">,</span>
        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">tokenIds</span><span class="p">,</span>
        <span class="kt">string</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">emojis</span>
    <span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">[]</span> <span class="k">memory</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Used to get the message to be signed by the `emoter` in order for the reaction to be submitted by someone
     *  else.
     * @param collection The address of the collection smart contract containing the token being emoted at
     * @param tokenId ID of the token being emoted
     * @param emoji Unicode identifier of the emoji
     * @param state Boolean value signifying whether to emote (`true`) or undo (`false`) emote
     * @param deadline UNIX timestamp of the deadline for the signature to be submitted
     * @return The message to be signed by the `emoter` in order for the reaction to be submitted by someone else
     */</span>
    <span class="k">function</span> <span class="n">prepareMessageToPresignEmote</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">collection</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span>
        <span class="kt">string</span> <span class="k">memory</span> <span class="n">emoji</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">state</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">deadline</span>
    <span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Used to get multiple messages to be signed by the `emoter` in order for the reaction to be submitted by someone
     *  else.
     * @param collections An array of addresses of the collection smart contracts containing the tokens being emoted at
     * @param tokenIds An array of IDs of the tokens being emoted
     * @param emojis An array of unicode identifiers of the emojis
     * @param states An array of boolean values signifying whether to emote (`true`) or undo (`false`) emote
     * @param deadlines An array of UNIX timestamps of the deadlines for the signatures to be submitted
     * @return The array of messages to be signed by the `emoter` in order for the reaction to be submitted by someone else
     */</span>
    <span class="k">function</span> <span class="n">bulkPrepareMessagesToPresignEmote</span><span class="p">(</span>
        <span class="kt">address</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">collections</span><span class="p">,</span>
        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">tokenIds</span><span class="p">,</span>
        <span class="kt">string</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">emojis</span><span class="p">,</span>
        <span class="kt">bool</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">states</span><span class="p">,</span>
        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">deadlines</span>
    <span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">bytes32</span><span class="p">[]</span> <span class="k">memory</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Used to emote or undo an emote on a token.
     * @dev Does nothing if attempting to set a pre-existent state.
     * @dev MUST emit the `Emoted` event is the state of the emote is changed.
     * @param collection Address of the collection containing the token being emoted at
     * @param tokenId ID of the token being emoted
     * @param emoji Unicode identifier of the emoji
     * @param state Boolean value signifying whether to emote (`true`) or undo (`false`) emote
     */</span>
    <span class="k">function</span> <span class="n">emote</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">collection</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span>
        <span class="kt">string</span> <span class="k">memory</span> <span class="n">emoji</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">state</span>
    <span class="p">)</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * @notice Used to emote or undo an emote on multiple tokens.
     * @dev Does nothing if attempting to set a pre-existent state.
     * @dev MUST emit the `Emoted` event is the state of the emote is changed.
     * @dev MUST revert if the lengths of the `collections`, `tokenIds`, `emojis` and `states` arrays are not equal.
     * @param collections An array of addresses of the collections containing the tokens being emoted at
     * @param tokenIds An array of IDs of the tokens being emoted
     * @param emojis An array of unicode identifiers of the emojis
     * @param states An array of boolean values signifying whether to emote (`true`) or undo (`false`) emote
     */</span>
    <span class="k">function</span> <span class="n">bulkEmote</span><span class="p">(</span>
        <span class="kt">address</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">collections</span><span class="p">,</span>
        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">tokenIds</span><span class="p">,</span>
        <span class="kt">string</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">emojis</span><span class="p">,</span>
        <span class="kt">bool</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">states</span>
    <span class="p">)</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * @notice Used to emote or undo an emote on someone else's behalf.
     * @dev Does nothing if attempting to set a pre-existent state.
     * @dev MUST emit the `Emoted` event is the state of the emote is changed.
     * @dev MUST revert if the lengths of the `collections`, `tokenIds`, `emojis` and `states` arrays are not equal.
     * @dev MUST revert if the `deadline` has passed.
     * @dev MUST revert if the recovered address is the zero address.
     * @param emoter The address that presigned the emote
     * @param collection The address of the collection smart contract containing the token being emoted at
     * @param tokenId IDs of the token being emoted
     * @param emoji Unicode identifier of the emoji
     * @param state Boolean value signifying whether to emote (`true`) or undo (`false`) emote
     * @param deadline UNIX timestamp of the deadline for the signature to be submitted
     * @param v `v` value of an ECDSA signature of the message obtained via `prepareMessageToPresignEmote`
     * @param r `r` value of an ECDSA signature of the message obtained via `prepareMessageToPresignEmote`
     * @param s `s` value of an ECDSA signature of the message obtained via `prepareMessageToPresignEmote`
     */</span>
    <span class="k">function</span> <span class="n">presignedEmote</span><span class="p">(</span>
        <span class="kt">address</span> <span class="n">emoter</span><span class="p">,</span>
        <span class="kt">address</span> <span class="n">collection</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">tokenId</span><span class="p">,</span>
        <span class="kt">string</span> <span class="k">memory</span> <span class="n">emoji</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">state</span><span class="p">,</span>
        <span class="kt">uint256</span> <span class="n">deadline</span><span class="p">,</span>
        <span class="kt">uint8</span> <span class="n">v</span><span class="p">,</span>
        <span class="kt">bytes32</span> <span class="n">r</span><span class="p">,</span>
        <span class="kt">bytes32</span> <span class="n">s</span>
    <span class="p">)</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * @notice Used to bulk emote or undo an emote on someone else's behalf.
     * @dev Does nothing if attempting to set a pre-existent state.
     * @dev MUST emit the `Emoted` event is the state of the emote is changed.
     * @dev MUST revert if the lengths of the `collections`, `tokenIds`, `emojis` and `states` arrays are not equal.
     * @dev MUST revert if the `deadline` has passed.
     * @dev MUST revert if the recovered address is the zero address.
     * @param emoters An array of addresses of the accounts that presigned the emotes
     * @param collections An array of addresses of the collections containing the tokens being emoted at
     * @param tokenIds An array of IDs of the tokens being emoted
     * @param emojis An array of unicode identifiers of the emojis
     * @param states An array of boolean values signifying whether to emote (`true`) or undo (`false`) emote
     * @param deadlines UNIX timestamp of the deadline for the signature to be submitted
     * @param v An array of `v` values of an ECDSA signatures of the messages obtained via `prepareMessageToPresignEmote`
     * @param r An array of `r` values of an ECDSA signatures of the messages obtained via `prepareMessageToPresignEmote`
     * @param s An array of `s` values of an ECDSA signatures of the messages obtained via `prepareMessageToPresignEmote`
     */</span>
    <span class="k">function</span> <span class="n">bulkPresignedEmote</span><span class="p">(</span>
        <span class="kt">address</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">emoters</span><span class="p">,</span>
        <span class="kt">address</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">collections</span><span class="p">,</span>
        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">tokenIds</span><span class="p">,</span>
        <span class="kt">string</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">emojis</span><span class="p">,</span>
        <span class="kt">bool</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">states</span><span class="p">,</span>
        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">deadlines</span><span class="p">,</span>
        <span class="kt">uint8</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">v</span><span class="p">,</span>
        <span class="kt">bytes32</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">r</span><span class="p">,</span>
        <span class="kt">bytes32</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">s</span>
    <span class="p">)</span> <span class="k">external</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="message-format-for-presigned-emotes">Message format for presigned emotes</h3>

<p>The message to be signed by the <code class="language-plaintext highlighter-rouge">emoter</code> in order for the reaction to be submitted by someone else is formatted as follows:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">keccak256</span><span class="p">(</span>
        <span class="n">abi</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="n">DOMAIN_SEPARATOR</span><span class="p">,</span>
            <span class="n">collection</span><span class="p">,</span>
            <span class="n">tokenId</span><span class="p">,</span>
            <span class="n">emoji</span><span class="p">,</span>
            <span class="n">state</span><span class="p">,</span>
            <span class="n">deadline</span>
        <span class="p">)</span>
    <span class="p">);</span>
</code></pre></div></div>

<p>The values passed when generating the message to be signed are:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">DOMAIN_SEPARATOR</code> - The domain separator of the Emotable repository smart contract</li>
  <li><code class="language-plaintext highlighter-rouge">collection</code> - Address of the collection containing the token being emoted at</li>
  <li><code class="language-plaintext highlighter-rouge">tokenId</code> - ID of the token being emoted</li>
  <li><code class="language-plaintext highlighter-rouge">emoji</code> - Unicode identifier of the emoji</li>
  <li><code class="language-plaintext highlighter-rouge">state</code> - Boolean value signifying whether to emote (<code class="language-plaintext highlighter-rouge">true</code>) or undo (<code class="language-plaintext highlighter-rouge">false</code>) emote</li>
  <li><code class="language-plaintext highlighter-rouge">deadline</code> - UNIX timestamp of the deadline for the signature to be submitted</li>
</ul>

<p>The <code class="language-plaintext highlighter-rouge">DOMAIN_SEPARATOR</code> is generated as follows:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">keccak256</span><span class="p">(</span>
        <span class="n">abi</span><span class="p">.</span><span class="n">encode</span><span class="p">(</span>
            <span class="s">"ERC-7409: Public Non-Fungible Token Emote Repository"</span><span class="p">,</span>
            <span class="s">"1"</span><span class="p">,</span>
            <span class="n">block</span><span class="p">.</span><span class="n">chainid</span><span class="p">,</span>
            <span class="kt">address</span><span class="p">(</span><span class="nb">this</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">);</span>
</code></pre></div></div>

<p>Each chain, that the Emotable repository smart contract is deployed on, will have a different <code class="language-plaintext highlighter-rouge">DOMAIN_SEPARATOR</code> value due to chain IDs being different.</p>

<h3 id="pre-determined-address-of-the-emotable-repository">Pre-determined address of the Emotable repository</h3>

<p>The address of the Emotable repository smart contract is designed to resemble the function it serves. It starts with <code class="language-plaintext highlighter-rouge">0x3110735</code> which is the abstract representation of <code class="language-plaintext highlighter-rouge">EMOTES</code>. The address is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>0x3110735F0b8e71455bAe1356a33e428843bCb9A1
</code></pre></div></div>

<h2 id="rationale">Rationale</h2>

<p>Designing the proposal, we considered the following questions:</p>

<ol>
  <li><strong>Does the proposal support custom emotes or only the Unicode specified ones?</strong><br />
The proposal only accepts the Unicode identifier which is a <code class="language-plaintext highlighter-rouge">string</code> value. This means that while we encourage implementers to add the reactions using standardized emojis, the values not covered by the Unicode standard can be used for custom emotes. The only drawback being that the interface displaying the reactions will have to know what kind of image to render and such additions will probably be limited to the interface or marketplace in which they were made.</li>
  <li><strong>Should the proposal use emojis to relay the impressions of NFTs or some other method?</strong><br />
The impressions could have been done using user-supplied strings or numeric values, yet we decided to use emojis since they are a well established mean of relaying impressions and emotions.</li>
  <li><strong>Should the proposal establish an emotable extension or a common-good repository?</strong><br />
Initially we set out to create an emotable extension to be used with any ERC-721 compliant tokens. However, we realized that the proposal would be more useful if it was a common-good repository of emotable tokens. This way, the tokens that can be reacted to are not only the new ones but also the old ones that have been around since before the proposal.<br />
In line with this decision, we decided to calculate a deterministic address for the repository smart contract. This way, the repository can be used by any NFT collection without the need to search for the address on the given chain.</li>
  <li><strong>Should we include only single-action operations, only multi-action operations, or both?</strong><br />
We’ve considered including only single-action operations, where the user is only able to react with a single emoji to a single token, but we decided to include both single-action and multi-action operations. This way, the users can choose whether they want to emote or undo emote on a single token or on multiple tokens at once.<br />
This decision was made for the long-term viability of the proposal. Based on the gas cost of the network and the number of tokens in the collection, the user can choose the most cost-effective way of emoting.</li>
  <li><strong>Should we add the ability to emote on someone else’s behalf?</strong><br />
While we did not intend to add this as part of the proposal when drafting it, we realized that it would be a useful feature for it. This way, the users can emote on behalf of someone else, for example, if they are not able to do it themselves or if the emote is earned through an off-chain activity.</li>
  <li><strong>How do we ensure that emoting on someone else’s behalf is legitimate?</strong><br />
We could add delegates to the proposal; when a user delegates their right to emote to someone else, the delegate can emote on their behalf. However, this would add a lot of complexity and additional logic to the proposal.<br />
Using ECDSA signatures, we can ensure that the user has given their consent to emote on their behalf. This way, the user can sign a message with the parameters of the emote and the signature can be submitted by someone else.</li>
  <li><strong>Should we add chain ID as a parameter when reacting to a token?</strong><br />
During the course of discussion of the proposal, a suggestion arose that we could add chain ID as a parameter when reacting to a token. This would allow the users to emote on the token of one chain on another chain.<br />
We decided against this as we feel that additional parameter would rarely be used and would add additional cost to the reaction transactions. If the collection smart contract wants to utilize on-chain emotes to tokens they contain, they require the reactions to be recorded on the same chain. Marketplaces and wallets integrating this proposal will rely on reactions to reside in the same chain as well, because if chain ID parameter was supported this would mean that they would need to query the repository smart contract on all of the chains the repository is deployed in order to get the reactions for a given token.<br />
Additionally, if the collection creator wants users to record their reactions on a different chain, they can still direct the users to do just that. The repository does not validate the existence of the token being reacted to, which in theory means that you can react to non-existent token or to a token that does not exist yet. The likelihood of a different collection existing at the same address on another chain is significantly low, so the users can react using the collection’s address on another chain and it is very unlikely that they will unintentionally react to another collection’s token.</li>
  <li><strong>Should we use <code class="language-plaintext highlighter-rouge">bytes4</code> or <code class="language-plaintext highlighter-rouge">strings</code> to represent emotes?</strong><br />
Initially the proposal used <code class="language-plaintext highlighter-rouge">bytes4</code>. This was due to the assumption that all of the emojis use UTF-4 encoding, which is not the case.<br />
The emojis usually use up to 8 bytes, but the personalized emojis with skin tones use much more. This is why we decided to use <code class="language-plaintext highlighter-rouge">strings</code> to represent the emotes. This allows the repository to be forward compatible with any future emojis that might be added to the Unicode standard.<br />
This is how this proposal fixes the forward compatibility issue of the <a href="./eip-6381.md">ERC-6381</a>.</li>
</ol>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>The Emote repository standard is fully compatible with <a href="./eip-721.md">ERC-721</a> and with the robust tooling available for implementations of ERC-721 as well as with the existing ERC-721 infrastructure.</p>

<h2 id="test-cases">Test Cases</h2>

<p>Tests are included in <a href="../assets/eip-7409/test/emotableRepository.ts"><code class="language-plaintext highlighter-rouge">emotableRepository.ts</code></a>.</p>

<p>To run them in terminal, you can use the following commands:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ../assets/eip-7409
npm install
npx hardhat test
</code></pre></div></div>

<h2 id="reference-implementation">Reference Implementation</h2>

<p>See <a href="../assets/eip-7409/contracts/EmotableRepository.sol"><code class="language-plaintext highlighter-rouge">EmotableRepository.sol</code></a>.</p>

<h2 id="security-considerations">Security Considerations</h2>

<p>The proposal does not envision handling any form of assets from the user, so the assets should not be at risk when interacting with an Emote repository.</p>

<p>The ability to use ECDSA signatures to emote on someone else’s behalf introduces the risk of a replay attack, which the format of the message to be signed guards against. The <code class="language-plaintext highlighter-rouge">DOMAIN_SEPARATOR</code> used in the message to be signed is unique to the repository smart contract of the chain it is deployed on. This means that the signature is invalid on any other chain and the Emote repositories deployed on them should revert the operation if a replay attack is attempted.</p>

<p>Another thing to consider is the ability of presigned message reuse. Since the message includes the signature validity deadline, the message can be reused any number of times before the deadline is reached. The proposal only allows for a single reaction with a given emoji to a specific token to be active, so the presigned message can not be abused to increase the reaction count on the token. However, if the service using the repository relies on the ability to revoke the reaction after certain actions, a valid presigned message can be used to re-react to the token. We suggest that the services using the repository in conjunction with presigned messages use deadlines that invalidate presigned messages after a reasonably short period of time.</p>

<p>Caution is advised when dealing with non-audited contracts.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
