<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Contract wallet management NFT | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Contract wallet management NFT | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-7564" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-7564" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Contract wallet management NFT</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>This proposal introduces a smart contract wallet-based approach for managing NFTs, focusing on utilizing the programmable features of smart contract wallets for NFT asset management. Additionally, it introduces functions such as <code class="language-plaintext highlighter-rouge">nftApprove</code>, <code class="language-plaintext highlighter-rouge">nftSetApprovalForOneAll</code>, <code class="language-plaintext highlighter-rouge">nftSetApprovalForAllAll</code>, <code class="language-plaintext highlighter-rouge">nftGetApproved</code>, <code class="language-plaintext highlighter-rouge">nftIsApprovedForOneAll</code>, <code class="language-plaintext highlighter-rouge">nftIsApprovedForAllAll</code> and <code class="language-plaintext highlighter-rouge">nftTransfer</code>, which provide enhanced control over NFT transactions. This approach seeks to enhance NFT management by utilizing the built-in features of smart contract wallets, thus offering a more adaptable, secure, and efficient method for managing token transactions.</p>

<h2 id="motivation">Motivation</h2>

<p>An externally-owned account (EOA) wallet has no state and code storage, while the smart contract wallet does.</p>

<p>Account abstraction (AA) is a direction of the smart contract wallet, which works around abstract accounts. This ERC can also be an extension based on <a href="./eip-4337">ERC-4337</a> or as a plug-in for wallets.</p>

<p>The smart contract wallet allows the user’s own account to have state and code, bringing programmability to the wallet. We think there are more directions to expand. For example, nft asset management, functional expansion of nft transactions, etc.</p>

<p>The smart contract wallet interface of this ERC is for nft asset management and nft asset approval. It supports the simplenft <!-- TODO --> ERC-X, and <a href="./eip-721">ERC-721</a> is backward compatible with <!-- TODO --> ERC-X, so it can be compatible with the management of all nfts in the existing market.</p>

<p>The proposal aims to achieve the following goals:</p>

<ol>
  <li>NFT assets are allocated and managed by the wallet itself, such as approve function, which are configured by the user’s contract wallet, rather than controlled by the nft asset contract, to avoid some existing ERC-721 contract risks.</li>
  <li>Add the <code class="language-plaintext highlighter-rouge">nftTransfer</code> function, the transaction initiated by the non-smart wallet itself.</li>
  <li>Add <code class="language-plaintext highlighter-rouge">nftApprove</code>, <code class="language-plaintext highlighter-rouge">nftSetApprovalForOneAll</code>, <code class="language-plaintext highlighter-rouge">nftSetApprovalForAllAll</code>, <code class="language-plaintext highlighter-rouge">nftGetApproved</code>, <code class="language-plaintext highlighter-rouge">nftIsApprovedForOneAll</code>, <code class="language-plaintext highlighter-rouge">nftIsApprovedForAllAll</code> functions. The user wallet itself supports approve and provides approve. for One nft, all nft of one nft smart contract, all nft assets.</li>
  <li>User wallet can choose batch approve and batch transfer.</li>
  <li>Users can choose to add hook function before and after their <code class="language-plaintext highlighter-rouge">nftTransfer</code> to increase the user’s more playability.</li>
  <li>The user can choose to implement the <code class="language-plaintext highlighter-rouge">nftReceive</code> function.</li>
</ol>

<h2 id="specification">Specification</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>

<p><strong>Compliant contract must implement the <a href="./eip-165">ERC-165</a> interfaces</strong></p>
<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">/// @title ERC-7564
/// @dev See https://eips.ethereum.org/EIPS/eip-7564
/// @dev Note: the ERC-165 identifier for this interface is 
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">^</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">20</span><span class="p">;</span>

<span class="k">interface</span> <span class="n">IERC7564</span><span class="p">{</span>

    <span class="cm">/**
     * @notice Used to notify listeners that owner has granted approval to the user to manage one nft.
     * @param _asset Address of the nft
     * @param _owner Address of the account that has granted the approval for nft‘s assets
     * @param _operator Address of the operator
     * @param _tokenId The unique identifier of the NFT
     */</span>
    <span class="k">event</span> <span class="n">NftApproval</span><span class="p">(</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_asset</span><span class="p">,</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_owner</span><span class="p">,</span> 
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_operator</span><span class="p">,</span> 
        <span class="kt">uint256</span> <span class="n">_tokenId</span>
    <span class="p">);</span>

    <span class="cm">/**
     * @notice Used to notify listeners that owner has granted approval to the operator to manage all nft of one asset contract.
     * @param _asset Address of the nft
     * @param _owner Address of the account that has granted the approval for nft‘s assets
     * @param _operator Address of the operator
     * @param _approved approve all nft of one asset contract
     */</span>
    <span class="k">event</span> <span class="n">NftApprovalForOneAll</span><span class="p">(</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_asset</span><span class="p">,</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_owner</span><span class="p">,</span> 
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_operator</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">_approved</span>
    <span class="p">);</span>

    <span class="cm">/**
     * @notice Used to notify listeners that owner has granted approval to the operator to manage all nft .
     * @param _owner Address of the account that has granted the approval for nft‘s assets
     * @param _operator Address of the operator
     * @param _approved approve all nft
     */</span>
    <span class="k">event</span> <span class="n">NftApprovalForAllAll</span><span class="p">(</span>
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_owner</span><span class="p">,</span> 
        <span class="kt">address</span> <span class="k">indexed</span> <span class="n">_operator</span><span class="p">,</span>
        <span class="kt">bool</span> <span class="n">_approved</span>
    <span class="p">);</span>

    <span class="cm">/**
     * @notice Approve nft
     * @dev Allows operator address to withdraw from your wallet one nft.
     * @dev Emits an {nftApproval} event.
     * @param _asset Address of the nft
     * @param _operator Address of the operator
     * @param _tokenId The unique identifier of the NFT
     */</span>
    <span class="k">function</span> <span class="n">nftApprove</span><span class="p">(</span><span class="kt">address</span> <span class="n">_asset</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_operator</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>

   

    <span class="cm">/**
     * @notice Approve all nft of one asset
     * @dev Allows operator address to withdraw from your wallet all nft.
     * @dev Emits an {nftApprovalForOneAll} event.
    * @param _asset Address of the nft
     * @param _operator Address of the operator
     * @param _approved Approved all nfts of one asset
     */</span>
    <span class="k">function</span> <span class="n">nftSetApprovalForOneAll</span><span class="p">(</span><span class="kt">address</span> <span class="n">_asset</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_operator</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">_approved</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>


     <span class="cm">/**
     * @notice Approve all nft
     * @dev Allows operator address to withdraw from your wallet all nft.
     * @dev Emits an {nftApprovalForAllAll} event.
     * @param _operator Address of the operator
     * @param _approved Approved all nfts
     */</span>
    <span class="k">function</span> <span class="n">nftSetApprovalForAllAll</span><span class="p">(</span><span class="kt">address</span> <span class="n">_operator</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">_approved</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>

    <span class="cm">/**
     * @notice read operator approved
     * @param _asset Address of the nft
     * @param _operator Address of the operator
     * @param _tokenId The unique identifier of the NFT
     * @return _approved Whether to approved operator one nft
     */</span>
    <span class="k">function</span> <span class="n">nftGetApproved</span><span class="p">(</span><span class="kt">address</span> <span class="n">_asset</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_operator</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> 
        <span class="k">external</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_approved</span><span class="p">);</span>

    <span class="cm">/**
     * @notice read operator approved
     * @param _asset Address of the nft
     * @param _operator Address of the operator
     * @return _approved Whether to approved operator all nfts of this one asset
     */</span>
    <span class="k">function</span> <span class="n">nftIsApprovedForOneAll</span><span class="p">(</span><span class="kt">address</span> <span class="n">_asset</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_operator</span><span class="p">)</span> 
        <span class="k">external</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_approved</span><span class="p">);</span>

    <span class="cm">/**
     * @notice read operator approved
     * @param _operator Address of the operator
     * @return _approved Whether to approved operator all nfts
     */</span>
    <span class="k">function</span> <span class="n">nftIsApprovedForAllAll</span><span class="p">(</span><span class="kt">address</span> <span class="n">_operator</span><span class="p">)</span> 
        <span class="k">external</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_approved</span><span class="p">);</span>

    <span class="cm">/**
     * @notice Transfer nft
     * @dev must call nft asset transfer() inside the function
     * @dev If the caller is not wallet self, must verify the approve and update
     * @param _asset Address of the nft
     * @param _to Address of the receive
     * @param _tokenId The transaction amount
     * @return _success The bool value returns whether the transfer is successful
     */</span>
    <span class="k">function</span> <span class="n">nftTransfer</span><span class="p">(</span><span class="kt">address</span> <span class="n">_asset</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_to</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_tokenId</span><span class="p">)</span> 
        <span class="k">external</span> 
        <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span> <span class="n">_success</span><span class="p">);</span> 


<span class="p">}</span>
</code></pre></div></div>

<h2 id="rationale">Rationale</h2>

<p>the key technical decisions in this proposal are:</p>

<p><strong>Improved Approve Mechanism</strong></p>
<ul>
  <li><strong>Current vs. Proposed</strong>: In the existing ERC-721 system, an externally-owned account (EOA) directly interacts with nft contracts to <code class="language-plaintext highlighter-rouge">approve</code>. The new <code class="language-plaintext highlighter-rouge">nftApprove</code>, <code class="language-plaintext highlighter-rouge">nftSetApprovalForOneAll</code>, <code class="language-plaintext highlighter-rouge">nftSetApprovalForAllAll</code>, <code class="language-plaintext highlighter-rouge">nftGetApproved</code>, <code class="language-plaintext highlighter-rouge">nftIsApprovedForOneAll</code>, <code class="language-plaintext highlighter-rouge">nftIsApprovedForAllAll</code>functions in this proposed enable more precise control over nft usage within a wallet contract, a significant improvement over the traditional method.</li>
  <li><strong>Enhanced Security</strong>: This mechanism mitigates risks like nft over-approval by shifting approval control to the user’s smart contract wallet.</li>
  <li><strong>Programmability</strong>: Users gain the ability to set advanced approval strategies, such as conditional or time-limited approvals, the <code class="language-plaintext highlighter-rouge">nftSetApprovalForAllAll</code> function specifically allows for a universal setting  all nfts. these were not possible with traditional ERC-721 nfts.</li>
</ul>

<p><strong>Optimized Transfer Process</strong></p>
<ul>
  <li><strong>Efficiency and Security</strong>: The <code class="language-plaintext highlighter-rouge">nftTransfer</code> function streamlines the nft transfer process, making transactions both more efficient and secure.</li>
  <li><strong>Flexibility</strong>: Allows the integration of custom logic (hooks) before and after transfers, enabling additional security checks or specific actions tailored to the user’s needs.</li>
</ul>

<p><strong>Support for Batch Operations</strong></p>
<ul>
  <li><strong>Increased Efficiency</strong>: Users can simultaneously handle multiple <code class="language-plaintext highlighter-rouge">approve</code> or <code class="language-plaintext highlighter-rouge">transfer</code> operations, significantly boosting transaction efficiency.</li>
  <li><strong>Enhanced User Experience</strong>: Simplifies the management of numerous assets, improving the overall experience for users with large portfolios.</li>
</ul>

<h2 id="backwards-compatibility">Backwards Compatibility</h2>

<p>This ERC can be used as an extension of <a href="./eip-4337.md">ERC-4337</a> and is backward compatible with ERC-4337.</p>

<h2 id="security-considerations">Security Considerations</h2>

<p>No security considerations were found.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
