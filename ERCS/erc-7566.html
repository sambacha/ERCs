<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Multiplayer Game Communication | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Multiplayer Game Communication | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-7566" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-7566" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Multiplayer Game Communication</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>This proposal introduces a multiplayer game communication (MGC) interface, using <code class="language-plaintext highlighter-rouge">room</code> to match and group players, and using <code class="language-plaintext highlighter-rouge">message</code> to process actions between players. This allows one smart contract to handle multiple players playing games on the chain, preventing centralized servers from affecting the fairness of the game.</p>

<h2 id="motivation">Motivation</h2>

<p>Common multiplayer games are generally played on centralized servers. Players have no way of knowing whether there are forged data and cheating on the server. The owner of the game server can match players at will, modify scores and levels, and even close and pause the game. If the player’s actions all occur on the chain, every message from the chain is proof of the player’s instructions and actions, which further ensures the fairness of the game. The Multiplayer Game Communication framework scales vertically by adding rooms to handle and accommodate multiple players. Write on-chain game logic with custom messages for horizontal expansion, allowing game developers to build multiplayer and fully on-chain games with smart contracts. <br />
Advantages of using this standard include:</p>
<ul>
  <li>All parties can provide comprehensive game data query services based on standard interfaces and verify the fairness of the game.</li>
  <li>It has a basic grouping and messaging architecture, which reduces complexity and allows developers to focus on the development of the core logic of the game.</li>
  <li>It is more composable, and developers can decompose a large game into several contracts that implement the standard.</li>
  <li>Messages have one-to-many and customized capabilities, which is more conducive to developers to expand for different games.</li>
  <li>The room adopts a hierarchical data structure, and each member will be assigned a new ID in each room to facilitate developers to manage the player’s state.</li>
</ul>

<h2 id="specification">Specification</h2>

<p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in RFC 2119 and RFC 8174.</p>

<p>The principle of Multiplayer Game Communication is to use the same game logic to change the state of different groups of players.</p>

<p>It consists of two core parts:</p>

<p><strong>Room</strong>: A container for players, used to match and view connected players. The game can only be played after players join the room.</p>

<p><strong>Message</strong>: Actions between players, using messages to perform game behaviors and change the player’s state in the room.</p>

<p><img src="../assets/eip-7566/MOGFlowChart.png" alt="Multiplayer Game Communication Workflow" /></p>

<h3 id="interfaces">Interfaces</h3>

<h4 id="imogsol"><code class="language-plaintext highlighter-rouge">IMOG.sol</code></h4>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SPDX-License-Identifier: CC0-1.0
</span><span class="k">pragma</span> <span class="n">solidity</span> <span class="o">&gt;=</span><span class="mf">0.8</span><span class="p">.</span><span class="mi">0</span><span class="p">;</span>

<span class="k">import</span> <span class="s">"./Types.sol"</span><span class="p">;</span>

<span class="k">interface</span> <span class="n">IMOG</span> <span class="p">{</span>
    <span class="cm">/**
     * Create a new room.
     * @dev The entity MUST be assigned a unique Id.
     * @return New room id.
     */</span>
    <span class="k">function</span> <span class="n">createRoom</span><span class="p">()</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>

    <span class="cm">/**
     * Get the total number of rooms that have been created.
     * @return Total number of rooms.
     */</span>
    <span class="k">function</span> <span class="n">getRoomCount</span><span class="p">()</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>

    <span class="cm">/**
     * Player joins room.
     * @dev The member MUST be assigned a unique Id.
     * @param _roomId is the id of the room.
     * @return Member id.
     */</span>
    <span class="k">function</span> <span class="n">joinRoom</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_roomId</span><span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>

    <span class="cm">/**
     * Get the id of a member in a room.
     * @param _roomId is the id of the room.
     * @param _member is the address of a member.
     * @return Member id.
     */</span>
    <span class="k">function</span> <span class="n">getMemberId</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_roomId</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_member</span><span class="p">)</span>
        <span class="k">external</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>

    <span class="cm">/**
     * Check if a member exists in the room.
     * @param _roomId is the id of the room.
     * @param _member is the address of a member.
     * @return true exists, false does not exist.
     */</span>
    <span class="k">function</span> <span class="n">hasMember</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_roomId</span><span class="p">,</span> <span class="kt">address</span> <span class="n">_member</span><span class="p">)</span>
        <span class="k">external</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">bool</span><span class="p">);</span>

    <span class="cm">/**
     * Get all room IDs joined by a member.
     * @param _member is the address of a member.
     * @return An array of room ids.
     */</span>
    <span class="k">function</span> <span class="n">getRoomIds</span><span class="p">(</span><span class="kt">address</span> <span class="n">_member</span><span class="p">)</span>
        <span class="k">external</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span><span class="p">);</span>

    <span class="cm">/**
     * Get the total number of members in a room.
     * @param _roomId is the id of the room.
     * @return Total members.
     */</span>
    <span class="k">function</span> <span class="n">getMemberCount</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_roomId</span><span class="p">)</span> <span class="k">external</span> <span class="k">view</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>

    <span class="cm">/**
     * A member sends a message to other members.
     * @dev Define your game logic here and use the content in the message to handle the member's state. The message MUST be assigned a unique Id
     * @param _roomId is the id of the room.
     * @param _to is an array of other member ids.
     * @param _message is the content of the message, encoded by abi.encode.
     * @param _messageTypes is data type array of message content.
     * @return Message id.
     */</span>
    <span class="k">function</span> <span class="n">sendMessage</span><span class="p">(</span>
        <span class="kt">uint256</span> <span class="n">_roomId</span><span class="p">,</span>
        <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">_to</span><span class="p">,</span>
        <span class="kt">bytes</span> <span class="k">memory</span> <span class="n">_message</span><span class="p">,</span>
        <span class="n">Types</span><span class="p">.</span><span class="n">Type</span><span class="p">[]</span> <span class="k">memory</span> <span class="n">_messageTypes</span>
    <span class="p">)</span> <span class="k">external</span> <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">);</span>

    <span class="cm">/**
     * Get all messages received by a member in the room.
     * @param _roomId is the id of the room.
     * @param _memberId is the id of the member.
     * @return An array of message ids.
     */</span>
    <span class="k">function</span> <span class="n">getMessageIds</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_roomId</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_memberId</span><span class="p">)</span>
        <span class="k">external</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span><span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span><span class="p">);</span>

    <span class="cm">/**
     * Get details of a message.
     * @param _roomId is the id of the room.
     * @param _messageId is the id of the message.
     * @return The content of the message.
     * @return Data type array of message content.
     * @return Sender id.
     * @return An array of receiver ids.
     */</span>
    <span class="k">function</span> <span class="n">getMessage</span><span class="p">(</span><span class="kt">uint256</span> <span class="n">_roomId</span><span class="p">,</span> <span class="kt">uint256</span> <span class="n">_messageId</span><span class="p">)</span>
        <span class="k">external</span>
        <span class="k">view</span>
        <span class="k">returns</span> <span class="p">(</span>
            <span class="kt">bytes</span> <span class="k">memory</span><span class="p">,</span>
            <span class="n">Types</span><span class="p">.</span><span class="n">Type</span><span class="p">[]</span> <span class="k">memory</span><span class="p">,</span>
            <span class="kt">uint256</span><span class="p">,</span>
            <span class="kt">uint256</span><span class="p">[]</span> <span class="k">memory</span>
        <span class="p">);</span>
<span class="p">}</span>


</code></pre></div></div>

<h3 id="library">Library</h3>

<p>The library <a href="../assets/eip-7566/Types.sol"><code class="language-plaintext highlighter-rouge">Types.sol</code></a> contains an enumeration of Solidity types used in the above interfaces.</p>

<h2 id="rationale">Rationale</h2>

<h3 id="why-are-multiplayer-onchain-games-room-based">Why are multiplayer onchain games room-based?</h3>

<p>Because the rooms are independent, each player will be assigned a new ID when entering a room. A new game round can be a room, a game task can be a room, and a game activity can be a room.</p>

<h3 id="the-players-state-in-the-game">The player’s state in the game.</h3>

<p>The game state refers to the player’s data changes in the game, and <code class="language-plaintext highlighter-rouge">sendMessage</code> actually plays the role of a state converter. The proposal is very flexible, you can define some data inside the room (internal) or outside the room (global) according to the game logic.</p>

<h3 id="how-to-initialize-player-data">How to initialize player data?</h3>

<p>You can initialize player data in <code class="language-plaintext highlighter-rouge">createRoom</code> or <code class="language-plaintext highlighter-rouge">joinRoom</code>.</p>

<h3 id="how-to-check-and-handle-player-exits-from-the-game">How to check and handle player exits from the game?</h3>

<p>You can use <code class="language-plaintext highlighter-rouge">block.timestamp</code> or <code class="language-plaintext highlighter-rouge">block.number</code> to record the latest <code class="language-plaintext highlighter-rouge">sendMessage</code> time of a member. And add a message type to <code class="language-plaintext highlighter-rouge">sendMessage</code>. Other players can use this message type to complain that a member is offline and punish the member.</p>

<h3 id="appropriate-game-categories">Appropriate game categories.</h3>

<p>This is a multiplayer on-chain game rather than a multiplayer real-time game standard. The game category depends on the network your contract is deployed on. Some layer 2 networks process blocks very quickly and can make some more real-time games. Generally, the network is more suitable for strategy, trading card, turn-based, chess, sandbox, and settlement.</p>

<h2 id="reference-implementation">Reference Implementation</h2>

<p>See <a href="../assets/eip-7566/MultiplayerOnchainGame.sol">Multiplayer Game Communication Example</a></p>

<h2 id="security-considerations">Security Considerations</h2>

<!-- TODO: Needs discussion. -->

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>


  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
