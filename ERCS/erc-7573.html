<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  
  <title>Conditional-upon-Transfer-Decryption for DvP | Ethereum Improvement Proposals</title>
    <meta
      property="og:title"
      content="Conditional-upon-Transfer-Decryption for DvP | Ethereum Improvement Proposals"
    />
    <meta name="description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta property="og:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
    <meta name="twitter:description" content="Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards." />
  
  <meta name="generator" content="Jekyll" />
  <meta property="og:locale" content="en_US" />
  <link rel="canonical" href="http://localhost:4000/ERCS/erc-7573" />
  <meta property="og:url" content="http://localhost:4000/ERCS/erc-7573" />
  <meta property="og:site_name" content="Ethereum Improvement Proposals" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@" />
  <script type="application/ld+json">
    {
      "@type": "WebSite",
      "url": "http://localhost:4000",
      "name": "Ethereum Improvement Proposals",
      "description": "Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.",
      "@context": "https://schema.org"
    }
  </script>
  <link rel="stylesheet" href="/assets/css/style.css" /><link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Ethereum Improvement Proposals" /><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
  <link rel="stylesheet" href="/assets/css/override.css" />
  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js" integrity="sha384-Rx+T1VzGupg4BHQYs2gCW9It+akI2MM/mndMCy36UVfodzcJcF0GGLxZIzObiEfa" crossorigin="anonymous"></script>
  <script type="text/javascript">
    document.addEventListener("DOMContentLoaded", (event) => {
      const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
      const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    });
  </script>
  <script type="text/javascript">
    window.MathJax = {
      loader: {
        load: ['input/tex-base', 'output/chtml']
      },
      tex: {
        inlineMath: [['$', '$']],
        displayMath: [['$$', '$$']],
        processEscapes: true,
        processEnvironments: false,
        processRefs: false
      }
    };
  </script>
  <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3.0.1/es5/tex-mml-chtml.js" integrity="sha384-/1zmJ1mBdfKIOnwPxpdG6yaRrxP6qu3eVYm0cz2nOx+AcL4d3AqEFrwcqGZVVroG" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/citation-js/0.6.7/citation.min.js" integrity="sha512-N+LDFMa9owHXGS+CyMrBvuxq2QuGl3fiB/7cys3aUEL7K6P1soHGqsS0sjHXZpwNd9Kz0m3R4IPy1HYRi6ROEQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script type="text/javascript">
    addEventListener('DOMContentLoaded', async () => {
      const Cite = window.require('citation-js');
      const citationElements = document.querySelectorAll('.language-csl-json');
      for (let citationElement of citationElements) {
        try {
          const citation = await Cite.async(citationElement);
          const template = document.createElement('template');
          template.innerHTML = citation.format('bibliography', {
            format: 'html',
            template: 'apa',
            lang: 'en-US'
          });
          if (citationElement.parentElement && citationElement.parentElement.matches('pre')) {
            citationElement.parentElement.replaceWith(template.content);
          } else {
            citationElement.replaceWith(template.content);
          }
        } catch (e) {
          console.error("unable to render citation", e);
        }
      }
    });
  </script>
</head>
<body><header class="site-header" role="banner">
  <div class="wrapper"><a class="site-title" rel="author" href="/">Ethereum Improvement Proposals</a><nav class="site-nav d-flex">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger row p-2"><a class="page-link col" href="/all">All</a><a class="page-link col" href="/core">Core</a><a class="page-link col" href="/networking">Networking</a><a class="page-link col" href="/interface">Interface</a><a class="page-link col" href="/erc">ERC</a><a class="page-link col" href="/meta">Meta</a><a class="page-link col" href="/informational">Informational</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Conditional-upon-Transfer-Decryption for DvP</h1>
  </header>

  <div class="post-content">
    <h2 id="abstract">Abstract</h2>

<p>The interfaces in this proposal model a functional transaction scheme to establish a secure <em>delivery-versus-payment</em>
across two blockchains, where a) no intermediary is required and b) one of the two chains
can securely interact with a stateless “decryption oracle”. Here, <em>delivery-versus-payment</em> refers to the exchange of,
e.g., an asset against a payment; however, the concept is generic to make a transfer of one token on one
chain (e.g., the payment) conditional to the successful transfer of another token on another chain (e.g., the asset).</p>

<p>The scheme is realized by two smart contracts, one on each chain.
One smart contract implements the <code class="language-plaintext highlighter-rouge">ILockingContract</code> interface on one chain (e.g. the “asset chain”), and another smart contract implements the <code class="language-plaintext highlighter-rouge">IDecryptionContract</code> interface on the other chain (e.g., the “payment chain”).
The smart contract implementing <code class="language-plaintext highlighter-rouge">ILockingContract</code> locks a token (e.g., the asset) on its chain until a key is presented to encrypt to one of two given values.
The smart contract implementing <code class="language-plaintext highlighter-rouge">IDecryptionContract</code>, decrypts one of two keys (via the decryption oracle) conditional to the success or failure of the token transfer (e.g., the payment). A stateless decryption oracle is attached to the chain running <code class="language-plaintext highlighter-rouge">IDecryptionContract</code> for the decryption.</p>

<h2 id="motivation">Motivation</h2>

<p>Within the domain of financial transactions and distributed ledger technology (DLT), the Hash-Linked Contract (HLC) concept has been recognized as valuable and has been thoroughly investigated.
The concept may help to solve the challenge of delivery-versus-payment (DvP), especially in cases where the asset chain and payment system (which may be a chain, too) are separated.
A prominent application of smart contracts realizing a secure DvP is that of buying an asset, where the asset is managed on one chain (the asset chain), but the payments are executed on another chain (the payment chain).
Proposed solutions are based on an API-based interaction mechanism which bridges the communication between a so-called asset chain and a corresponding
payment system or requires complex and problematic time-locks.<sup id="fnref:1" role="doc-noteref"><a href="#fn:1" class="footnote" rel="footnote">1</a></sup></p>

<p>Here, we propose a protocol that facilitates secure delivery-versus-payment with less overhead, especially with a stateless oracle.<sup id="fnref:2" role="doc-noteref"><a href="#fn:2" class="footnote" rel="footnote">2</a></sup></p>

<h2 id="specification">Specification</h2>

<h3 id="methods">Methods</h3>

<h4 id="smart-contract-on-the-chain-that-performs-the-locking-eg-the-asset-chain">Smart Contract on the chain that performs the locking (e.g. the asset chain)</h4>

<p>The following methods specify the functionality of the smart contract implementing
the locking. For further information, please also look at the interface documentation <code class="language-plaintext highlighter-rouge">ILockingContract.sol</code>.</p>

<h5 id="initiation-of-transfer-incepttransfer">Initiation of Transfer: <code class="language-plaintext highlighter-rouge">inceptTransfer</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">inceptTransfer</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedSeller</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</code></pre></div></div>

<p>Called from the buyer of the token to initiate token transfer. Emits a <code class="language-plaintext highlighter-rouge">TransferIncepted</code> event.
The parameter <code class="language-plaintext highlighter-rouge">id</code> is an identifier of the trade. The parameter <code class="language-plaintext highlighter-rouge">from</code> is the address of the seller (the address of the buyer is <code class="language-plaintext highlighter-rouge">msg.sender</code>).
The parameter <code class="language-plaintext highlighter-rouge">keyEncryptedSeller</code> is an encryption of the key that can be used by the seller to (re-)claim the token. See below on “encryption”.</p>

<h5 id="initiation-of-transfer-confirmtransfer">Initiation of Transfer: <code class="language-plaintext highlighter-rouge">confirmTransfer</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">confirmTransfer</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedBuyer</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</code></pre></div></div>

<p>Called from the seller of the token to confirm token transfer. Emits a <code class="language-plaintext highlighter-rouge">TransferConfirmed</code> event.
The parameter <code class="language-plaintext highlighter-rouge">id</code> is an identifier of the trade. The parameter <code class="language-plaintext highlighter-rouge">to</code> is the address of the buyer (the address of the seller is <code class="language-plaintext highlighter-rouge">msg.sender</code>).
The parameter <code class="language-plaintext highlighter-rouge">keyEncryptedBuyer</code> is an encryption of the key that can be used by the buyer to claim the token.</p>

<p>If the trade specification, that is, the quadruppel (<code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">amount</code>, <code class="language-plaintext highlighter-rouge">from</code>, <code class="language-plaintext highlighter-rouge">to</code>), in a call to <code class="language-plaintext highlighter-rouge">confirmTransfer</code>
matches that of a previous call to <code class="language-plaintext highlighter-rouge">inceptTransfer</code>, and the balance is sufficient, the corresponding <code class="language-plaintext highlighter-rouge">amount</code>
of tokens is locked (transferred from <code class="language-plaintext highlighter-rouge">from</code> to the smart contract) and <code class="language-plaintext highlighter-rouge">TransferConfirmed</code> is emitted.</p>

<h5 id="transfer-transferwithkey">Transfer: <code class="language-plaintext highlighter-rouge">transferWithKey</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">transferWithKey</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">key</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</code></pre></div></div>

<p>Called from either the buyer or the seller of the token
of the trade with id <code class="language-plaintext highlighter-rouge">id</code>.</p>

<p>If the method is called from the buyer (<code class="language-plaintext highlighter-rouge">to</code>) <em>and</em> the encryption of <code class="language-plaintext highlighter-rouge">key</code> matches <code class="language-plaintext highlighter-rouge">keyEncryptedBuyer</code>,
then the locked tokens are transferred to the buyer (<code class="language-plaintext highlighter-rouge">to</code>). This emits <code class="language-plaintext highlighter-rouge">TokenClaimed</code>.</p>

<p>If the method is called from the seller (<code class="language-plaintext highlighter-rouge">from</code>) <em>and</em> the encryption of <code class="language-plaintext highlighter-rouge">key</code> matches <code class="language-plaintext highlighter-rouge">keyEncryptedSeller</code>,
then the locked tokens are transferred (back) to the seller (<code class="language-plaintext highlighter-rouge">to</code>). This emits <code class="language-plaintext highlighter-rouge">TokenReclaimed</code>.</p>

<h5 id="summary">Summary</h5>

<p>The interface <code class="language-plaintext highlighter-rouge">ILockingContract</code>:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">interface</span> <span class="n">ILockingContract</span> <span class="p">{</span>
    <span class="k">event</span> <span class="n">TransferIncepted</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">string</span> <span class="n">keyEncryptedSeller</span><span class="p">);</span>
    <span class="k">event</span> <span class="n">TransferConfirmed</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">string</span> <span class="n">keyEncryptedBuyer</span><span class="p">);</span>
    <span class="k">event</span> <span class="n">TokenClaimed</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">);</span>
    <span class="k">event</span> <span class="n">TokenReclaimed</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">);</span>

    <span class="k">function</span> <span class="n">inceptTransfer</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedSeller</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
    <span class="k">function</span> <span class="n">confirmTransfer</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedBuyer</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
    <span class="k">function</span> <span class="n">transferWithKey</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">key</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h4 id="smart-contract-on-the-other-chain-that-performs-the-conditional-decryption-eg-the-payment-chain">Smart Contract on the other chain that performs the conditional decryption (e.g. the payment chain)</h4>

<p>The following methods specify the functionality of the smart contract implementing
the conditional decryption. For further information, please also look at the interface documentation <code class="language-plaintext highlighter-rouge">IDecryptionContract.sol</code>.</p>

<h5 id="initiation-of-transfer-incepttransfer-1">Initiation of Transfer: <code class="language-plaintext highlighter-rouge">inceptTransfer</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">inceptTransfer</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedSuccess</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedFailure</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</code></pre></div></div>

<p>Called from the receiver of the amount to initiate payment transfer. Emits a <code class="language-plaintext highlighter-rouge">PaymentTransferIncepted</code>.
The parameter <code class="language-plaintext highlighter-rouge">id</code> is an identifier of the trade. The parameter <code class="language-plaintext highlighter-rouge">from</code> is the address of the sender of the payment (the address of the receiver is <code class="language-plaintext highlighter-rouge">msg.sender</code>).
The parameter <code class="language-plaintext highlighter-rouge">keyEncryptedSuccess</code> is an encryption of the key and will be decrypted if the transfer is successful in a call to <code class="language-plaintext highlighter-rouge">transferAndDecrypt</code>.
The parameter <code class="language-plaintext highlighter-rouge">keyEncryptedFailure</code> is an encryption of the key and will be decrypted if the transfer fails in a call to <code class="language-plaintext highlighter-rouge">transferAndDecrypt</code> or if <code class="language-plaintext highlighter-rouge">cancelAndDecrypt</code>is successful.</p>

<h5 id="transfer-transferanddecrypt">Transfer: <code class="language-plaintext highlighter-rouge">transferAndDecrypt</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">transferAndDecrypt</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedSuccess</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedFailure</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</code></pre></div></div>

<p>Called from the sender of the amount to initiate completion of the payment transfer. Emits a <code class="language-plaintext highlighter-rouge">TransferKeyRequested</code> and <code class="language-plaintext highlighter-rouge">TransferKeyReleased</code> with keys depending on completion success.
The parameter <code class="language-plaintext highlighter-rouge">id</code> is an identifier of the trade. The parameter <code class="language-plaintext highlighter-rouge">to</code> is the address of the receiver of the payment (the sender of the payment (from) is implicitly the <code class="language-plaintext highlighter-rouge">msg.sender</code>).
The parameter <code class="language-plaintext highlighter-rouge">keyEncryptedSuccess</code> is an encryption of the key and will be decrypted if the transfer is successful.
The parameter <code class="language-plaintext highlighter-rouge">keyEncryptedFailure</code> is an encryption of the key and will be decrypted if the transfer failed.</p>

<p>The method will not decrypt any key and not perfrom a transfer of a payment if the values (<code class="language-plaintext highlighter-rouge">id</code>, <code class="language-plaintext highlighter-rouge">amount</code>, <code class="language-plaintext highlighter-rouge">from</code> <code class="language-plaintext highlighter-rouge">to</code>, <code class="language-plaintext highlighter-rouge">keyEncryptedSuccess</code>, <code class="language-plaintext highlighter-rouge">keyEncryptedFailure</code>)
do not match a previous call to <code class="language-plaintext highlighter-rouge">inceptTransfer</code>.</p>

<h5 id="cancelation-of-transfer-cancelanddecrypt">Cancelation of Transfer: <code class="language-plaintext highlighter-rouge">cancelAndDecrypt</code></h5>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">function</span> <span class="n">cancelAndDecrypt</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedSuccess</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedFailure</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
</code></pre></div></div>

<p>Called from the receiver of the amount to cancel payment transfer (cancels the incept transfer).</p>

<p>The method must be called from the caller of a previous call to <code class="language-plaintext highlighter-rouge">inceptTransfer</code>
with the exact same arguments and cancels this specific transfer.</p>

<h5 id="summary-1">Summary</h5>

<p>The interface <code class="language-plaintext highlighter-rouge">IDecryptionContract</code>:</p>

<div class="language-solidity highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">interface</span> <span class="n">IDecryptionContract</span> <span class="p">{</span>
    <span class="k">event</span> <span class="n">TransferIncepted</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">string</span> <span class="n">keyEncryptedSuccess</span><span class="p">,</span> <span class="kt">string</span> <span class="n">keyEncryptedFailure</span><span class="p">);</span>
    <span class="k">event</span> <span class="n">TransferKeyRequested</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">string</span> <span class="n">encryptedKey</span><span class="p">);</span>
    <span class="k">event</span> <span class="n">TransferKeyReleased</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">success</span><span class="p">,</span> <span class="kt">string</span> <span class="n">key</span><span class="p">);</span>

    <span class="k">function</span> <span class="n">inceptTransfer</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedSuccess</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedFailure</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
    <span class="k">function</span> <span class="n">transferAndDecrypt</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">int</span> <span class="n">amount</span><span class="p">,</span> <span class="kt">address</span> <span class="n">to</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedSuccess</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedFailure</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
    <span class="k">function</span> <span class="n">cancelAndDecrypt</span><span class="p">(</span><span class="kt">bytes32</span> <span class="n">id</span><span class="p">,</span> <span class="kt">address</span> <span class="n">from</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedSuccess</span><span class="p">,</span> <span class="kt">string</span> <span class="k">memory</span> <span class="n">keyEncryptedFailure</span><span class="p">)</span> <span class="k">external</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="encryption-and-decryption">Encryption and Decryption</h3>

<p>The linkage of the two smart contract relies on use of a <code class="language-plaintext highlighter-rouge">key</code> and <code class="language-plaintext highlighter-rouge">encryptedKey</code>.
The implementation is free to support several encryption methods for
as long as the decryption oracle supports it.</p>

<p>The encryption is performed with the public key of
the decryption oracle, which is known to both parties.</p>

<p>It is implicitly assumed that the two parties may check that
the strings <code class="language-plaintext highlighter-rouge">keyEncryptedBuyer</code> and <code class="language-plaintext highlighter-rouge">keyEncryptedSeller</code> are
in a valid format.</p>

<h3 id="sequence-diagram-of-delivery-versus-payment">Sequence diagram of delivery versus payment</h3>

<p>The interplay of the two smart contracts is summarized
in the following sequence diagram:</p>

<p><img src="../assets/eip-7573/doc/DvP-Seq-Diag.png" alt="image info" /></p>

<h2 id="rationale">Rationale</h2>

<p>The protocol tries to be parsimonious. The transfer
is associated with a (preferable unique) <code class="language-plaintext highlighter-rouge">id</code> possibly
generated by some additional interaction of the trading
parties.</p>

<p>The <code class="language-plaintext highlighter-rouge">key</code> and the <code class="language-plaintext highlighter-rouge">encryptedKey</code> arguments are strings to
allow the flexible use of different encryption schemes.
The decryption/encryption scheme should be inferable from the contents
of the <code class="language-plaintext highlighter-rouge">encryptedKey</code>.</p>

<h2 id="security-considerations">Security Considerations</h2>

<p>No known security issues up to now.</p>

<h2 id="copyright">Copyright</h2>

<p>Copyright and related rights waived via <a href="/LICENSE">CC0</a>.</p>

<pre><code class="language-csl-json">    {
      "type": "article",
      "id": 1,
      "author": [
        {
          "family": "La Rocca",
          "given": "Rosario"
        },
        {
          "family": "Mancini",
          "given": "Riccardo"
        },
        {
          "family": "Benedetti",
          "given": "Marco"
        },
        {
          "family": "Caruso",
          "given": "Matteo"
        },
        {
          "family": "Cossu",
          "given": "Stefano"
        },
        {
          "family": "Galano",
          "given": "Giuseppe"
        },
        {
          "family": "Mancini",
          "given": "Simone"
        },
        {
          "family": "Marcelli",
          "given": "Gabriele"
        },
        {
          "family": "Martella",
          "given": "Piero"
        },
        {
          "family": "Nardelli",
          "given": "Matteo"
        },
        {
          "family": "Oliviero",
          "given": "Ciro"
        }
      ],
      "DOI": "10.2139/ssrn.4386904",
      "title": "Integrating DLTs with Market Infrastructures: Analysis and Proof-of-Concept for Secure DvP between TIPS and DLT Platforms",
      "original-date": {
        "date-parts": [
          [2022, 7, 19]
        ]
      },
      "URL": "http://dx.doi.org/10.2139/ssrn.4386904"
    }
</code></pre>

<pre><code class="language-csl-json">    {
      "type": "article",
      "id": 2,
      "author": [
        {
          "family": "Fries",
          "given": "Christian"
        },
        {
          "family": "Kohl-Landgraf",
          "given": "Peter"
        }
      ],
      "DOI": "10.2139/ssrn.4628811",
      "title": "A Proposal for a Lean and Functional Delivery versus Payment across two Blockchains",
      "original-date": {
        "date-parts": [
          [2023, 11, 9]
        ]
      },
      "URL": "http://dx.doi.org/10.2139/ssrn.4628811"
    }
</code></pre>

<div class="footnotes" role="doc-endnotes">
  <ol>
    <li id="fn:1" role="doc-endnote">

      <p><a href="#fnref:1" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
    <li id="fn:2" role="doc-endnote">

      <p><a href="#fnref:2" class="reversefootnote" role="doc-backlink">&#8617;</a></p>
    </li>
  </ol>
</div>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Ethereum Improvement Proposals</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Ethereum Improvement Proposals</li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/ethereum/EIPs"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">ethereum/EIPs</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Ethereum Improvement Proposals (EIPs) describe standards for the Ethereum platform, including core protocol specifications, client APIs, and contract standards.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
